{"version":3,"file":"static/js/447.25efaada.chunk.js","mappings":"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","sources":["utils/sanitize.js","components/AddBestieModal.jsx","components/BestieRequestCard.jsx","components/besties/PendingRequestsList.jsx","components/besties/NeedsAttentionSection.jsx","components/besties/PostReactions.jsx","components/besties/PostComments.jsx","components/besties/ActivityFeed.jsx","components/besties/ActivityFeedSkeleton.jsx","components/besties/EmptyState.jsx","components/CreatePostModal.jsx","components/besties/BestiesLeaderboard.jsx","components/BestieCard.jsx","components/besties/BestiesGrid.jsx","components/besties/CommentsModal.jsx","pages/BestiesPage.jsx"],"sourcesContent":["/**\r\n * Input sanitization utilities\r\n * Prevents XSS attacks by sanitizing user-generated content\r\n */\r\n\r\nimport DOMPurify from 'dompurify';\r\n\r\n/**\r\n * Sanitize HTML content to prevent XSS attacks\r\n * @param {string} dirty - Unsanitized HTML string\r\n * @param {Object} options - DOMPurify options\r\n * @returns {string} Sanitized HTML string\r\n */\r\nexport function sanitizeHTML(dirty, options = {}) {\r\n  if (typeof dirty !== 'string') {\r\n    return '';\r\n  }\r\n\r\n  const defaultOptions = {\r\n    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p', 'br'],\r\n    ALLOWED_ATTR: ['href', 'title'],\r\n    ALLOW_DATA_ATTR: false,\r\n  };\r\n\r\n  return DOMPurify.sanitize(dirty, { ...defaultOptions, ...options });\r\n}\r\n\r\n/**\r\n * Sanitize plain text (removes all HTML)\r\n * @param {string} text - Text that may contain HTML\r\n * @returns {string} Plain text with HTML removed\r\n */\r\nexport function sanitizeText(text) {\r\n  if (typeof text !== 'string') {\r\n    return '';\r\n  }\r\n\r\n  return DOMPurify.sanitize(text, {\r\n    ALLOWED_TAGS: [],\r\n    ALLOWED_ATTR: [],\r\n  });\r\n}\r\n\r\n/**\r\n * Sanitize user input for display (strips HTML, limits length)\r\n * @param {string} input - User input\r\n * @param {number} maxLength - Maximum length (default: 1000)\r\n * @returns {string} Sanitized text\r\n */\r\nexport function sanitizeUserInput(input, maxLength = 1000) {\r\n  if (typeof input !== 'string') {\r\n    return '';\r\n  }\r\n\r\n  const sanitized = sanitizeText(input);\r\n  return sanitized.substring(0, maxLength);\r\n}\r\n\r\n","import React, { useState } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport toast from 'react-hot-toast';\r\nimport '../styles/AddBestieModal.css';\r\n\r\nconst AddBestieModal = ({ onClose, onSuccess }) => {\r\n  const { currentUser, userData } = useAuth();\r\n  const [showCelebration, setShowCelebration] = useState(false);\r\n\r\n  const shareUrl = `https://bestiesapp.web.app/?invite=${currentUser?.uid}`;\r\n  const shareMessage = `Hey! ${userData?.displayName || 'Your friend'} wants you to be their safety bestie on Besties!  Join them and help keep each other safe: ${shareUrl}`;\r\n\r\n  const handleNativeShare = async () => {\r\n    if (navigator.share) {\r\n      try {\r\n        await navigator.share({\r\n          title: 'Join me on Besties!',\r\n          text: shareMessage,\r\n          url: shareUrl,\r\n        });\r\n\r\n        // Show celebration\r\n        setShowCelebration(true);\r\n        toast.success('Thanks for inviting your bestie! ');\r\n\r\n        setTimeout(() => {\r\n          onSuccess?.();\r\n          onClose();\r\n        }, 2000);\r\n      } catch (error) {\r\n        // User cancelled - that's okay!\r\n        if (error.name !== 'AbortError') {\r\n          console.error('Share failed:', error);\r\n          toast.error('Sharing failed. Try copy link instead!');\r\n        }\r\n      }\r\n    } else {\r\n      // Fallback: just copy to clipboard\r\n      handleCopyLink();\r\n    }\r\n  };\r\n\r\n  const handleCopyLink = () => {\r\n    navigator.clipboard.writeText(shareMessage);\r\n    toast.success('Link copied! Now paste it to your bestie! ');\r\n    setShowCelebration(true);\r\n\r\n    setTimeout(() => {\r\n      onSuccess?.();\r\n      onClose();\r\n    }, 2000);\r\n  };\r\n\r\n  const handleWhatsAppShare = () => {\r\n    const encoded = encodeURIComponent(shareMessage);\r\n    // Try to open in WhatsApp app first\r\n    window.location.href = `whatsapp://send?text=${encoded}`;\r\n\r\n    // Fallback to web WhatsApp if app doesn't open\r\n    setTimeout(() => {\r\n      window.open(`https://wa.me/?text=${encoded}`, '_blank');\r\n    }, 1000);\r\n\r\n    setShowCelebration(true);\r\n    setTimeout(() => {\r\n      onSuccess?.();\r\n      onClose();\r\n    }, 1500);\r\n  };\r\n\r\n  const handleFacebookShare = () => {\r\n    const encoded = encodeURIComponent(shareUrl);\r\n    // Try to open in Facebook app first, fallback to web\r\n    const fbAppUrl = `fb://facewebmodal/f?href=${encoded}`;\r\n    window.location.href = fbAppUrl;\r\n\r\n    // Fallback to web if app doesn't open\r\n    setTimeout(() => {\r\n      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encoded}`, '_blank');\r\n    }, 1000);\r\n\r\n    setShowCelebration(true);\r\n    setTimeout(() => {\r\n      onSuccess?.();\r\n      onClose();\r\n    }, 1500);\r\n  };\r\n\r\n  const handleMessengerShare = () => {\r\n    const encoded = encodeURIComponent(shareUrl);\r\n    // Try to open in Messenger app first\r\n    window.location.href = `fb-messenger://share?link=${encoded}`;\r\n\r\n    // Fallback to web messenger\r\n    setTimeout(() => {\r\n      window.open(`https://www.facebook.com/dialog/send?link=${encoded}&app_id=YOUR_APP_ID&redirect_uri=${window.location.origin}`, '_blank');\r\n    }, 1000);\r\n\r\n    setShowCelebration(true);\r\n    setTimeout(() => {\r\n      onSuccess?.();\r\n      onClose();\r\n    }, 1500);\r\n  };\r\n\r\n  const handleSMSShare = () => {\r\n    const encoded = encodeURIComponent(shareMessage);\r\n    window.location.href = `sms:?body=${encoded}`;\r\n    setShowCelebration(true);\r\n\r\n    setTimeout(() => {\r\n      onSuccess?.();\r\n      onClose();\r\n    }, 1500);\r\n  };\r\n\r\n  if (showCelebration) {\r\n    return (\r\n      <div className=\"modal-overlay\" onClick={onClose}>\r\n        <div className=\"modal-content celebration-modal\" onClick={(e) => e.stopPropagation()}>\r\n          <div className=\"celebration-content\">\r\n            <div className=\"celebration-emoji\"></div>\r\n            <h2 className=\"celebration-title\">Amazing!</h2>\r\n            <p className=\"celebration-text\">\r\n              You're building your safety network! Every bestie you add makes both of you safer. \r\n            </p>\r\n            <div className=\"celebration-encouragement\">\r\n              <p className=\"font-semibold text-primary dark:text-purple-400\">Keep going! Invite more besties:</p>\r\n              <p className=\"text-sm text-text-secondary dark:text-gray-300 mt-2\">\r\n                The more people in your circle, the safer everyone is.\r\n                Your besties will thank you! \r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal-content invite-modal\" onClick={(e) => e.stopPropagation()}>\r\n        {/* Header */}\r\n        <div className=\"invite-header\">\r\n          <div className=\"invite-icon\"></div>\r\n          <h2 className=\"invite-title\">Invite Your Bestie</h2>\r\n          <p className=\"invite-subtitle\">\r\n            You're making such a smart choice! Adding besties means you'll both be safer when you're out. \r\n          </p>\r\n        </div>\r\n\r\n        {/* Bestie Circle Importance */}\r\n        <div className=\"invite-encouragement-box\">\r\n          <p className=\"text-sm font-semibold text-primary dark:text-purple-400 mb-2\">\r\n             Complete Your Bestie Circle\r\n          </p>\r\n          <p className=\"text-sm text-text-secondary dark:text-gray-300\">\r\n            Your safety network gets stronger with every bestie you add. Having 3-5 trusted friends means:\r\n          </p>\r\n          <ul className=\"invite-benefits\">\r\n            <li> Someone's always available when you need help</li>\r\n            <li> Faster response times in emergencies</li>\r\n            <li> You all watch out for each other - true sisterhood! </li>\r\n          </ul>\r\n        </div>\r\n\r\n        {/* Native Share Button (Primary) */}\r\n        <button\r\n          onClick={handleNativeShare}\r\n          className=\"share-button primary-share\"\r\n        >\r\n          <span className=\"share-icon\"></span>\r\n          <div className=\"share-button-content\">\r\n            <div className=\"share-button-title\">Share Invite</div>\r\n            <div className=\"share-button-subtitle\">Choose any app to send</div>\r\n          </div>\r\n        </button>\r\n\r\n        {/* Or Divider */}\r\n        <div className=\"share-divider\">\r\n          <span>OR SHARE VIA</span>\r\n        </div>\r\n\r\n        {/* Share Options Grid */}\r\n        <div className=\"share-options-grid\">\r\n          <button\r\n            onClick={handleWhatsAppShare}\r\n            className=\"share-option whatsapp\"\r\n          >\r\n            <span className=\"share-option-emoji\"></span>\r\n            <span>WhatsApp</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleMessengerShare}\r\n            className=\"share-option messenger\"\r\n          >\r\n            <span className=\"share-option-emoji\"></span>\r\n            <span>Messenger</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleSMSShare}\r\n            className=\"share-option sms\"\r\n          >\r\n            <span className=\"share-option-emoji\"></span>\r\n            <span>Text</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleFacebookShare}\r\n            className=\"share-option facebook\"\r\n          >\r\n            <span className=\"share-option-emoji\"></span>\r\n            <span>Facebook</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleCopyLink}\r\n            className=\"share-option copy\"\r\n          >\r\n            <span className=\"share-option-emoji\"></span>\r\n            <span>Copy Link</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Footer Encouragement */}\r\n        <div className=\"invite-footer\">\r\n          <p className=\"text-xs text-text-secondary dark:text-gray-400\">\r\n             Your besties will appreciate you looking out for them!\r\n          </p>\r\n        </div>\r\n\r\n        {/* Close Button */}\r\n        <button onClick={onClose} className=\"modal-close-button\">\r\n          \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddBestieModal;\r\n","import React, { useState } from 'react';\r\nimport apiService from '../services/api';\r\nimport useOptimisticUpdate from '../hooks/useOptimisticUpdate';\r\n\r\nconst BestieRequestCard = ({ request, onRequestHandled }) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [isHidden, setIsHidden] = useState(false);\r\n  const { executeOptimistic } = useOptimisticUpdate();\r\n\r\n  // Use photo from request data instead of fetching from users collection\r\n  const userPhoto = request?.requesterPhotoURL || null;\r\n\r\n  const handleAccept = async () => {\r\n    await executeOptimistic({\r\n      optimisticUpdate: () => {\r\n        // Hide card immediately\r\n        setIsHidden(true);\r\n        // Notify parent to remove from list\r\n        if (onRequestHandled) {\r\n          onRequestHandled(request.id);\r\n        }\r\n      },\r\n      serverUpdate: async () => {\r\n        setLoading(true);\r\n        try {\r\n          const result = await apiService.acceptBestieRequest(request.id);\r\n\r\n          if (!result.success) {\r\n            throw new Error('Failed to accept request');\r\n          }\r\n\r\n          // Track analytics\r\n          const { logAnalyticsEvent } = require('../services/firebase');\r\n          logAnalyticsEvent('bestie_request_accepted', {\r\n            method: 'accept'\r\n          });\r\n\r\n          return result;\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      },\r\n      rollback: () => {\r\n        // Show card again on error\r\n        setIsHidden(false);\r\n      },\r\n      successMessage: `You're now besties with ${request.requesterName}! `,\r\n      errorMessage: 'Failed to accept request'\r\n    });\r\n  };\r\n\r\n  const handleDecline = async () => {\r\n    await executeOptimistic({\r\n      optimisticUpdate: () => {\r\n        // Hide card immediately\r\n        setIsHidden(true);\r\n        // Notify parent to remove from list\r\n        if (onRequestHandled) {\r\n          onRequestHandled(request.id);\r\n        }\r\n      },\r\n      serverUpdate: async () => {\r\n        setLoading(true);\r\n        try {\r\n          const result = await apiService.declineBestieRequest(request.id);\r\n\r\n          if (!result.success) {\r\n            throw new Error('Failed to decline request');\r\n          }\r\n\r\n          return result;\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      },\r\n      rollback: () => {\r\n        // Show card again on error\r\n        setIsHidden(false);\r\n      },\r\n      successMessage: 'Request declined',\r\n      errorMessage: 'Failed to decline request'\r\n    });\r\n  };\r\n\r\n  const getInitial = () => {\r\n    if (request?.requesterName && typeof request.requesterName === 'string' && request.requesterName.length > 0) {\r\n      return request.requesterName[0].toUpperCase();\r\n    }\r\n    return '?';\r\n  };\r\n\r\n  // Don't render if hidden optimistically\r\n  if (isHidden) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"card p-4 border-2 border-primary/20 animate-fade-in\">\r\n      <div className=\"flex items-center gap-3 mb-3\">\r\n        <div className=\"w-12 h-12 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display text-lg overflow-hidden\">\r\n          {userPhoto ? (\r\n            <img\r\n              src={userPhoto}\r\n              alt={request.requesterName || 'Bestie'}\r\n              className=\"w-full h-full object-cover\"\r\n            />\r\n          ) : (\r\n            getInitial()\r\n          )}\r\n        </div>\r\n        <div className=\"flex-1\">\r\n          <div className=\"font-semibold text-text-primary\">\r\n            {request.requesterName}\r\n          </div>\r\n          <div className=\"text-sm text-text-secondary\">\r\n            {request.requesterPhone}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {request.personalMessage && (\r\n        <div className=\"bg-gray-50 rounded-lg p-3 mb-3 text-sm text-text-secondary italic\">\r\n          \"{request.personalMessage}\"\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          onClick={handleDecline}\r\n          disabled={loading}\r\n          className=\"flex-1 btn btn-secondary text-sm\"\r\n        >\r\n          Decline\r\n        </button>\r\n        <button\r\n          onClick={handleAccept}\r\n          disabled={loading}\r\n          className=\"flex-1 btn btn-primary text-sm\"\r\n        >\r\n          {loading ? 'Accepting...' : 'Accept'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BestieRequestCard;\r\n","import React from 'react';\r\nimport BestieRequestCard from '../BestieRequestCard';\r\n\r\nconst PendingRequestsList = ({ pendingRequests }) => {\r\n  if (pendingRequests.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mb-6\">\r\n      <h2 className=\"text-lg md:text-xl font-display text-text-primary mb-3\">\r\n         Pending Requests ({pendingRequests.length})\r\n      </h2>\r\n      <div className=\"space-y-3\">\r\n        {pendingRequests.map((request) => (\r\n          <BestieRequestCard key={request.id} request={request} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PendingRequestsList;\r\n","import React, { useState } from 'react';\r\n\r\nconst NeedsAttentionSection = ({ missedCheckIns, requestsForAttention, besties }) => {\r\n  const [dismissedItems, setDismissedItems] = useState(new Set());\r\n  \r\n  // Filter out dismissed items\r\n  const visibleMissed = missedCheckIns.filter(m => !dismissedItems.has(`missed-${m.id}`));\r\n  const visibleRequests = requestsForAttention.filter(r => !dismissedItems.has(`request-${r.userId}`));\r\n  \r\n  const hasAlerts = visibleMissed.length > 0 || visibleRequests.length > 0;\r\n\r\n  const dismissItem = (type, id) => {\r\n    setDismissedItems(prev => new Set([...prev, `${type}-${id}`]));\r\n  };\r\n\r\n  if (!hasAlerts) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mb-6\">\r\n      <h2 className=\"text-lg md:text-xl font-display text-red-600 mb-3 flex items-center gap-2\">\r\n        <span className=\"animate-ping inline-block w-3 h-3 bg-red-600 rounded-full\"></span>\r\n         NEEDS ATTENTION\r\n      </h2>\r\n\r\n      {/* Missed Check-ins */}\r\n      {visibleMissed.length > 0 && (\r\n        <div className=\"space-y-3 mb-4\">\r\n          {visibleMissed.map((missed) => (\r\n            <div key={missed.id} className=\"card p-4 bg-red-50 dark:bg-red-900/30 border-2 border-red-400 dark:border-red-600 relative\">\r\n              {/* Dismiss X button */}\r\n              <button\r\n                onClick={() => dismissItem('missed', missed.id)}\r\n                className=\"absolute top-2 right-2 w-6 h-6 rounded-full bg-red-200 dark:bg-red-800 hover:bg-red-300 dark:hover:bg-red-700 flex items-center justify-center text-red-600 dark:text-red-300 text-sm font-bold transition-colors\"\r\n                title=\"Dismiss\"\r\n              >\r\n                \r\n              </button>\r\n              \r\n              <div className=\"flex flex-col sm:flex-row sm:items-start gap-3 pr-6\">\r\n                <div className=\"text-3xl flex-shrink-0\"></div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <h3 className=\"font-semibold text-red-900 dark:text-red-200 text-sm md:text-base\">\r\n                    {missed.userName} missed a check-in\r\n                  </h3>\r\n                  <p className=\"text-xs md:text-sm text-red-700 dark:text-red-300 break-words\">\r\n                    {missed.checkInData.activity?.name || 'Check-in'}  {\r\n                      new Date(missed.timestamp).toLocaleString()\r\n                    }\r\n                  </p>\r\n                  {missed.checkInData.location?.address && (\r\n                    <p className=\"text-xs md:text-sm text-red-600 dark:text-red-400 mt-1 break-words\">\r\n                       {missed.checkInData.location.address}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  className=\"btn btn-sm bg-red-600 text-white hover:bg-red-700 w-full sm:w-auto flex-shrink-0\"\r\n                  onClick={() => {\r\n                    dismissItem('missed', missed.id);\r\n                    window.location.href = `tel:${besties.find(b => b.userId === missed.userId)?.phone}`;\r\n                  }}\r\n                >\r\n                  Call Now\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Request Attention - Speech Bubble Style */}\r\n      {visibleRequests.length > 0 && (\r\n        <div className=\"space-y-3\">\r\n          {visibleRequests.map((request) => (\r\n            <div key={request.userId} className=\"flex items-start gap-3 relative\">\r\n              {/* Avatar */}\r\n              <div className=\"flex-shrink-0\">\r\n                {request.photoURL ? (\r\n                  <img \r\n                    src={request.photoURL} \r\n                    alt={request.userName} \r\n                    className=\"w-10 h-10 rounded-full object-cover border-2 border-purple-300\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-semibold\">\r\n                    {request.userName?.charAt(0) || '?'}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Speech Bubble */}\r\n              <div className=\"flex-1 relative\">\r\n                {/* Dismiss X button */}\r\n                <button\r\n                  onClick={() => dismissItem('request', request.userId)}\r\n                  className=\"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-purple-200 dark:bg-purple-800 hover:bg-purple-300 dark:hover:bg-purple-700 flex items-center justify-center text-purple-600 dark:text-purple-300 text-xs font-bold transition-colors z-10\"\r\n                  title=\"Dismiss\"\r\n                >\r\n                  \r\n                </button>\r\n                \r\n                <div className=\"relative bg-gradient-to-br from-purple-100 to-pink-50 dark:from-purple-900/40 dark:to-pink-900/30 rounded-2xl rounded-tl-sm p-4 shadow-sm\">\r\n                  {/* Triangle pointer */}\r\n                  <div className=\"absolute -left-2 top-3 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-purple-100 dark:border-r-purple-900/40\"></div>\r\n                  \r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <span className=\"font-semibold text-purple-900 dark:text-purple-200 text-sm\">\r\n                        {request.userName}\r\n                      </span>\r\n                      <span className=\"mx-2 text-purple-400\"></span>\r\n                      <span className=\"text-xs text-purple-600 dark:text-purple-400\">\r\n                        {request.tag === 'needs to vent' ? ' needs to vent' : request.tag}\r\n                      </span>\r\n                    </div>\r\n                    <button\r\n                      className=\"btn btn-sm btn-primary flex-shrink-0 ml-2\"\r\n                      onClick={() => {\r\n                        dismissItem('request', request.userId);\r\n                        const bestie = besties.find(b => b.userId === request.userId);\r\n                        if (bestie?.phone) {\r\n                          window.location.href = `sms:${bestie.phone}`;\r\n                        }\r\n                      }}\r\n                    >\r\n                       Reach Out\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NeedsAttentionSection;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { db } from '../../services/firebase';\r\nimport { collection, query, where, getDocs, addDoc, deleteDoc, doc, updateDoc, increment, onSnapshot, Timestamp } from 'firebase/firestore';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport haptic from '../../utils/hapticFeedback';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst PostReactions = ({ postId, initialCounts }) => {\r\n  const { currentUser, userData } = useAuth();\r\n  const [reactions, setReactions] = useState(initialCounts || { heart: 0, laugh: 0, fire: 0 });\r\n  const [myReaction, setMyReaction] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const reactionTypes = [\r\n    { type: 'heart', emoji: '', label: 'Love' },\r\n    { type: 'laugh', emoji: '', label: 'Haha' },\r\n    { type: 'fire', emoji: '', label: 'Fire' }\r\n  ];\r\n\r\n  // Load user's existing reaction\r\n  useEffect(() => {\r\n    const loadMyReaction = async () => {\r\n      try {\r\n        const reactionsRef = collection(db, `posts/${postId}/reactions`);\r\n        const q = query(reactionsRef, where('userId', '==', currentUser.uid));\r\n        const snapshot = await getDocs(q);\r\n\r\n        if (!snapshot.empty) {\r\n          setMyReaction(snapshot.docs[0].data().type);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading user reaction:', error);\r\n      }\r\n    };\r\n\r\n    if (currentUser && postId) {\r\n      loadMyReaction();\r\n    }\r\n  }, [currentUser, postId]);\r\n\r\n  // Real-time listener for reaction counts\r\n  useEffect(() => {\r\n    const postRef = doc(db, 'posts', postId);\r\n    const unsubscribe = onSnapshot(postRef, (docSnap) => {\r\n      if (docSnap.exists()) {\r\n        setReactions(docSnap.data().reactionCounts || { heart: 0, laugh: 0, fire: 0 });\r\n      }\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [postId]);\r\n\r\n  const handleReaction = async (type) => {\r\n    if (loading) return;\r\n\r\n    setLoading(true);\r\n    haptic.light();\r\n\r\n    // Optimistic update\r\n    const previousReactions = { ...reactions };\r\n    const previousMyReaction = myReaction;\r\n\r\n    try {\r\n      const reactionsRef = collection(db, `posts/${postId}/reactions`);\r\n      const postRef = doc(db, 'posts', postId);\r\n\r\n      if (myReaction === type) {\r\n        // Optimistically remove reaction\r\n        setReactions(prev => ({\r\n          ...prev,\r\n          [type]: Math.max(0, prev[type] - 1)\r\n        }));\r\n        setMyReaction(null);\r\n\r\n        // Remove reaction from database\r\n        const q = query(reactionsRef, where('userId', '==', currentUser.uid));\r\n        const snapshot = await getDocs(q);\r\n\r\n        if (!snapshot.empty) {\r\n          await deleteDoc(snapshot.docs[0].ref);\r\n          await updateDoc(postRef, {\r\n            [`reactionCounts.${type}`]: increment(-1)\r\n          });\r\n        }\r\n      } else {\r\n        // Optimistically update reaction\r\n        const newReactions = { ...reactions };\r\n        if (myReaction) {\r\n          newReactions[myReaction] = Math.max(0, newReactions[myReaction] - 1);\r\n        }\r\n        newReactions[type] = (newReactions[type] || 0) + 1;\r\n        setReactions(newReactions);\r\n        setMyReaction(type);\r\n\r\n        // Update database\r\n        if (myReaction) {\r\n          // Remove old reaction\r\n          const q = query(reactionsRef, where('userId', '==', currentUser.uid));\r\n          const snapshot = await getDocs(q);\r\n\r\n          if (!snapshot.empty) {\r\n            await deleteDoc(snapshot.docs[0].ref);\r\n            await updateDoc(postRef, {\r\n              [`reactionCounts.${myReaction}`]: increment(-1)\r\n            });\r\n          }\r\n        }\r\n\r\n        // Add new reaction\r\n        await addDoc(reactionsRef, {\r\n          userId: currentUser.uid,\r\n          userName: userData?.displayName || 'Anonymous',\r\n          type: type,\r\n          createdAt: Timestamp.now()\r\n        });\r\n\r\n        await updateDoc(postRef, {\r\n          [`reactionCounts.${type}`]: increment(1)\r\n        });\r\n\r\n        // Track analytics\r\n        const { logAnalyticsEvent } = require('../../services/firebase');\r\n        logAnalyticsEvent('post_reaction_added', {\r\n          reaction_type: type,\r\n          post_id: postId\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error handling reaction:', error);\r\n      toast.error('Failed to update reaction');\r\n      // Rollback optimistic update\r\n      setReactions(previousReactions);\r\n      setMyReaction(previousMyReaction);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 mt-3 flex-wrap\">\r\n      {reactionTypes.map((reaction) => {\r\n        const isActive = myReaction === reaction.type;\r\n        const count = reactions[reaction.type] || 0;\r\n\r\n        return (\r\n          <button\r\n            key={reaction.type}\r\n            onClick={() => handleReaction(reaction.type)}\r\n            disabled={loading}\r\n            className={`flex items-center gap-1 px-3 py-1.5 rounded-full text-sm transition-all ${\r\n              isActive\r\n                ? 'bg-purple-100 dark:bg-purple-900 ring-2 ring-purple-500 scale-110'\r\n                : count > 0\r\n                  ? 'bg-pink-50 dark:bg-pink-900/30'\r\n                  : 'bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n            } disabled:opacity-50`}\r\n            title={reaction.label}\r\n          >\r\n            <span className=\"text-lg\">{reaction.emoji}</span>\r\n            <span className={`font-semibold ${isActive ? 'text-purple-700 dark:text-purple-300' : 'text-gray-600 dark:text-gray-400'}`}>\r\n              {count}\r\n            </span>\r\n          </button>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostReactions;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { db } from '../../services/firebase';\r\nimport { collection, query, orderBy, limit, addDoc, onSnapshot, Timestamp, doc, updateDoc, increment } from 'firebase/firestore';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport toast from 'react-hot-toast';\r\nimport haptic from '../../utils/hapticFeedback';\r\nimport { sanitizeUserInput } from '../../utils/sanitize';\r\n\r\nconst getTimeAgo = (timestamp) => {\r\n  if (!timestamp) return '';\r\n  const now = new Date();\r\n  const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n  const diffMs = now - date;\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  const diffHours = Math.floor(diffMs / 3600000);\r\n  const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n  if (diffMins < 1) return 'Just now';\r\n  if (diffMins < 60) return `${diffMins} min ago`;\r\n  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n  return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n};\r\n\r\nconst PostComments = ({ postId, onClose }) => {\r\n  const { currentUser, userData } = useAuth();\r\n  const [comments, setComments] = useState([]);\r\n  const [newComment, setNewComment] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  // Real-time listener for comments\r\n  useEffect(() => {\r\n    const commentsRef = collection(db, `posts/${postId}/comments`);\r\n    const q = query(commentsRef, orderBy('createdAt', 'desc'), limit(50));\r\n\r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const commentsList = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n      setComments(commentsList);\r\n      setLoading(false);\r\n    }, (error) => {\r\n      console.error('Error loading comments:', error);\r\n      setLoading(false);\r\n      toast.error('Failed to load comments');\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [postId]);\r\n\r\n  const handleSubmitComment = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!newComment.trim()) return;\r\n    if (submitting) return;\r\n\r\n    setSubmitting(true);\r\n    haptic.light();\r\n\r\n    try {\r\n      const commentsRef = collection(db, `posts/${postId}/comments`);\r\n      const postRef = doc(db, 'posts', postId);\r\n\r\n      // Sanitize comment text to prevent XSS attacks\r\n      const sanitizedText = sanitizeUserInput(newComment.trim(), 2000); // Max 2000 chars for comments\r\n\r\n      // Add comment\r\n      await addDoc(commentsRef, {\r\n        userId: currentUser.uid,\r\n        userName: userData?.displayName || 'Anonymous',\r\n        userPhoto: userData?.photoURL || null,\r\n        text: sanitizedText,\r\n        createdAt: Timestamp.now()\r\n      });\r\n\r\n      // Increment comment count\r\n      await updateDoc(postRef, {\r\n        commentCount: increment(1)\r\n      });\r\n\r\n      // Track analytics\r\n      const { logAnalyticsEvent } = require('../../services/firebase');\r\n      logAnalyticsEvent('post_comment_added', {\r\n        post_id: postId,\r\n        comment_length: newComment.trim().length\r\n      });\r\n\r\n      setNewComment('');\r\n      toast.success('Comment added!');\r\n      haptic.success();\r\n    } catch (error) {\r\n      console.error('Error adding comment:', error);\r\n      toast.error('Failed to add comment');\r\n      haptic.error();\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"fixed inset-0 bg-black bg-opacity-50 z-[200] flex items-end md:items-center justify-center pb-28 md:pb-0\"\r\n      onClick={onClose}\r\n    >\r\n      <div \r\n        className=\"bg-white dark:bg-gray-800 rounded-t-2xl md:rounded-2xl max-w-md w-full max-h-[55vh] md:max-h-[600px] flex flex-col mb-4 md:mb-0\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"p-4 md:p-6 border-b border-gray-200 dark:border-gray-600 flex-shrink-0 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-xl md:text-2xl font-display text-transparent bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text\">\r\n               Comments\r\n            </h2>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors\"\r\n            >\r\n              \r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Comments List - Scrollable */}\r\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 overscroll-contain\">\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"spinner\"></div>\r\n            </div>\r\n          ) : comments.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <div className=\"text-5xl mb-3\"></div>\r\n              <p className=\"text-gray-500 dark:text-gray-400 text-sm font-semibold\">\r\n                No comments yet\r\n              </p>\r\n              <p className=\"text-gray-400 dark:text-gray-500 text-xs mt-1\">\r\n                Be the first to comment!\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            comments.map((comment) => (\r\n              <div key={comment.id} className=\"flex gap-3 animate-fade-in\">\r\n                {/* User Avatar */}\r\n                <div className=\"flex-shrink-0\">\r\n                  {comment.userPhoto ? (\r\n                    <img\r\n                      src={comment.userPhoto}\r\n                      alt={comment.userName}\r\n                      className=\"w-9 h-9 rounded-full object-cover ring-2 ring-purple-100 dark:ring-purple-600\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-9 h-9 bg-gradient-primary rounded-full flex items-center justify-center text-white text-sm font-display ring-2 ring-purple-100 dark:ring-purple-600\">\r\n                      {comment.userName?.[0] || '?'}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {/* Comment Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-2xl px-4 py-2 shadow-sm\">\r\n                    <p className=\"font-bold text-sm text-gray-900 dark:text-gray-200\">\r\n                      {comment.userName}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300 break-words leading-relaxed\">\r\n                      {comment.text}\r\n                    </p>\r\n                  </div>\r\n                  <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1 px-3\">\r\n                    {getTimeAgo(comment.createdAt)}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Add Comment Input - Fixed at bottom with safe area */}\r\n        <form onSubmit={handleSubmitComment} className=\"p-4 md:p-6 border-t-2 border-purple-100 dark:border-purple-600 flex-shrink-0 bg-white dark:bg-gray-800\">\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              type=\"text\"\r\n              value={newComment}\r\n              onChange={(e) => setNewComment(e.target.value)}\r\n              onKeyPress={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  handleSubmitComment(e);\r\n                }\r\n              }}\r\n              placeholder=\"Add a comment...\"\r\n              className=\"flex-1 px-4 py-3 rounded-full border-2 border-purple-200 dark:border-purple-600 focus:border-purple-400 dark:focus:border-purple-400 focus:outline-none text-sm shadow-sm transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200\"\r\n              maxLength={500}\r\n            />\r\n            <button\r\n              type=\"submit\"\r\n              disabled={!newComment.trim() || submitting}\r\n              className=\"btn btn-primary px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg transition-shadow\"\r\n            >\r\n              {submitting ? '...' : 'Send'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostComments;\r\n","import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport PostReactions from './PostReactions';\r\nimport PostComments from './PostComments';\r\n\r\nconst ActivityFeed = ({\r\n  activityFeed,\r\n  reactions,\r\n  addReaction,\r\n  setSelectedCheckIn,\r\n  setShowComments,\r\n  getTimeAgo,\r\n  initialPostId = null\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const [showPostComments, setShowPostComments] = useState(initialPostId); // Store post ID\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const itemsPerPage = 10;\r\n\r\n  // Open post comments if initialPostId is provided\r\n  React.useEffect(() => {\r\n    if (initialPostId && !showPostComments) {\r\n      setShowPostComments(initialPostId);\r\n    }\r\n  }, [initialPostId]);\r\n\r\n  // Calculate pagination\r\n  const totalPages = Math.ceil(activityFeed.length / itemsPerPage);\r\n  const startIndex = (currentPage - 1) * itemsPerPage;\r\n  const paginatedFeed = activityFeed.slice(startIndex, startIndex + itemsPerPage);\r\n\r\n  if (activityFeed.length === 0) {\r\n    return (\r\n      <div className=\"card p-6 md:p-8 text-center\">\r\n        <div className=\"text-3xl md:text-4xl mb-2\"></div>\r\n        <p className=\"text-sm md:text-base text-text-secondary\">No recent activity</p>\r\n        <p className=\"text-xs md:text-sm text-text-secondary mt-1\">\r\n          Check-ins from your besties will appear here\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-3\">\r\n        {paginatedFeed.map((activity) => (\r\n          <div key={activity.id} className=\"card p-3 md:p-4\">\r\n            {activity.type === 'checkin' && (\r\n              <div>\r\n                <div className=\"flex items-start gap-2 md:gap-3\">\r\n                  <div className=\"text-2xl md:text-3xl flex-shrink-0\">\r\n                    {activity.checkInData.activity?.emoji || ''}\r\n                  </div>\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <h3 className=\"font-semibold text-text-primary text-sm md:text-base break-words\">\r\n                      <button\r\n                        onClick={() => navigate(`/user/${activity.userId}`)}\r\n                        className=\"text-primary hover:underline font-semibold\"\r\n                      >\r\n                        {activity.userName}\r\n                      </button>\r\n                      {activity.status === 'completed' && ' completed check-in safely '}\r\n                      {activity.status === 'active' && ' is currently checked in '}\r\n                      {activity.status === 'alerted' && ' MISSED check-in '}\r\n                    </h3>\r\n                    <p className=\"text-xs md:text-sm text-text-secondary\">\r\n                      {activity.checkInData.activity?.name || 'Check-in'}  {\r\n                        getTimeAgo(activity.timestamp)\r\n                      }\r\n                    </p>\r\n                    {activity.checkInData.location?.address && (\r\n                      <p className=\"text-xs md:text-sm text-text-secondary mt-1 break-words\">\r\n                         {activity.checkInData.location.address}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  <div className={`px-2 md:px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap flex-shrink-0 ${\r\n                    activity.status === 'completed'\r\n                      ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                      : activity.status === 'alerted'\r\n                      ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                      : 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300'\r\n                  }`}>\r\n                    {activity.status === 'completed' && ''}\r\n                    {activity.status === 'alerted' && ''}\r\n                    {activity.status === 'active' && ''}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Reactions - Always show for non-alerted check-ins */}\r\n                {activity.status !== 'alerted' && (\r\n                  <div className=\"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700\">\r\n                    {/* Reaction and comment counts - Always visible */}\r\n                    <div className=\"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 mb-2\">\r\n                      {['', '', ''].map(emoji => {\r\n                        const count = reactions[activity.id]?.filter(r => r.emoji === emoji).length || 0;\r\n                        return (\r\n                          <button\r\n                            key={emoji}\r\n                            onClick={() => addReaction(activity.id, emoji)}\r\n                            className={`flex items-center gap-1 px-2 py-1 rounded-full transition-all hover:scale-105 ${\r\n                              count > 0\r\n                                ? 'bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400'\r\n                                : 'bg-gray-100 dark:bg-gray-700 hover:bg-pink-50 dark:hover:bg-pink-900/20'\r\n                            }`}\r\n                          >\r\n                            <span className=\"text-base\">{emoji}</span>\r\n                            {count > 0 && <span className=\"font-semibold\">{count}</span>}\r\n                          </button>\r\n                        );\r\n                      })}\r\n                      <button\r\n                        onClick={() => {\r\n                          setSelectedCheckIn(activity);\r\n                          setShowComments(true);\r\n                        }}\r\n                        className={`ml-auto flex items-center gap-1 px-2 py-1 rounded-full transition-all hover:scale-105 ${\r\n                          activity.checkInData?.commentCount > 0\r\n                            ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400'\r\n                            : 'bg-gray-100 dark:bg-gray-700 hover:bg-purple-50 dark:hover:bg-purple-900/20 text-gray-600 dark:text-gray-400'\r\n                        }`}\r\n                      >\r\n                        <span className=\"text-base\"></span>\r\n                        <span className=\"font-semibold\">{activity.checkInData?.commentCount || 0}</span>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {activity.type === 'badge' && (\r\n              <div className=\"flex items-start gap-2 md:gap-3\">\r\n                <div className=\"text-2xl md:text-3xl flex-shrink-0\">{activity.badge.icon || ''}</div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <h3 className=\"font-semibold text-text-primary text-sm md:text-base break-words\">\r\n                    <button\r\n                      onClick={() => navigate(`/user/${activity.userId}`)}\r\n                      className=\"text-primary hover:underline font-semibold\"\r\n                    >\r\n                      {activity.userName}\r\n                    </button>\r\n                    {' earned the '}<span className=\"text-yellow-600\">{activity.badge.name}</span> badge! \r\n                  </h3>\r\n                  <p className=\"text-xs md:text-sm text-text-secondary\">\r\n                    {getTimeAgo(activity.timestamp)}\r\n                  </p>\r\n                  {activity.badge.description && (\r\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\r\n                      {activity.badge.description}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-3xl flex-shrink-0 animate-bounce-gentle\">\r\n                  \r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {activity.type === 'post' && (\r\n              <div>\r\n                {/* Support Request - Special styling */}\r\n                {activity.postData.isSupportRequest ? (\r\n                  <div className=\"bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl p-4 border-2 border-pink-300 dark:border-pink-600\">\r\n                    <div className=\"flex items-start gap-2 md:gap-3 mb-3\">\r\n                      {activity.postData.userPhoto ? (\r\n                        <img\r\n                          src={activity.postData.userPhoto}\r\n                          alt={activity.userName}\r\n                          className=\"w-12 h-12 rounded-full object-cover flex-shrink-0 ring-2 ring-pink-300 dark:ring-pink-600\"\r\n                        />\r\n                      ) : (\r\n                        <div className=\"w-12 h-12 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display flex-shrink-0 ring-2 ring-pink-300 dark:ring-pink-600\">\r\n                          {activity.userName?.[0] || '?'}\r\n                        </div>\r\n                      )}\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center gap-2 mb-1\">\r\n                          <h3 className=\"font-bold text-text-primary text-sm md:text-base\">\r\n                            {activity.userName}\r\n                          </h3>\r\n                          <span className=\"text-lg\"></span>\r\n                        </div>\r\n                        <p className=\"text-xs font-semibold text-pink-600 dark:text-pink-400 uppercase tracking-wide\">\r\n                          Requesting Support\r\n                        </p>\r\n                        <p className=\"text-xs md:text-sm text-text-secondary mt-1\">\r\n                          {getTimeAgo(activity.timestamp)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Support request content */}\r\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3\">\r\n                      <p className=\"text-base md:text-lg font-semibold text-center text-gray-900 dark:text-gray-100 mb-2\">\r\n                        {activity.postData.supportTag}\r\n                      </p>\r\n                      <p className=\"text-sm text-center text-gray-600 dark:text-gray-400\">\r\n                        Reach out if you can help! \r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* Quick action buttons */}\r\n                    <div className=\"flex gap-2\">\r\n                      <a\r\n                        href={`sms:${activity.postData.userPhone || ''}`}\r\n                        className=\"flex-1 btn btn-sm bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white font-semibold py-2 flex items-center justify-center gap-2\"\r\n                      >\r\n                        <span></span>\r\n                        <span>Send Message</span>\r\n                      </a>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  /* Regular post */\r\n                  <>\r\n                    <div className=\"flex items-start gap-2 md:gap-3 mb-3\">\r\n                      {activity.postData.userPhoto ? (\r\n                        <img\r\n                          src={activity.postData.userPhoto}\r\n                          alt={activity.userName}\r\n                          className=\"w-10 h-10 rounded-full object-cover flex-shrink-0\"\r\n                        />\r\n                      ) : (\r\n                        <div className=\"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display flex-shrink-0\">\r\n                          {activity.userName?.[0] || '?'}\r\n                        </div>\r\n                      )}\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <h3 className=\"font-semibold text-text-primary text-sm md:text-base\">\r\n                          <button\r\n                            onClick={() => navigate(`/user/${activity.userId}`)}\r\n                            className=\"text-primary hover:underline font-semibold\"\r\n                          >\r\n                            {activity.userName}\r\n                          </button>\r\n                        </h3>\r\n                        <p className=\"text-xs md:text-sm text-text-secondary\">\r\n                          {getTimeAgo(activity.timestamp)}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"text-xl flex-shrink-0\"></div>\r\n                    </div>\r\n\r\n                    {/* Post Content */}\r\n                    {activity.postData.text && (\r\n                      <p className=\"text-sm md:text-base text-text-primary mb-3 whitespace-pre-wrap break-words\">\r\n                        {activity.postData.text}\r\n                      </p>\r\n                    )}\r\n\r\n                    {/* Post Photo */}\r\n                    {activity.postData.photoURL && (\r\n                      <img\r\n                        src={activity.postData.photoURL}\r\n                        alt=\"Post\"\r\n                        className=\"w-full rounded-xl mb-2 max-h-96 object-cover\"\r\n                      />\r\n                    )}\r\n\r\n                    {/* Post Reactions and Comments - Side by Side */}\r\n                    <div className=\"flex items-center justify-between mt-1\">\r\n                      <PostReactions\r\n                        postId={activity.id}\r\n                        initialCounts={activity.postData.reactionCounts}\r\n                      />\r\n\r\n                      {/* Comments Button on Right */}\r\n                      <button\r\n                        onClick={() => setShowPostComments(activity.id)}\r\n                        className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 hover:text-primary transition-colors\"\r\n                      >\r\n                        <span></span>\r\n                        <span>\r\n                          {activity.postData.commentCount > 0\r\n                            ? `${activity.postData.commentCount} ${activity.postData.commentCount === 1 ? 'comment' : 'comments'}`\r\n                            : 'Add a comment'\r\n                          }\r\n                        </span>\r\n                      </button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Pagination */}\r\n      {totalPages > 1 && (\r\n        <div className=\"flex items-center justify-center gap-2 mt-6\">\r\n          <button\r\n            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n            disabled={currentPage === 1}\r\n            className=\"px-3 py-2 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-semibold text-sm disabled:opacity-40 disabled:cursor-not-allowed hover:bg-purple-200 dark:hover:bg-purple-800/40 transition-colors\"\r\n          >\r\n             Prev\r\n          </button>\r\n          \r\n          <div className=\"flex items-center gap-1\">\r\n            {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (\r\n              <button\r\n                key={page}\r\n                onClick={() => setCurrentPage(page)}\r\n                className={`w-8 h-8 rounded-full text-sm font-semibold transition-all ${\r\n                  currentPage === page\r\n                    ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white shadow-md'\r\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-purple-100 dark:hover:bg-purple-900/30'\r\n                }`}\r\n              >\r\n                {page}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          <button\r\n            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n            disabled={currentPage === totalPages}\r\n            className=\"px-3 py-2 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-semibold text-sm disabled:opacity-40 disabled:cursor-not-allowed hover:bg-purple-200 dark:hover:bg-purple-800/40 transition-colors\"\r\n          >\r\n            Next \r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Post Comments Modal */}\r\n      {showPostComments && (\r\n        <PostComments\r\n          postId={showPostComments}\r\n          onClose={() => setShowPostComments(null)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ActivityFeed;\r\n","import React from 'react';\r\n\r\nconst ActivityFeedSkeleton = () => {\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-lg md:text-xl font-display text-text-primary mb-3\">\r\n         Activity Feed\r\n      </h2>\r\n\r\n      <div className=\"space-y-3\">\r\n        {[1, 2, 3, 4, 5].map((i) => (\r\n          <div key={i} className=\"card p-3 md:p-4 animate-pulse\">\r\n            <div className=\"flex items-start gap-2 md:gap-3\">\r\n              {/* Icon skeleton */}\r\n              <div className=\"w-8 h-8 md:w-10 md:h-10 bg-gray-200 dark:bg-gray-700 rounded-full flex-shrink-0\"></div>\r\n\r\n              {/* Content skeleton */}\r\n              <div className=\"flex-1 min-w-0\">\r\n                {/* Title line */}\r\n                <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2\"></div>\r\n                {/* Subtitle line */}\r\n                <div className=\"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-2\"></div>\r\n                {/* Optional third line */}\r\n                {i % 2 === 0 && (\r\n                  <div className=\"h-3 bg-gray-200 dark:bg-gray-700 rounded w-2/3\"></div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Badge skeleton */}\r\n              <div className=\"w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full flex-shrink-0\"></div>\r\n            </div>\r\n\r\n            {/* Reactions skeleton */}\r\n            {i % 3 !== 0 && (\r\n              <div className=\"mt-3 flex gap-2\">\r\n                <div className=\"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                <div className=\"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n                <div className=\"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full\"></div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ActivityFeedSkeleton;\r\n","import React from 'react';\r\n\r\nconst EmptyState = ({ besties, pendingRequests, onAddBestie }) => {\r\n  // Only show empty state when there are no besties AND no pending requests\r\n  if ((besties && besties.length > 0) || (pendingRequests && pendingRequests.length > 0)) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"card p-8 md:p-12 text-center\">\r\n      <div className=\"text-5xl md:text-6xl mb-4\"></div>\r\n      <h2 className=\"text-xl md:text-2xl font-display text-text-primary mb-2\">\r\n        No besties yet!\r\n      </h2>\r\n      <p className=\"text-sm md:text-base text-text-secondary mb-6\">\r\n        Add friends who'll have your back when you need them\r\n      </p>\r\n      <button\r\n        onClick={onAddBestie}\r\n        className=\"btn btn-primary\"\r\n      >\r\n        Add Your First Bestie\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmptyState;\r\n","import React, { useState } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { db } from '../services/firebase';\r\nimport { collection, addDoc, Timestamp } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { storage } from '../services/firebase';\r\nimport { logAnalyticsEvent } from '../services/firebase';\r\nimport toast from 'react-hot-toast';\r\nimport haptic from '../utils/hapticFeedback';\r\nimport { sanitizeUserInput } from '../utils/sanitize';\r\n\r\nconst CreatePostModal = ({ onClose, onPostCreated }) => {\r\n  const { currentUser, userData } = useAuth();\r\n  const [text, setText] = useState('');\r\n  const [photo, setPhoto] = useState(null);\r\n  const [photoPreview, setPhotoPreview] = useState(null);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const handlePhotoChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast.error('Photo must be less than 5MB');\r\n        return;\r\n      }\r\n      setPhoto(file);\r\n      setPhotoPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!text.trim() && !photo) {\r\n      toast.error('Please add some text or a photo');\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    haptic.light();\r\n\r\n    try {\r\n      let photoURL = null;\r\n\r\n      // Upload photo if provided\r\n      if (photo) {\r\n        const photoRef = ref(storage, `posts/${currentUser.uid}/${Date.now()}_${photo.name}`);\r\n        await uploadBytes(photoRef, photo);\r\n        photoURL = await getDownloadURL(photoRef);\r\n      }\r\n\r\n      // Sanitize user input to prevent XSS attacks\r\n      const sanitizedText = sanitizeUserInput(text.trim(), 5000); // Max 5000 chars for posts\r\n\r\n      // Create post in Firestore\r\n      await addDoc(collection(db, 'posts'), {\r\n        userId: currentUser.uid,\r\n        userName: userData?.displayName || 'Anonymous',\r\n        userPhoto: userData?.photoURL || null,\r\n        text: sanitizedText,\r\n        photoURL: photoURL,\r\n        createdAt: Timestamp.now(),\r\n        // Denormalize bestieUserIds for efficient Firestore rules\r\n        bestieUserIds: userData?.bestieUserIds || {},\r\n        reactionCounts: {\r\n          heart: 0,\r\n          laugh: 0,\r\n          fire: 0\r\n        },\r\n        commentCount: 0\r\n      });\r\n\r\n      // Track analytics\r\n      logAnalyticsEvent('post_created', {\r\n        has_photo: !!photoURL,\r\n        has_text: !!text.trim(),\r\n        text_length: text.trim().length\r\n      });\r\n\r\n      toast.success('Post created! ');\r\n      haptic.success();\r\n      onPostCreated?.();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error creating post:', error);\r\n      toast.error('Failed to create post');\r\n      haptic.error();\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\" onClick={onClose}>\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto\" onClick={(e) => e.stopPropagation()}>\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-2xl font-display text-gradient\">\r\n             Create a Post\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n\r\n        {/* Description */}\r\n        <p className=\"text-text-secondary mb-4\">\r\n          Share what's on your mind with your besties \r\n        </p>\r\n\r\n        {/* Text Input */}\r\n        <textarea\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          placeholder=\"What's happening?\"\r\n          className=\"w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-gray-600 focus:border-primary focus:outline-none resize-none text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 mb-4\"\r\n          rows={4}\r\n          maxLength={500}\r\n        />\r\n        <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-4\">\r\n          {text.length}/500 characters\r\n        </p>\r\n\r\n        {/* Photo Upload */}\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-sm font-semibold text-text-primary mb-2\">\r\n            Add a Photo (optional)\r\n          </label>\r\n          {photoPreview ? (\r\n            <div className=\"relative\">\r\n              <img\r\n                src={photoPreview}\r\n                alt=\"Preview\"\r\n                className=\"w-full h-48 object-cover rounded-xl border-2 border-gray-200 dark:border-gray-600\"\r\n              />\r\n              <button\r\n                onClick={() => {\r\n                  setPhoto(null);\r\n                  setPhotoPreview(null);\r\n                }}\r\n                className=\"absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors\"\r\n              >\r\n                \r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <label className=\"flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:border-primary hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-4xl mb-2\"></div>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  Click to upload a photo\r\n                </p>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">\r\n                  Max 5MB\r\n                </p>\r\n              </div>\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handlePhotoChange}\r\n                className=\"hidden\"\r\n              />\r\n            </label>\r\n          )}\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            onClick={onClose}\r\n            disabled={uploading}\r\n            className=\"flex-1 btn btn-secondary\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleSubmit}\r\n            disabled={uploading || (!text.trim() && !photo)}\r\n            className=\"flex-1 btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {uploading ? 'Posting...' : 'Post'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreatePostModal;\r\n","import React from 'react';\r\n\r\nconst BestiesLeaderboard = ({ rankingsPeriod, setRankingsPeriod }) => {\r\n  return (\r\n    <div className=\"card p-4 bg-white dark:bg-gray-800 border border-pink-100 dark:border-pink-900/30\">\r\n      {/* Header */}\r\n      <div className=\"text-center mb-4\">\r\n        <span className=\"text-3xl\"></span>\r\n        <h2 className=\"text-lg font-display text-pink-500 dark:text-pink-400 mt-1\">\r\n          {rankingsPeriod === 'weekly' && \"This Week's Queens\"}\r\n          {rankingsPeriod === 'monthly' && \"This Month's Queens\"}\r\n          {rankingsPeriod === 'yearly' && \"This Year's Queens\"}\r\n        </h2>\r\n        <p className=\"text-xs text-gray-400 dark:text-gray-500\">your amazing squad </p>\r\n      </div>\r\n\r\n      {/* Period Tabs */}\r\n      <div className=\"flex gap-1 justify-center mb-4\">\r\n        {[\r\n          { id: 'weekly', label: 'Week' },\r\n          { id: 'monthly', label: 'Month' },\r\n          { id: 'yearly', label: 'Year' }\r\n        ].map(({ id, label }) => (\r\n          <button\r\n            key={id}\r\n            onClick={() => setRankingsPeriod(id)}\r\n            className={`px-3 py-1 rounded-full text-xs font-medium transition-all ${\r\n              rankingsPeriod === id\r\n                ? 'bg-pink-500 text-white'\r\n                : 'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 hover:bg-pink-100 dark:hover:bg-pink-900/20'\r\n            }`}\r\n          >\r\n            {label}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Queen Cards */}\r\n      <div className=\"space-y-2\">\r\n        {/* Most Reliable */}\r\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-pink-50 dark:bg-pink-900/20 border border-pink-100 dark:border-pink-800/30\">\r\n          <div className=\"w-9 h-9 rounded-full bg-pink-100 dark:bg-pink-800/40 flex items-center justify-center text-lg\">\r\n            \r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"font-semibold text-sm text-pink-600 dark:text-pink-400\">Most Reliable</p>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">always there for you</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Super Speedy */}\r\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800/30\">\r\n          <div className=\"w-9 h-9 rounded-full bg-purple-100 dark:bg-purple-800/40 flex items-center justify-center text-lg\">\r\n            \r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"font-semibold text-sm text-purple-600 dark:text-purple-400\">Super Speedy</p>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">quick to the rescue</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Guardian Angel */}\r\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-rose-50 dark:bg-rose-900/20 border border-rose-100 dark:border-rose-800/30\">\r\n          <div className=\"w-9 h-9 rounded-full bg-rose-100 dark:bg-rose-800/40 flex items-center justify-center text-lg\">\r\n            \r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"font-semibold text-sm text-rose-600 dark:text-rose-400\">Guardian Angel</p>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">keeping you safe</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Streak Queen */}\r\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800/30\">\r\n          <div className=\"w-9 h-9 rounded-full bg-amber-100 dark:bg-amber-800/40 flex items-center justify-center text-lg\">\r\n            \r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"font-semibold text-sm text-amber-600 dark:text-amber-400\">Streak Queen</p>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">on fire lately</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"mt-3 pt-2 border-t border-gray-100 dark:border-gray-700 text-center\">\r\n        <p className=\"text-xs text-gray-400\">\r\n          {rankingsPeriod === 'weekly' && 'resets every monday '}\r\n          {rankingsPeriod === 'monthly' && 'resets on the 1st '}\r\n          {rankingsPeriod === 'yearly' && 'resets jan 1st '}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BestiesLeaderboard;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { db } from '../services/firebase';\r\nimport { doc, getDoc, updateDoc, deleteDoc } from 'firebase/firestore';\r\nimport toast from 'react-hot-toast';\r\nimport ProfileWithBubble from './ProfileWithBubble';\r\nimport { useDarkMode } from '../contexts/DarkModeContext';\r\n\r\nconst BestieCard = ({ bestie, onRemove }) => {\r\n  const { isDark } = useDarkMode();\r\n  const navigate = useNavigate();\r\n  const [userPhoto, setUserPhoto] = useState(null);\r\n  const [requestAttention, setRequestAttention] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showProfileMenu, setShowProfileMenu] = useState(false);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [deleteChallenge, setDeleteChallenge] = useState('');\r\n  const menuRef = useRef(null);\r\n\r\n  // Fetch user's profile photo and request attention status\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n      if (!bestie?.userId) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const userDoc = await getDoc(doc(db, 'users', bestie.userId));\r\n        if (userDoc.exists()) {\r\n          const userData = userDoc.data();\r\n          setUserPhoto(userData.photoURL);\r\n          setRequestAttention(userData.requestAttention);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching user data:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchUserData();\r\n  }, [bestie?.userId]);\r\n\r\n  // Close menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (e) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target)) {\r\n        setShowProfileMenu(false);\r\n      }\r\n    };\r\n\r\n    if (showProfileMenu) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }\r\n  }, [showProfileMenu]);\r\n\r\n  const handleToggleCircle = async (e) => {\r\n    e.stopPropagation();\r\n    setShowProfileMenu(false);\r\n\r\n    try {\r\n      await updateDoc(doc(db, 'besties', bestie.id), {\r\n        isFavorite: !bestie.isFavorite,\r\n      });\r\n      toast.success(bestie.isFavorite ? 'Removed from circle' : 'Added to circle!');\r\n    } catch (error) {\r\n      console.error('Error toggling circle:', error);\r\n      toast.error('Failed to update circle');\r\n    }\r\n  };\r\n\r\n  const handleRemove = async () => {\r\n    const expectedPhrases = ['see ya', 'bye bye'];\r\n    const normalized = deleteChallenge.toLowerCase().trim();\r\n\r\n    if (!expectedPhrases.includes(normalized)) {\r\n      toast.error(`Please type \"${expectedPhrases[0]}\" or \"${expectedPhrases[1]}\" to confirm`);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await deleteDoc(doc(db, 'besties', bestie.id));\r\n      toast.success('Bestie removed');\r\n      setShowDeleteModal(false);\r\n      if (onRemove) onRemove(bestie.id);\r\n    } catch (error) {\r\n      console.error('Error removing bestie:', error);\r\n      toast.error('Failed to remove bestie');\r\n    }\r\n  };\r\n\r\n  // Safety check: return null if bestie is undefined/null\r\n  if (!bestie) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Redesigned Bestie Card with gradient aesthetic */}\r\n      <div className=\"relative group\">\r\n        {/* Gradient glow effect */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-pink-300 via-purple-300 to-pink-300 rounded-2xl blur opacity-20 group-hover:opacity-40 transition-opacity\"></div>\r\n\r\n        <div className=\"relative card p-5 bg-gradient-to-br from-pink-50/50 via-purple-50/50 to-pink-50/50 dark:from-pink-900/10 dark:via-purple-900/10 dark:to-pink-900/10 border-2 border-pink-200 dark:border-pink-600 hover:shadow-xl transition-all hover:transform hover:-translate-y-1 min-h-[280px] flex flex-col\">\r\n          {/* Circle badge - top right */}\r\n          {bestie.isFavorite && (\r\n            <div className=\"absolute top-3 right-3\">\r\n              <div className=\"bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-lg flex items-center gap-1\">\r\n                 Circle\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Profile section */}\r\n          <div className=\"text-center mb-4 flex-1 flex flex-col justify-center\">\r\n            {loading ? (\r\n              <div className=\"w-20 h-20 bg-gradient-to-br from-pink-200 to-purple-200 animate-pulse rounded-full mx-auto mb-3\"></div>\r\n            ) : (\r\n              <div className=\"relative inline-block\" ref={menuRef}>\r\n                {/* Click on profile picture to show menu */}\r\n                <div\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    setShowProfileMenu(!showProfileMenu);\r\n                  }}\r\n                  className=\"cursor-pointer\"\r\n                >\r\n                  <ProfileWithBubble\r\n                    photoURL={userPhoto}\r\n                    name={bestie.name || bestie.phone || 'Unknown'}\r\n                    requestAttention={requestAttention}\r\n                    size=\"xl\"\r\n                    showBubble={true}\r\n                  />\r\n                </div>\r\n\r\n                {/* Dropdown Menu - appears below profile picture */}\r\n                {showProfileMenu && (\r\n                  <div className={`absolute top-full left-1/2 -translate-x-1/2 mt-2 ${isDark ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} rounded-xl shadow-2xl border-2 z-50 min-w-[180px]`}>\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setShowProfileMenu(false);\r\n                        navigate(`/user/${bestie.userId}`);\r\n                      }}\r\n                      className={`w-full text-left px-4 py-2.5 ${isDark ? 'hover:bg-gray-700 text-gray-100' : 'hover:bg-gray-100 text-gray-700'} text-sm font-semibold first:rounded-t-xl`}\r\n                    >\r\n                       View Profile\r\n                    </button>\r\n                    <button\r\n                      onClick={handleToggleCircle}\r\n                      className={`w-full text-left px-4 py-2.5 ${isDark ? 'hover:bg-gray-700 text-gray-100' : 'hover:bg-gray-100 text-gray-700'} text-sm font-semibold`}\r\n                    >\r\n                      {bestie.isFavorite ? ' Remove from Circle' : ' Add to Circle'}\r\n                    </button>\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        const phone = bestie.phone;\r\n                        if (phone) {\r\n                          window.location.href = `sms:${phone}`;\r\n                        } else {\r\n                          toast.error('No phone number available');\r\n                        }\r\n                        setShowProfileMenu(false);\r\n                      }}\r\n                      className={`w-full text-left px-4 py-2.5 ${isDark ? 'hover:bg-gray-700 text-gray-100' : 'hover:bg-gray-100 text-gray-700'} text-sm font-semibold`}\r\n                    >\r\n                       Send Message\r\n                    </button>\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setShowProfileMenu(false);\r\n                        setShowDeleteModal(true);\r\n                      }}\r\n                      className={`w-full text-left px-4 py-2.5 ${isDark ? 'hover:bg-red-900/30' : 'hover:bg-red-50'} text-sm font-semibold text-red-600 last:rounded-b-xl`}\r\n                    >\r\n                       Delete Bestie\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Name */}\r\n            <div\r\n              className=\"cursor-pointer mt-3\"\r\n              onClick={() => bestie.userId && navigate(`/user/${bestie.userId}`)}\r\n            >\r\n              <h3 className=\"font-display text-lg font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent truncate\">\r\n                {bestie.name || 'Unknown'}\r\n              </h3>\r\n              {bestie.phone && (\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5\">\r\n                  {bestie.phone}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Placeholder for indicators - will be added by parent */}\r\n          <div className=\"bestie-indicators-slot\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className={`${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl max-w-md w-full p-6`}>\r\n            <h2 className={`text-2xl font-display ${isDark ? 'text-gray-100' : 'text-text-primary'} mb-2`}>Remove Bestie?</h2>\r\n            <p className=\"text-text-secondary mb-4\">\r\n              Are you sure you want to remove <strong>{bestie.name || bestie.phone}</strong> from your besties?\r\n            </p>\r\n\r\n            <div className={`${isDark ? 'bg-yellow-900/30 border-yellow-700' : 'bg-yellow-50 border-yellow-200'} border rounded-lg p-3 mb-4`}>\r\n              <p className={`text-sm ${isDark ? 'text-yellow-300' : 'text-yellow-800'} mb-2`}>\r\n                 Type <strong>\"see ya\"</strong> or <strong>\"bye bye\"</strong> to confirm\r\n              </p>\r\n              <input\r\n                type=\"text\"\r\n                value={deleteChallenge}\r\n                onChange={(e) => setDeleteChallenge(e.target.value)}\r\n                className={`w-full px-3 py-2 border-2 ${isDark ? 'border-yellow-600 bg-gray-700 text-gray-100 focus:border-yellow-500' : 'border-yellow-300 bg-white text-gray-900 focus:border-yellow-500'} rounded-lg focus:outline-none`}\r\n                placeholder=\"Type here...\"\r\n                autoFocus\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowDeleteModal(false);\r\n                  setDeleteChallenge('');\r\n                }}\r\n                className=\"flex-1 btn btn-secondary\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleRemove}\r\n                className=\"flex-1 btn bg-red-500 text-white hover:bg-red-600\"\r\n              >\r\n                Remove\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BestieCard;\r\n","import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport BestieCard from '../BestieCard';\r\nimport toast from 'react-hot-toast';\r\nimport { db } from '../../services/firebase';\r\nimport { doc, deleteDoc } from 'firebase/firestore';\r\n\r\nconst BestiesGrid = ({ besties, activityFeed }) => {\r\n  const navigate = useNavigate();\r\n  const [selectedBestie, setSelectedBestie] = useState(null);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [bestieToDelete, setBestieToDelete] = useState(null);\r\n  const [deleteChallenge, setDeleteChallenge] = useState('');\r\n  const [showLegend, setShowLegend] = useState(false);\r\n\r\n  // Handle delete bestie\r\n  const handleDeleteBestie = async () => {\r\n    const expectedPhrases = ['see ya', 'bye bye'];\r\n    const normalized = deleteChallenge.toLowerCase().trim();\r\n\r\n    if (!expectedPhrases.includes(normalized)) {\r\n      toast.error(`Please type \"${expectedPhrases[0]}\" or \"${expectedPhrases[1]}\" to confirm`);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await deleteDoc(doc(db, 'besties', bestieToDelete.id));\r\n      toast.success('Bestie removed');\r\n      setShowDeleteModal(false);\r\n      setBestieToDelete(null);\r\n      setDeleteChallenge('');\r\n      setSelectedBestie(null);\r\n      // Refresh page to update the list\r\n      window.location.reload();\r\n    } catch (error) {\r\n      console.error('Error removing bestie:', error);\r\n      toast.error('Failed to remove bestie');\r\n    }\r\n  };\r\n\r\n  // Get visual indicators for a bestie based on actual activity data\r\n  const getBestieIndicators = (bestie) => {\r\n    const indicators = [];\r\n    const bestieActivities = activityFeed.filter(a => a.userId === bestie.userId);\r\n\r\n    // Only show indicators based on actual earned criteria\r\n    \r\n    // Fast responder - responded to an alert in last hour\r\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\r\n    const hasRecentResponse = bestieActivities.some(a => \r\n      a.type === 'checkin' && a.timestamp > oneHourAgo\r\n    );\r\n    if (hasRecentResponse) {\r\n      indicators.push({ icon: '', tooltip: 'Active recently' });\r\n    }\r\n\r\n    // Reliable - has completed 5+ check-ins visible in feed\r\n    const completedCount = bestieActivities.filter(a => \r\n      a.type === 'checkin' && a.status === 'completed'\r\n    ).length;\r\n    if (completedCount >= 5) {\r\n      indicators.push({ icon: '', tooltip: 'Very reliable' });\r\n    }\r\n\r\n    // Night owl - has 3+ night check-ins (9pm-6am)\r\n    const nightCheckIns = bestieActivities.filter(a => {\r\n      if (a.type !== 'checkin' || !a.timestamp) return false;\r\n      const hour = a.timestamp.getHours?.() ?? new Date(a.timestamp).getHours();\r\n      return hour >= 21 || hour <= 6;\r\n    });\r\n    if (nightCheckIns.length >= 3) {\r\n      indicators.push({ icon: '', tooltip: 'Night owl' });\r\n    }\r\n\r\n    return indicators.slice(0, 3);\r\n  };\r\n\r\n  return (\r\n    <div id=\"all-besties-section\">\r\n      <div className=\"flex items-center justify-between mb-3 md:mb-4\">\r\n        <h2 className=\"text-lg md:text-xl font-display text-text-primary\">\r\n          All Besties\r\n        </h2>\r\n        \r\n        {/* Legend Button */}\r\n        <div className=\"relative\">\r\n          <button\r\n            onClick={() => setShowLegend(!showLegend)}\r\n            className=\"flex items-center gap-1 px-3 py-1.5 rounded-full bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 text-xs font-semibold hover:bg-pink-200 dark:hover:bg-pink-800/40 transition-colors\"\r\n          >\r\n            <span></span>\r\n            <span>Symbols</span>\r\n          </button>\r\n          \r\n          {/* Legend Tooltip */}\r\n          {showLegend && (\r\n            <>\r\n              <div className=\"fixed inset-0 z-40\" onClick={() => setShowLegend(false)} />\r\n              <div className=\"absolute right-0 top-full mt-2 z-50 bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-950 dark:to-rose-950 rounded-xl p-4 shadow-xl border border-pink-200 dark:border-pink-800 min-w-[200px]\">\r\n                <h4 className=\"font-semibold text-sm text-pink-600 dark:text-pink-400 mb-3\">Symbol Guide </h4>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\"></span>\r\n                    <span className=\"text-gray-700 dark:text-gray-300\">Fast responder</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\"></span>\r\n                    <span className=\"text-gray-700 dark:text-gray-300\">Very reliable</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\"></span>\r\n                    <span className=\"text-gray-700 dark:text-gray-300\">On a streak</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\"></span>\r\n                    <span className=\"text-gray-700 dark:text-gray-300\">Night owl</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-lg\"></span>\r\n                    <span className=\"text-gray-700 dark:text-gray-300\">Mutual bestie</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {besties.length === 0 ? (\r\n        <div className=\"card p-6 md:p-8 text-center bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/30 dark:to-pink-900/30\">\r\n          <div className=\"text-5xl md:text-6xl mb-3\"></div>\r\n          <p className=\"text-base md:text-lg font-semibold text-text-primary mb-2\">No besties yet</p>\r\n          <p className=\"text-sm md:text-base text-text-secondary\">\r\n            Start adding besties to see them here\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-5\">\r\n          {besties.map((bestie) => {\r\n            const indicators = getBestieIndicators(bestie);\r\n            const isMenuOpen = selectedBestie === bestie.id;\r\n\r\n              return (\r\n              <div key={bestie.id} className=\"relative group\">\r\n                {/* Main card with improved styling - clickable */}\r\n                <div\r\n                  className=\"h-full transform transition-all duration-300 hover:scale-[1.02] cursor-pointer\"\r\n                  onClick={() => setSelectedBestie(isMenuOpen ? null : bestie.id)}\r\n                >\r\n                  <BestieCard bestie={bestie} />\r\n                  \r\n                  {/* Visual Indicators - Bottom Center */}\r\n                  {indicators.length > 0 && (\r\n                    <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1 z-10 pointer-events-none\">\r\n                      {indicators.map((indicator, idx) => (\r\n                        <span\r\n                          key={idx}\r\n                          className=\"text-sm bg-white/90 dark:bg-gray-800/90 rounded-full px-2 py-1 shadow-md border border-purple-200 dark:border-purple-600\"\r\n                          title={indicator.tooltip}\r\n                        >\r\n                          {indicator.icon}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Quick Action Overlay - Shows on click */}\r\n                {isMenuOpen && (\r\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-purple-900/95 to-transparent rounded-2xl flex items-end p-4 z-20\">\r\n                    <div className=\"w-full space-y-2\">\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          navigate(`/user/${bestie.userId}`);\r\n                        }}\r\n                        className=\"w-full bg-white dark:bg-gray-800 hover:bg-purple-50 dark:hover:bg-purple-900 text-purple-900 dark:text-purple-200 font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg\"\r\n                      >\r\n                        <span></span>\r\n                        <span>View Profile</span>\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          if (bestie.phone) {\r\n                            window.location.href = `sms:${bestie.phone}`;\r\n                          } else {\r\n                            toast.error('No phone number available');\r\n                          }\r\n                        }}\r\n                        className=\"w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg\"\r\n                      >\r\n                        <span></span>\r\n                        <span>Message</span>\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setBestieToDelete(bestie);\r\n                          setShowDeleteModal(true);\r\n                          setSelectedBestie(null);\r\n                        }}\r\n                        className=\"w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg\"\r\n                      >\r\n                        <span></span>\r\n                        <span>Delete</span>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && bestieToDelete && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6\">\r\n            <h2 className=\"text-2xl font-display text-text-primary dark:text-gray-100 mb-2\">Remove Bestie?</h2>\r\n            <p className=\"text-text-secondary mb-4\">\r\n              Are you sure you want to remove <strong>{bestieToDelete.name || bestieToDelete.phone}</strong> from your besties?\r\n            </p>\r\n\r\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3 mb-4\">\r\n              <p className=\"text-sm text-yellow-800 dark:text-yellow-300 mb-2\">\r\n                 Type <strong>\"see ya\"</strong> or <strong>\"bye bye\"</strong> to confirm\r\n              </p>\r\n              <input\r\n                type=\"text\"\r\n                value={deleteChallenge}\r\n                onChange={(e) => setDeleteChallenge(e.target.value)}\r\n                className=\"w-full px-3 py-2 border-2 border-yellow-300 dark:border-yellow-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:border-yellow-500 rounded-lg focus:outline-none\"\r\n                placeholder=\"Type here...\"\r\n                autoFocus\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowDeleteModal(false);\r\n                  setBestieToDelete(null);\r\n                  setDeleteChallenge('');\r\n                }}\r\n                className=\"flex-1 btn btn-secondary\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleDeleteBestie}\r\n                className=\"flex-1 btn bg-red-500 text-white hover:bg-red-600\"\r\n              >\r\n                Remove\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BestiesGrid;\r\n","import React from 'react';\r\n\r\nconst getTimeAgo = (timestamp) => {\r\n  const now = new Date();\r\n  const diffMs = now - timestamp;\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  const diffHours = Math.floor(diffMs / 3600000);\r\n  const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n  if (diffMins < 1) return 'Just now';\r\n  if (diffMins < 60) return `${diffMins} min ago`;\r\n  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n  return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n};\r\n\r\nconst CommentsModal = ({\r\n  selectedCheckIn,\r\n  comments,\r\n  newComment,\r\n  setNewComment,\r\n  onAddComment,\r\n  onClose\r\n}) => {\r\n  if (!selectedCheckIn) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-[200] flex items-end md:items-center justify-center pb-28 md:pb-0\">\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-t-2xl md:rounded-2xl max-w-md w-full max-h-[55vh] md:max-h-[600px] flex flex-col mb-4 md:mb-0\">\r\n        {/* Header */}\r\n        <div className=\"p-4 md:p-6 border-b border-gray-200 dark:border-gray-600 flex-shrink-0 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-xl md:text-2xl font-display text-transparent bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text\">\r\n               Comments\r\n            </h2>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors\"\r\n            >\r\n              \r\n            </button>\r\n          </div>\r\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n            {selectedCheckIn.userName}'s check-in\r\n          </p>\r\n        </div>\r\n\r\n        {/* Comments List - Scrollable */}\r\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 overscroll-contain\">\r\n          {comments.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <div className=\"text-5xl mb-3\"></div>\r\n              <p className=\"text-gray-500 dark:text-gray-400 text-sm font-semibold\">\r\n                No comments yet\r\n              </p>\r\n              <p className=\"text-gray-400 dark:text-gray-500 text-xs mt-1\">\r\n                Be the first to comment!\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            comments.map((comment) => (\r\n              <div key={comment.id} className=\"flex gap-3 animate-fade-in\">\r\n                {/* User Avatar */}\r\n                <div className=\"flex-shrink-0\">\r\n                  {comment.userPhoto ? (\r\n                    <img\r\n                      src={comment.userPhoto}\r\n                      alt={comment.userName}\r\n                      className=\"w-9 h-9 rounded-full object-cover ring-2 ring-purple-100 dark:ring-purple-600\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-9 h-9 bg-gradient-primary rounded-full flex items-center justify-center text-white text-sm font-display ring-2 ring-purple-100 dark:ring-purple-600\">\r\n                      {comment.userName?.[0] || '?'}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {/* Comment Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-2xl px-4 py-2 shadow-sm\">\r\n                    <p className=\"font-bold text-sm text-gray-900 dark:text-gray-200\">\r\n                      {comment.userName}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-700 dark:text-gray-300 break-words leading-relaxed\">\r\n                      {comment.text}\r\n                    </p>\r\n                  </div>\r\n                  <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1 px-3\">\r\n                    {comment.timestamp?.toDate ? getTimeAgo(comment.timestamp.toDate()) : 'Just now'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Add Comment Input - Fixed at bottom with safe area */}\r\n        <div className=\"p-4 md:p-6 border-t-2 border-purple-100 dark:border-purple-600 flex-shrink-0 bg-white dark:bg-gray-800\">\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              type=\"text\"\r\n              value={newComment}\r\n              onChange={(e) => setNewComment(e.target.value)}\r\n              onKeyPress={(e) => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  e.preventDefault();\r\n                  onAddComment();\r\n                }\r\n              }}\r\n              placeholder=\"Add a comment...\"\r\n              className=\"flex-1 px-4 py-3 rounded-full border-2 border-purple-200 dark:border-purple-600 focus:border-purple-400 dark:focus:border-purple-400 focus:outline-none text-sm shadow-sm transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200\"\r\n            />\r\n            <button\r\n              onClick={onAddComment}\r\n              disabled={!newComment.trim()}\r\n              className=\"btn btn-primary px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg transition-shadow\"\r\n            >\r\n              Send\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CommentsModal;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { db } from '../services/firebase';\r\nimport {\r\n  collection,\r\n  query,\r\n  where,\r\n  onSnapshot,\r\n  getDocs,\r\n  doc,\r\n  getDoc,\r\n  addDoc,\r\n  orderBy,\r\n  limit,\r\n  Timestamp\r\n} from 'firebase/firestore';\r\nimport AddBestieModal from '../components/AddBestieModal';\r\nimport PendingRequestsList from '../components/besties/PendingRequestsList';\r\nimport NeedsAttentionSection from '../components/besties/NeedsAttentionSection';\r\nimport ActivityFeed from '../components/besties/ActivityFeed';\r\nimport ActivityFeedSkeleton from '../components/besties/ActivityFeedSkeleton';\r\nimport EmptyState from '../components/besties/EmptyState';\r\nimport CreatePostModal from '../components/CreatePostModal';\r\nimport BestiesLeaderboard from '../components/besties/BestiesLeaderboard';\r\nimport BestiesGrid from '../components/besties/BestiesGrid';\r\nimport CommentsModal from '../components/besties/CommentsModal';\r\nimport FloatingNotificationBell from '../components/FloatingNotificationBell';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst BestiesPage = () => {\r\n  const location = useLocation();\r\n  const { currentUser, userData } = useAuth();\r\n  const [besties, setBesties] = useState([]);\r\n  const [pendingRequests, setPendingRequests] = useState([]);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [showCreatePostModal, setShowCreatePostModal] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Activity feed state\r\n  const [activityFeed, setActivityFeed] = useState([]);\r\n  const [activityLoading, setActivityLoading] = useState(true);\r\n  const [missedCheckIns, setMissedCheckIns] = useState([]);\r\n  const [requestsForAttention, setRequestsForAttention] = useState([]);\r\n\r\n  // Rankings period state (weekly, monthly, yearly)\r\n  const [rankingsPeriod, setRankingsPeriod] = useState('weekly');\r\n\r\n  // Modal state\r\n  const [selectedCheckIn, setSelectedCheckIn] = useState(null);\r\n  const [showComments, setShowComments] = useState(false);\r\n  const [selectedPostId, setSelectedPostId] = useState(null);\r\n  const [comments, setComments] = useState([]);\r\n  const [newComment, setNewComment] = useState('');\r\n  const [reactions, setReactions] = useState({}); // { checkInId: [reactions] }\r\n\r\n  // Handle opening post from notification\r\n  useEffect(() => {\r\n    if (location.state?.openPostId) {\r\n      setSelectedPostId(location.state.openPostId);\r\n      // Clear the state so it doesn't reopen on refresh\r\n      window.history.replaceState({}, document.title);\r\n    }\r\n  }, [location.state]);\r\n\r\n  // Load besties\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n\r\n    const requesterQuery = query(\r\n      collection(db, 'besties'),\r\n      where('requesterId', '==', currentUser.uid),\r\n      where('status', '==', 'accepted')\r\n    );\r\n\r\n    const recipientQuery = query(\r\n      collection(db, 'besties'),\r\n      where('recipientId', '==', currentUser.uid),\r\n      where('status', '==', 'accepted')\r\n    );\r\n\r\n    const unsubscribeRequester = onSnapshot(requesterQuery, (snapshot) => {\r\n      const bestiesList = [];\r\n\r\n      snapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        bestiesList.push({\r\n          id: doc.id,\r\n          userId: data.recipientId,\r\n          name: data.recipientName || 'Unknown',\r\n          phone: data.recipientPhone,\r\n          role: 'added',\r\n          isFavorite: data.isFavorite || false,\r\n        });\r\n      });\r\n\r\n      getDocs(recipientQuery).then((recipientSnapshot) => {\r\n        recipientSnapshot.forEach((doc) => {\r\n          const data = doc.data();\r\n          bestiesList.push({\r\n            id: doc.id,\r\n            userId: data.requesterId,\r\n            name: data.requesterName || 'Unknown',\r\n            phone: data.requesterPhone,\r\n            role: 'guardian',\r\n            isFavorite: data.isFavorite || false,\r\n          });\r\n        });\r\n\r\n        setBesties(bestiesList);\r\n        setLoading(false);\r\n      }).catch((error) => {\r\n        console.error('Error loading recipient besties:', error);\r\n        setBesties(bestiesList);\r\n        setLoading(false);\r\n      });\r\n    });\r\n\r\n    const pendingQuery = query(\r\n      collection(db, 'besties'),\r\n      where('recipientId', '==', currentUser.uid),\r\n      where('status', '==', 'pending')\r\n    );\r\n\r\n    const unsubscribePending = onSnapshot(pendingQuery, (snapshot) => {\r\n      const requests = [];\r\n      snapshot.forEach((doc) => {\r\n        requests.push({ id: doc.id, ...doc.data() });\r\n      });\r\n      setPendingRequests(requests);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeRequester();\r\n      unsubscribePending();\r\n    };\r\n  }, [currentUser]);\r\n\r\n  // Create welcome posts for new users\r\n  useEffect(() => {\r\n    const createWelcomePosts = async () => {\r\n      if (!currentUser || !userData) return;\r\n\r\n      // Check if user is day-old (account created within last 24 hours)\r\n      const accountAge = currentUser.metadata?.creationTime\r\n        ? new Date() - new Date(currentUser.metadata.creationTime)\r\n        : Infinity;\r\n      const oneDayInMs = 24 * 60 * 60 * 1000;\r\n\r\n      if (accountAge > oneDayInMs) return; // Not a new user\r\n\r\n      // Check if welcome posts already exist\r\n      const welcomePostsQuery = query(\r\n        collection(db, 'posts'),\r\n        where('userId', '==', 'BESTIES_BOT')\r\n      );\r\n      const welcomePostsSnapshot = await getDocs(welcomePostsQuery);\r\n\r\n      // Check if any existing welcome posts are for this user\r\n      const hasWelcomePosts = welcomePostsSnapshot.docs.some(doc =>\r\n        doc.data().recipientId === currentUser.uid\r\n      );\r\n\r\n      if (hasWelcomePosts) return; // Welcome posts already created\r\n\r\n      // Create welcome posts\r\n      const welcomeMessages = [\r\n        {\r\n          text: \"Welcome to your Besties social hub! \\n\\nThis is your private space - only your besties see what you get up to in here. There's no algorithm, just you, your besties, and a whole lot of privacy. Feel free to share updates, check-ins, or just say hi!\",\r\n          order: 1\r\n        },\r\n        {\r\n          text: \" Scroll down to find the leaderboard!\\n\\nCompete with your friends to see who's most reliable, who's the quickest to respond... but in reality, you all win. This is about staying safe together, not competition. The real prize is having each other's backs! \",\r\n          order: 2\r\n        },\r\n        {\r\n          text: \" Keep scrolling to see all your besties!\\n\\nThis is where you'll find everyone after you've filled your bestie circle. Check on them, see their activity, and stay connected. Your safety squad is growing! \",\r\n          order: 3\r\n        }\r\n      ];\r\n\r\n      try {\r\n        for (const message of welcomeMessages) {\r\n          await addDoc(collection(db, 'posts'), {\r\n            userId: 'BESTIES_BOT',\r\n            recipientId: currentUser.uid,\r\n            userName: 'Besties Team',\r\n            userPhoto: null,\r\n            text: message.text,\r\n            photoURL: null,\r\n            createdAt: Timestamp.fromMillis(Date.now() - (3 - message.order) * 1000), // Stagger timestamps\r\n            isWelcomeMessage: true,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error creating welcome posts:', error);\r\n      }\r\n    };\r\n\r\n    createWelcomePosts();\r\n  }, [currentUser, userData]);\r\n\r\n  // Load activity feed - only when page is visible\r\n  useEffect(() => {\r\n    if (!currentUser || besties.length === 0) {\r\n      setActivityLoading(false);\r\n      return;\r\n    }\r\n\r\n    const loadActivityFeed = async () => {\r\n      // Only load if page is visible\r\n      if (document.hidden) return;\r\n\r\n      setActivityLoading(true);\r\n\r\n      const activities = [];\r\n      const missed = [];\r\n      const attentionRequests = [];\r\n\r\n      // Get bestie user IDs (deduplicated)\r\n      const bestieIds = [...new Set(besties.map(b => b.userId))];\r\n\r\n      // Load recent activity (last 48 hours)\r\n      const twoDaysAgo = new Date();\r\n      twoDaysAgo.setHours(twoDaysAgo.getHours() - 48);\r\n\r\n      // Load user's own posts\r\n      const userPostsQuery = query(\r\n        collection(db, 'posts'),\r\n        where('userId', '==', currentUser.uid),\r\n        where('createdAt', '>=', twoDaysAgo),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(10)\r\n      );\r\n      const userPostsSnapshot = await getDocs(userPostsQuery);\r\n      userPostsSnapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        activities.push({\r\n          id: doc.id,\r\n          type: 'post',\r\n          postData: data,\r\n          userName: userData?.displayName || 'You',\r\n          userId: currentUser.uid,\r\n          timestamp: data.createdAt?.toDate() || new Date(),\r\n        });\r\n      });\r\n\r\n      // Load welcome posts from Besties Bot\r\n      const welcomePostsQuery = query(\r\n        collection(db, 'posts'),\r\n        where('userId', '==', 'BESTIES_BOT')\r\n      );\r\n      const welcomePostsSnapshot = await getDocs(welcomePostsQuery);\r\n      welcomePostsSnapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        // Only show welcome posts addressed to current user\r\n        if (data.recipientId === currentUser.uid) {\r\n          activities.push({\r\n            id: doc.id,\r\n            type: 'post',\r\n            postData: data,\r\n            userName: 'Besties Team',\r\n            userId: 'BESTIES_BOT',\r\n            timestamp: data.createdAt?.toDate() || new Date(),\r\n          });\r\n        }\r\n      });\r\n\r\n      for (const bestieId of bestieIds) {\r\n        try {\r\n          // Get recent check-ins FROM this bestie\r\n          const checkInsQuery = query(\r\n            collection(db, 'checkins'),\r\n            where('userId', '==', bestieId),\r\n            where('createdAt', '>=', twoDaysAgo),\r\n            orderBy('createdAt', 'desc'),\r\n            limit(10)\r\n          );\r\n\r\n          const checkInsSnapshot = await getDocs(checkInsQuery);\r\n\r\n          // ALSO get check-ins where CURRENT USER is a selected bestie FOR this friend\r\n          const checkInsAsBestieQuery = query(\r\n            collection(db, 'checkins'),\r\n            where('userId', '==', bestieId),\r\n            where('bestieIds', 'array-contains', currentUser.uid),\r\n            where('createdAt', '>=', twoDaysAgo),\r\n            orderBy('createdAt', 'desc'),\r\n            limit(10)\r\n          );\r\n\r\n          const checkInsAsBestieSnapshot = await getDocs(checkInsAsBestieQuery);\r\n\r\n          // Get recent posts from this bestie\r\n          const postsQuery = query(\r\n            collection(db, 'posts'),\r\n            where('userId', '==', bestieId),\r\n            where('createdAt', '>=', twoDaysAgo),\r\n            orderBy('createdAt', 'desc'),\r\n            limit(10)\r\n          );\r\n          const postsSnapshot = await getDocs(postsQuery);\r\n          const bestie = besties.find(b => b.userId === bestieId);\r\n\r\n          postsSnapshot.forEach((doc) => {\r\n            const data = doc.data();\r\n            activities.push({\r\n              id: doc.id,\r\n              type: 'post',\r\n              postData: data,\r\n              userName: bestie?.name || 'Bestie',\r\n              userId: bestieId,\r\n              timestamp: data.createdAt?.toDate() || new Date(),\r\n            });\r\n          });\r\n\r\n          // Process check-ins from both queries\r\n          const allCheckInsSnapshots = [checkInsSnapshot, checkInsAsBestieSnapshot];\r\n\r\n          allCheckInsSnapshots.forEach(snapshot => {\r\n            snapshot.forEach((doc) => {\r\n              const data = doc.data();\r\n              const bestie = besties.find(b => b.userId === bestieId);\r\n\r\n              // Avoid duplicates\r\n              const alreadyAdded = activities.some(a => a.id === doc.id);\r\n              if (!alreadyAdded) {\r\n                activities.push({\r\n                  id: doc.id,\r\n                  type: 'checkin',\r\n                  checkInData: data,\r\n                  userName: bestie?.name || 'Bestie',\r\n                  userId: bestieId,\r\n                  timestamp: data.createdAt?.toDate() || new Date(),\r\n                  status: data.status,\r\n                });\r\n\r\n                // Check for missed check-ins (alerted status)\r\n                if (data.status === 'alerted') {\r\n                  const alreadyInMissed = missed.some(m => m.id === doc.id);\r\n                  if (!alreadyInMissed) {\r\n                    missed.push({\r\n                      id: doc.id,\r\n                      userName: bestie?.name || 'Bestie',\r\n                      userId: bestieId,\r\n                      checkInData: data,\r\n                      timestamp: data.createdAt?.toDate() || new Date(),\r\n                    });\r\n                  }\r\n                }\r\n              }\r\n            });\r\n          });\r\n\r\n          // Check for request attention\r\n          const userDoc = await getDoc(doc(db, 'users', bestieId));\r\n          if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            if (userData.requestAttention && userData.requestAttention.active) {\r\n              const bestie = besties.find(b => b.userId === bestieId);\r\n              attentionRequests.push({\r\n                userId: bestieId,\r\n                userName: userData.displayName || bestie?.name || 'Bestie',\r\n                photoURL: userData.photoURL || bestie?.photoURL || null,\r\n                tag: userData.requestAttention.tag,\r\n                note: userData.requestAttention.note,\r\n                timestamp: userData.requestAttention.timestamp?.toDate() || new Date(),\r\n              });\r\n            }\r\n          }\r\n\r\n          // Load recent achievements/badges\r\n          const badgesDoc = await getDoc(doc(db, 'badges', bestieId));\r\n          if (badgesDoc.exists()) {\r\n            const badgesData = badgesDoc.data();\r\n            const recentBadges = badgesData.badges?.filter(b => {\r\n              const earnedDate = b.earnedAt?.toDate();\r\n              return earnedDate && earnedDate > twoDaysAgo;\r\n            }) || [];\r\n\r\n            recentBadges.forEach(badge => {\r\n              const bestie = besties.find(b => b.userId === bestieId);\r\n              activities.push({\r\n                id: `badge-${bestieId}-${badge.id}`,\r\n                type: 'badge',\r\n                userName: bestie?.name || 'Bestie',\r\n                userId: bestieId,\r\n                badge: badge,\r\n                timestamp: badge.earnedAt?.toDate() || new Date(),\r\n              });\r\n            });\r\n          }\r\n        } catch (error) {\r\n          console.error('Error loading activity for bestie:', error);\r\n        }\r\n      }\r\n\r\n      // Sort activities by timestamp (newest first)\r\n      activities.sort((a, b) => b.timestamp - a.timestamp);\r\n\r\n      // Filter alerts to only show selected besties (featured circle)\r\n      const featuredCircle = userData?.featuredCircle || [];\r\n      const filteredMissed = featuredCircle.length > 0\r\n        ? missed.filter(m => featuredCircle.includes(m.userId))\r\n        : missed;\r\n      const filteredAttention = featuredCircle.length > 0\r\n        ? attentionRequests.filter(a => featuredCircle.includes(a.userId))\r\n        : attentionRequests;\r\n\r\n      setActivityFeed(activities);\r\n      setMissedCheckIns(filteredMissed);\r\n      setRequestsForAttention(filteredAttention);\r\n      setActivityLoading(false);\r\n    };\r\n\r\n    // Initial load\r\n    loadActivityFeed();\r\n\r\n    // Refresh when page becomes visible\r\n    const handleVisibilityChange = () => {\r\n      if (!document.hidden) {\r\n        loadActivityFeed();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n    };\r\n  }, [currentUser, besties, userData]);\r\n\r\n  // Load reactions for check-ins\r\n  useEffect(() => {\r\n    if (activityFeed.length === 0) return;\r\n\r\n    const loadReactions = async () => {\r\n      const reactionsData = {};\r\n\r\n      for (const activity of activityFeed) {\r\n        if (activity.type === 'checkin') {\r\n          try {\r\n            const reactionsSnapshot = await getDocs(\r\n              collection(db, 'checkins', activity.id, 'reactions')\r\n            );\r\n            reactionsData[activity.id] = reactionsSnapshot.docs.map(doc => ({\r\n              id: doc.id,\r\n              ...doc.data()\r\n            }));\r\n          } catch (error) {\r\n            console.error('Error loading reactions:', error);\r\n            reactionsData[activity.id] = [];\r\n          }\r\n        }\r\n      }\r\n\r\n      setReactions(reactionsData);\r\n    };\r\n\r\n    loadReactions();\r\n  }, [activityFeed]);\r\n\r\n  // Load comments for selected check-in\r\n  useEffect(() => {\r\n    if (!selectedCheckIn || !showComments) return;\r\n\r\n    const loadComments = async () => {\r\n      try {\r\n        const commentsQuery = query(\r\n          collection(db, 'checkins', selectedCheckIn.id, 'comments'),\r\n          orderBy('timestamp', 'asc')\r\n        );\r\n        const commentsSnapshot = await getDocs(commentsQuery);\r\n        const commentsData = commentsSnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n        setComments(commentsData);\r\n      } catch (error) {\r\n        console.error('Error loading comments:', error);\r\n        setComments([]);\r\n      }\r\n    };\r\n\r\n    loadComments();\r\n  }, [selectedCheckIn, showComments]);\r\n\r\n  // Add reaction to check-in\r\n  const addReaction = async (checkInId, emoji) => {\r\n    try {\r\n      // Check if user already reacted with this emoji\r\n      const existingReaction = reactions[checkInId]?.find(\r\n        r => r.userId === currentUser.uid && r.emoji === emoji\r\n      );\r\n\r\n      if (existingReaction) {\r\n        toast('You already reacted with this!', { icon: emoji });\r\n        return;\r\n      }\r\n\r\n      await addDoc(collection(db, 'checkins', checkInId, 'reactions'), {\r\n        userId: currentUser.uid,\r\n        userName: userData?.displayName || 'Anonymous',\r\n        emoji: emoji,\r\n        timestamp: Timestamp.now(),\r\n      });\r\n\r\n      // Reload reactions for this check-in\r\n      const reactionsSnapshot = await getDocs(\r\n        collection(db, 'checkins', checkInId, 'reactions')\r\n      );\r\n      setReactions(prev => ({\r\n        ...prev,\r\n        [checkInId]: reactionsSnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }))\r\n      }));\r\n\r\n      // Track analytics\r\n      const { logAnalyticsEvent } = require('../services/firebase');\r\n      logAnalyticsEvent('checkin_reaction_added', {\r\n        emoji: emoji,\r\n        checkin_id: checkInId\r\n      });\r\n\r\n      toast.success('Reaction added!');\r\n    } catch (error) {\r\n      console.error('Error adding reaction:', error);\r\n      toast.error('Failed to add reaction');\r\n    }\r\n  };\r\n\r\n  // Add comment to check-in\r\n  const addComment = async () => {\r\n    if (!newComment.trim() || !selectedCheckIn) return;\r\n\r\n    try {\r\n      await addDoc(collection(db, 'checkins', selectedCheckIn.id, 'comments'), {\r\n        userId: currentUser.uid,\r\n        userName: userData?.displayName || 'Anonymous',\r\n        userPhoto: userData?.photoURL || null,\r\n        text: newComment.trim(),\r\n        timestamp: Timestamp.now(),\r\n      });\r\n\r\n      // Reload comments\r\n      const commentsQuery = query(\r\n        collection(db, 'checkins', selectedCheckIn.id, 'comments'),\r\n        orderBy('timestamp', 'asc')\r\n      );\r\n      const commentsSnapshot = await getDocs(commentsQuery);\r\n      setComments(commentsSnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      })));\r\n\r\n      // Track analytics\r\n      const { logAnalyticsEvent } = require('../services/firebase');\r\n      logAnalyticsEvent('checkin_comment_added', {\r\n        checkin_id: selectedCheckIn.id,\r\n        comment_length: newComment.trim().length\r\n      });\r\n\r\n      setNewComment('');\r\n      toast.success('Comment added!');\r\n    } catch (error) {\r\n      console.error('Error adding comment:', error);\r\n      toast.error('Failed to add comment');\r\n    }\r\n  };\r\n\r\n  // Filter besties\r\n  const getFilteredBesties = () => {\r\n    let filtered = [...besties];\r\n\r\n    // Sort by most recent activity first, then favorites, then alphabetical\r\n    filtered.sort((a, b) => {\r\n      // Check for recent activity\r\n      const aRecent = activityFeed.find(f => f.userId === a.userId);\r\n      const bRecent = activityFeed.find(f => f.userId === b.userId);\r\n\r\n      // If both have recent activity, sort by timestamp\r\n      if (aRecent && bRecent) {\r\n        return bRecent.timestamp - aRecent.timestamp;\r\n      }\r\n\r\n      // If one has recent activity and the other doesn't\r\n      if (aRecent && !bRecent) return -1;\r\n      if (!aRecent && bRecent) return 1;\r\n\r\n      // If neither has recent activity, favorites first\r\n      if (a.isFavorite && !b.isFavorite) return -1;\r\n      if (!a.isFavorite && b.isFavorite) return 1;\r\n\r\n      // Finally, alphabetical\r\n      return (a.name || '').localeCompare(b.name || '');\r\n    });\r\n\r\n    return filtered;\r\n  };\r\n\r\n  // Helper function to get time ago\r\n  const getTimeAgo = (timestamp) => {\r\n    const now = new Date();\r\n    const diffMs = now - timestamp;\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) return 'Just now';\r\n    if (diffMins < 60) return `${diffMins} min ago`;\r\n    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n    return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n  };\r\n\r\n  const filteredBesties = getFilteredBesties();\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-pattern\">\r\n        <div className=\"flex items-center justify-center py-20\">\r\n          <div className=\"spinner\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-pattern\">\r\n      {/* Notification Bell - No Header */}\r\n      <div className=\"fixed top-4 right-4 z-50\">\r\n        <FloatingNotificationBell />\r\n      </div>\r\n\r\n      <div className=\"max-w-6xl mx-auto p-4 pb-32 md:pb-6\">\r\n        {/* Header */}\r\n        <div className=\"mb-4 text-center\">\r\n          <h1 className=\"text-2xl md:text-3xl font-display text-gradient\"> Your Besties</h1>\r\n        </div>\r\n\r\n        {/* Pending Requests */}\r\n        <PendingRequestsList pendingRequests={pendingRequests} />\r\n\r\n        {/* PROMINENT Needs Attention Section - Top when active */}\r\n        <NeedsAttentionSection\r\n          missedCheckIns={missedCheckIns}\r\n          requestsForAttention={requestsForAttention}\r\n          besties={besties}\r\n        />\r\n\r\n        {/* Activity Feed - Moved to top */}\r\n        <div className=\"mb-6\">\r\n          {/* Activity Feed Header with Create Post Button */}\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-lg md:text-xl font-display text-text-primary\">\r\n               Activity Feed\r\n            </h2>\r\n            <button\r\n              onClick={() => setShowCreatePostModal(true)}\r\n              className=\"btn btn-primary px-4 py-2 text-sm font-semibold\"\r\n            >\r\n               Post\r\n            </button>\r\n          </div>\r\n\r\n          {/* Activity Feed */}\r\n          {activityLoading ? (\r\n            <ActivityFeedSkeleton />\r\n          ) : (\r\n            <ActivityFeed\r\n              activityFeed={activityFeed.filter(activity => {\r\n                // Filter out activities that are already shown in Needs Attention section\r\n                const isInMissedCheckIns = missedCheckIns.some(m => \r\n                  m.userId === activity.userId && activity.status === 'alerted'\r\n                );\r\n                const isInAttentionRequests = requestsForAttention.some(r => \r\n                  r.userId === activity.userId && activity.type === 'checkin'\r\n                );\r\n                return !isInMissedCheckIns && !isInAttentionRequests;\r\n              })}\r\n              reactions={reactions}\r\n              addReaction={addReaction}\r\n              setSelectedCheckIn={setSelectedCheckIn}\r\n              setShowComments={setShowComments}\r\n              getTimeAgo={getTimeAgo}\r\n              initialPostId={selectedPostId}\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* Leaderboard and Besties Section */}\r\n        <div className=\"space-y-6\">\r\n          {/* This Week's Champions */}\r\n          <BestiesLeaderboard\r\n            rankingsPeriod={rankingsPeriod}\r\n            setRankingsPeriod={setRankingsPeriod}\r\n          />\r\n\r\n          {/* Besties Grid */}\r\n          <BestiesGrid\r\n            besties={filteredBesties}\r\n            activityFeed={activityFeed}\r\n          />\r\n        </div>\r\n\r\n        {/* Empty State */}\r\n        <EmptyState\r\n          besties={besties}\r\n          pendingRequests={pendingRequests}\r\n          onAddBestie={() => setShowAddModal(true)}\r\n        />\r\n      </div>\r\n\r\n      {/* Comments Modal */}\r\n      {showComments && selectedCheckIn && (\r\n        <CommentsModal\r\n          selectedCheckIn={selectedCheckIn}\r\n          comments={comments}\r\n          newComment={newComment}\r\n          setNewComment={setNewComment}\r\n          onAddComment={addComment}\r\n          onClose={() => {\r\n            setShowComments(false);\r\n            setSelectedCheckIn(null);\r\n            setComments([]);\r\n            setNewComment('');\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Add Bestie Modal */}\r\n      {showAddModal && (\r\n        <AddBestieModal onClose={() => setShowAddModal(false)} />\r\n      )}\r\n\r\n      {/* Create Post Modal */}\r\n      {showCreatePostModal && (\r\n        <CreatePostModal\r\n          onClose={() => setShowCreatePostModal(false)}\r\n          onPostCreated={() => {\r\n            // Reload activity feed after post creation\r\n            window.location.reload();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* CSS for slow pulse animation */}\r\n      <style>{`\r\n        @keyframes pulse-slow {\r\n          0%, 100% {\r\n            opacity: 1;\r\n          }\r\n          50% {\r\n            opacity: 0.7;\r\n          }\r\n        }\r\n        .animate-pulse-slow {\r\n          animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BestiesPage;\r\n"],"names":["sanitizeUserInput","input","maxLength","arguments","length","undefined","text","DOMPurify","sanitize","ALLOWED_TAGS","ALLOWED_ATTR","substring","_ref","onClose","onSuccess","currentUser","userData","useAuth","showCelebration","setShowCelebration","useState","shareUrl","concat","uid","shareMessage","displayName","handleCopyLink","navigator","clipboard","writeText","toast","success","setTimeout","_jsx","className","onClick","children","e","stopPropagation","_jsxs","async","share","title","url","error","name","console","handleWhatsAppShare","encoded","encodeURIComponent","window","location","href","open","handleMessengerShare","origin","handleSMSShare","handleFacebookShare","fbAppUrl","request","onRequestHandled","loading","setLoading","isHidden","setIsHidden","executeOptimistic","useOptimisticUpdate","userPhoto","requesterPhotoURL","src","alt","requesterName","toUpperCase","requesterPhone","personalMessage","optimisticUpdate","id","serverUpdate","result","apiService","Error","rollback","successMessage","errorMessage","disabled","logAnalyticsEvent","require","method","pendingRequests","map","BestieRequestCard","missedCheckIns","requestsForAttention","besties","dismissedItems","setDismissedItems","Set","visibleMissed","filter","m","has","visibleRequests","r","userId","hasAlerts","dismissItem","type","prev","missed","_missed$checkInData$a","_missed$checkInData$l","userName","checkInData","activity","Date","timestamp","toLocaleString","address","_besties$find","find","b","phone","_request$userName","photoURL","charAt","tag","bestie","postId","initialCounts","reactions","setReactions","heart","laugh","fire","myReaction","setMyReaction","useEffect","reactionsRef","collection","db","q","query","where","snapshot","getDocs","empty","docs","data","loadMyReaction","postRef","doc","unsubscribe","onSnapshot","docSnap","exists","reactionCounts","emoji","label","reaction","isActive","count","haptic","light","previousReactions","_objectSpread","previousMyReaction","Math","max","deleteDoc","ref","updateDoc","increment","newReactions","addDoc","createdAt","Timestamp","now","reaction_type","post_id","handleReaction","getTimeAgo","diffMs","toDate","diffMins","floor","diffHours","diffDays","comments","setComments","newComment","setNewComment","submitting","setSubmitting","commentsRef","orderBy","limit","commentsList","handleSubmitComment","preventDefault","trim","sanitizedText","commentCount","comment_length","comment","_comment$userName","onSubmit","value","onChange","target","onKeyPress","key","shiftKey","placeholder","activityFeed","addReaction","setSelectedCheckIn","setShowComments","initialPostId","navigate","useNavigate","showPostComments","setShowPostComments","currentPage","setCurrentPage","React","totalPages","ceil","startIndex","paginatedFeed","slice","_Fragment","_activity$checkInData","_activity$checkInData2","_activity$checkInData3","_activity$checkInData4","_activity$checkInData5","_activity$userName","_activity$userName2","status","_reactions$activity$i","badge","icon","description","postData","isSupportRequest","supportTag","userPhone","PostReactions","p","Array","from","_","i","page","min","PostComments","ActivityFeedSkeleton","onAddBestie","onPostCreated","setText","photo","setPhoto","photoPreview","setPhotoPreview","uploading","setUploading","rows","accept","file","files","size","URL","createObjectURL","photoRef","storage","uploadBytes","getDownloadURL","bestieUserIds","has_photo","has_text","text_length","rankingsPeriod","setRankingsPeriod","_ref2","onRemove","isDark","useDarkMode","setUserPhoto","requestAttention","setRequestAttention","showProfileMenu","setShowProfileMenu","showDeleteModal","setShowDeleteModal","deleteChallenge","setDeleteChallenge","menuRef","useRef","userDoc","getDoc","fetchUserData","handleClickOutside","current","contains","document","addEventListener","removeEventListener","isFavorite","ProfileWithBubble","showBubble","autoFocus","expectedPhrases","normalized","toLowerCase","includes","selectedBestie","setSelectedBestie","bestieToDelete","setBestieToDelete","showLegend","setShowLegend","indicators","bestieActivities","a","oneHourAgo","some","push","tooltip","_a$timestamp$getHours","_a$timestamp$getHours2","_a$timestamp","hour","getHours","call","getBestieIndicators","isMenuOpen","BestieCard","indicator","idx","reload","selectedCheckIn","onAddComment","_comment$timestamp","BestiesPage","useLocation","setBesties","setPendingRequests","showAddModal","setShowAddModal","showCreatePostModal","setShowCreatePostModal","setActivityFeed","activityLoading","setActivityLoading","setMissedCheckIns","setRequestsForAttention","showComments","selectedPostId","setSelectedPostId","_location$state","state","openPostId","history","replaceState","requesterQuery","recipientQuery","unsubscribeRequester","bestiesList","forEach","recipientId","recipientName","recipientPhone","role","then","recipientSnapshot","requesterId","catch","pendingQuery","unsubscribePending","requests","_currentUser$metadata","metadata","creationTime","Infinity","welcomePostsQuery","welcomeMessages","order","message","fromMillis","isWelcomeMessage","createWelcomePosts","loadActivityFeed","hidden","activities","attentionRequests","bestieIds","twoDaysAgo","setHours","userPostsQuery","_data$createdAt","_data$createdAt2","bestieId","checkInsQuery","checkInsSnapshot","checkInsAsBestieQuery","checkInsAsBestieSnapshot","postsQuery","postsSnapshot","_data$createdAt3","_data$createdAt4","_data$createdAt5","active","_userData$requestAtte","note","badgesDoc","_badgesData$badges","badgesData","badges","_b$earnedAt","earnedDate","earnedAt","_badge$earnedAt","sort","featuredCircle","filteredMissed","filteredAttention","handleVisibilityChange","reactionsData","reactionsSnapshot","loadReactions","commentsQuery","commentsData","loadComments","filteredBesties","getFilteredBesties","filtered","aRecent","f","bRecent","localeCompare","FloatingNotificationBell","PendingRequestsList","NeedsAttentionSection","ActivityFeed","isInMissedCheckIns","isInAttentionRequests","checkInId","_reactions$checkInId","checkin_id","BestiesLeaderboard","BestiesGrid","EmptyState","CommentsModal","commentsSnapshot","AddBestieModal","CreatePostModal"],"sourceRoot":""}