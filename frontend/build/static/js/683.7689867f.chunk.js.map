{"version":3,"file":"static/js/683.7689867f.chunk.js","mappings":"oOAQA,MAmeA,EAneuBA,KACrB,MAAM,YAAEC,EAAW,SAAEC,IAAaC,EAAAA,EAAAA,MAC5BC,GAAWC,EAAAA,EAAAA,OACVC,EAAMC,IAAWC,EAAAA,EAAAA,UAAS,YAC1BC,EAAYC,IAAiBF,EAAAA,EAAAA,UAAS,IACtCG,EAAaC,IAAkBJ,EAAAA,EAAAA,UAAS,KACxCK,EAAWC,IAAgBN,EAAAA,EAAAA,WAAS,IACpCO,EAAYC,IAAiBR,EAAAA,EAAAA,WAAS,IACtCS,EAAiBC,IAAsBV,EAAAA,EAAAA,WAAS,IAChDW,EAAaC,IAAkBZ,EAAAA,EAAAA,UAAS,OAG/Ca,EAAAA,EAAAA,WAAU,KACR,MAAMC,EAAoBC,eAAeC,QAAQ,iBAAmBC,aAAaD,QAAQ,gBACzF,GAAIF,EACF,IACEF,EAAeM,KAAKC,MAAML,GAC5B,CAAE,MAAOM,GACPC,QAAQC,MAAM,gCAAiCF,EACjD,GAED,KAGHP,EAAAA,EAAAA,WAAU,KACI,OAARnB,QAAQ,IAARA,GAAAA,EAAUS,cAAgBA,EAC5BC,EAAeV,EAASS,aACJ,OAAXV,QAAW,IAAXA,GAAAA,EAAaU,cAAgBA,GACtCC,EAAeX,EAAYU,cAE5B,CAACT,EAAUD,EAAaU,IAE3B,MAAMoB,EAAS,CACb,CACEC,MAAO,eACPC,MAAO,sBACPC,YAAa,0EAEf,CACEF,MAAO,SACPC,MAAO,eACPC,YAAa,wHAEf,CACEF,MAAO,eACPC,MAAO,sBACPC,YAAa,sHAEf,CACEF,MAAO,eACPC,MAAO,iBACPC,YAAa,4HAEf,CACEF,MAAO,SACPC,MAAO,qBACPC,YAAa,sHAIXC,EAAeJ,EAAOtB,IAG5BY,EAAAA,EAAAA,WAAU,KACK,kBAATf,GAA4BL,GAC9BmC,KAGD,CAAC9B,EAAML,IAEV,MAAMmC,EAAkBC,UACtBnB,GAAmB,GACnB,IAIE,GADsBK,eAAeC,QAAQ,mBAAqBC,aAAaD,QAAQ,kBAGrF,IAAK,IAAIc,EAAI,EAAGA,EAAI,EAAGA,IAAK,OACpB,IAAIC,QAAQC,GAAWC,WAAWD,EAAS,MAEjD,KADqBjB,eAAeC,QAAQ,mBAAqBC,aAAaD,QAAQ,mBACnE,KACrB,CAIF,MAAOkB,EAAgBC,SAAwBJ,QAAQK,IAAI,EACzDC,EAAAA,EAAAA,KAAQC,EAAAA,EAAAA,IAAMC,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAAYC,EAAAA,EAAAA,IAAM,cAAe,KAAMhD,EAAYiD,MAAMD,EAAAA,EAAAA,IAAM,SAAU,KAAM,eAC5GJ,EAAAA,EAAAA,KAAQC,EAAAA,EAAAA,IAAMC,EAAAA,EAAAA,IAAWC,EAAAA,GAAI,YAAYC,EAAAA,EAAAA,IAAM,cAAe,KAAMhD,EAAYiD,MAAMD,EAAAA,EAAAA,IAAM,SAAU,KAAM,gBAG9GjC,GAAe0B,EAAeS,QAAUR,EAAeQ,MACzD,CAAE,MAAOrB,GACPD,QAAQC,MAAM,0BAA2BA,EAC3C,CAAC,QACCZ,GAAmB,EACrB,GAGIkC,EAAiBf,UACrB,GAAK1B,EAAY0C,OAKjB,UACQC,EAAAA,EAAAA,KAAUC,EAAAA,EAAAA,IAAIP,EAAAA,GAAI,QAAS/C,EAAYiD,KAAM,CACjDvC,YAAaA,EAAY0C,SAE3B9C,EAAQ,QACV,CAAE,MAAOuB,GACPD,QAAQC,MAAM,uBAAwBA,GACtC0B,EAAAA,GAAM1B,MAAM,wBACd,MAZE0B,EAAAA,GAAM1B,MAAM,wBAeV2B,EAAoBpB,UACxB,MAAMqB,EAAO9B,EAAE+B,OAAOC,MAAM,GAC5B,IAAKF,EAAM,OAEX,GAAIA,EAAKG,KAAO,QAEd,YADAL,EAAAA,GAAM1B,MAAM,+BAIdhB,GAAa,GACb,MAAMgD,EAAcN,EAAAA,GAAMO,QAAQ,sBAElC,IACE,MAAMC,GAAaC,EAAAA,EAAAA,IAAIC,EAAAA,QAAQ,oBAADC,OAAsBlE,EAAYiD,IAAG,KAAAiB,OAAIC,KAAKC,MAAK,KAAAF,OAAIT,EAAKY,aACpFC,EAAAA,EAAAA,GAAYP,EAAYN,GAC9B,MAAMc,QAAoBC,EAAAA,EAAAA,IAAeT,SAEnCV,EAAAA,EAAAA,KAAUC,EAAAA,EAAAA,IAAIP,EAAAA,GAAI,QAAS/C,EAAYiD,KAAM,CACjDwB,SAAUF,IAGZhB,EAAAA,GAAMmB,QAAQ,kBAAmB,CAAEC,GAAId,IAIrCvD,EADEY,EACM,iBAEA,gBAEZ,CAAE,MAAOW,GACPD,QAAQC,MAAM,yBAA0BA,GACxC0B,EAAAA,GAAM1B,MAAM,yBAA0B,CAAE8C,GAAId,GAC9C,CAAC,QACChD,GAAa,EACf,GAGI+D,EAAkBA,KAGpBtE,EADEY,EACM,iBAEA,kBAIN2D,EAAezC,UACnB,UACQiB,EAAAA,EAAAA,KAAUC,EAAAA,EAAAA,IAAIP,EAAAA,GAAI,QAAS/C,EAAYiD,KAAM,CACjD6B,qBAAqB,IAIvB,MAAM,kBAAEC,GAAsBC,EAAQ,MACtCD,EAAkB,uBAAwB,CACxCE,YAAanE,IAIbX,EADEW,EACO,UAEA,WAEb,CAAE,MAAOe,GACPD,QAAQC,MAAM,+BAAgCA,GAC9C0B,EAAAA,GAAM1B,MAAM,gCACd,GAIF,MAAa,YAATxB,GAEA6E,EAAAA,EAAAA,KAAA,OAAKC,UAAU,wEAAuEC,UACpFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,+BAA8BC,SAAC,kBAC9CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,wCAAuCC,SAAC,yBACtDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAC,iDAG1CF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMhF,EAAQ,UACvB6E,UAAU,wGAAuGC,SAClH,4BASI,WAAT/E,GAEA6E,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uFAAsFC,UACnGC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAElD,EAAaH,SAC7CmD,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SACxElD,EAAaF,SAEhBkD,EAAAA,EAAAA,KAAA,KAAGC,UAAU,gDAA+CC,SACzDlD,EAAaD,eAIhBiD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,iCAAgCC,SAC5CtD,EAAOyD,IAAI,CAACC,EAAGC,KACdP,EAAAA,EAAAA,KAAA,OAEEC,UAAS,uCAAAjB,OACPuB,IAAUjF,EAAa,iBAAmB,iCAFvCiF,OASXP,EAAAA,EAAAA,KAAA,OAAKC,UAAU,aAAYC,SACxB5E,EAAasB,EAAO4D,OAAS,GAC5BL,EAAAA,EAAAA,MAAAM,EAAAA,SAAA,CAAAP,SAAA,EACEF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMhF,EAAQ,QACvB6E,UAAU,2BAA0BC,SACrC,UAGDF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAM7E,EAAcD,EAAa,GAC1C2E,UAAU,yBAAwBC,SACnC,oBAKHF,EAAAA,EAAAA,KAAA,UACEI,QAASA,IAAMhF,EAAQ,QACvB6E,UAAU,sCAAqCC,SAChD,4CAWA,SAAT/E,GAEA6E,EAAAA,EAAAA,KAAA,OAAKC,UAAU,8EAA6EC,UAC1FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kBAAiBC,SAAA,EAC9BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mBAAkBC,SAAA,EAC/BF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAC,kBAC/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,2BAG5EF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,mCAAkCC,SAAC,8CAKlDF,EAAAA,EAAAA,KAAA,SACEU,KAAK,OACLC,MAAOnF,EACPoF,SAAWnE,GAAMhB,EAAegB,EAAE+B,OAAOmC,OACzCV,UAAU,+JACVY,YAAY,eAGdb,EAAAA,EAAAA,KAAA,UACEI,QAASnC,EACTgC,UAAU,sCAAqCC,SAChD,4BASI,UAAT/E,GAEA6E,EAAAA,EAAAA,KAAA,OAAKC,UAAU,8EAA6EC,UAC1FC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,kBAAiBC,SAAA,EAC9BC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mBAAkBC,SAAA,EAC/BF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAC,kBAC/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,4BAG5EF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,mCAAkCC,SAAC,mDAKzC,OAARnF,QAAQ,IAARA,OAAQ,EAARA,EAAUwE,YACTS,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2BAA0BC,UACvCF,EAAAA,EAAAA,KAAA,OACEc,IAAK/F,EAASwE,SACdwB,IAAI,UACJd,UAAU,mEAKhBE,EAAAA,EAAAA,MAAA,SAAOF,UAAU,oBAAmBC,SAAA,EAClCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,0DAAyDC,SACrExE,EAAY,eAAiB,+BAEhCsE,EAAAA,EAAAA,KAAA,SACEU,KAAK,OACLM,OAAO,UACPJ,SAAUtC,EACV2B,UAAU,SACVgB,SAAUvF,QAIdsE,EAAAA,EAAAA,KAAA,UACEI,QAASV,EACTO,UAAU,wCACVgB,SAAUvF,EAAUwE,SACrB,6BASI,mBAAT/E,GAA6Ba,GAE7BgE,EAAAA,EAAAA,KAAA,OAAKC,UAAU,0EAAyEC,UACtFC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,8BAA6BC,SAAA,EAC1CF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,+BAA8BC,SAAC,iBAG7ClE,EAAYuD,UACXS,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2BAA0BC,UACvCF,EAAAA,EAAAA,KAAA,OACEc,IAAK9E,EAAYuD,SACjBwB,IAAK/E,EAAYR,YACjByE,UAAU,2EAIdD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2BAA0BC,UACvCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,+IAA8IC,UACnI,QAAvBgB,EAAAlF,EAAYR,mBAAW,IAAA0F,OAAA,EAAvBA,EAA0B,KAAM,SAKvClB,EAAAA,EAAAA,KAAA,MAAIC,UAAU,wCAAuCC,SAAC,yBAGtDC,EAAAA,EAAAA,MAAA,KAAGF,UAAU,8BAA6BC,SAAA,CAAC,iBAC5BC,EAAAA,EAAAA,MAAA,QAAMF,UAAU,YAAWC,SAAA,CAAElE,EAAYR,YAAY,QAAS,eAE7EwE,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6BAA4BC,SAAC,uCAI1CF,EAAAA,EAAAA,KAAA,UACEI,QAASA,KAEPhE,eAAe+E,WAAW,gBAC1B7E,aAAa6E,WAAW,gBACxBlF,EAAe,MACfb,EAAQ,kBAEV6E,UAAU,wGAAuGC,SAClH,yBASI,kBAAT/E,EACEW,GAEAkE,EAAAA,EAAAA,KAAA,OAAKC,UAAU,0EAAyEC,UACtFF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,eAMnBD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,8FAA6FC,UAC1GC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,wBAAuBC,SAAA,EACpCC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,mBAAkBC,SAAA,EAC/BF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,gBAAeC,SAAC,YAC/BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,8DAA6DC,SAAC,wBAG5EF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,wCAAuCC,SAAC,sEAInDtE,IACAoE,EAAAA,EAAAA,KAAA,OAAKC,UAAU,2GAA0GC,UACvHF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,6DAA4DC,SAAC,qEAM7EtE,IACCoE,EAAAA,EAAAA,KAAA,OAAKC,UAAU,uGAAsGC,UACnHF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,2DAA0DC,SAAC,iEAO9EC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,gBAAeC,SAAA,EAC5BF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,yEAAwEC,SAAC,mBACvFC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,qDAAoDC,SAAA,EAChEC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,aAAYC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,mBAC3BF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,sDAERC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,aAAYC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,mBAC3BF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,sDAERC,EAAAA,EAAAA,MAAA,MAAIF,UAAU,aAAYC,SAAA,EACxBF,EAAAA,EAAAA,KAAA,QAAMC,UAAU,WAAUC,SAAC,mBAC3BF,EAAAA,EAAAA,KAAA,QAAAE,SAAM,yDAKXtE,GACCoE,EAAAA,EAAAA,KAAA,UACEI,QAAST,EACTM,UAAU,sCAAqCC,SAChD,sCAIDC,EAAAA,EAAAA,MAAAM,EAAAA,SAAA,CAAAP,SAAA,EACEF,EAAAA,EAAAA,KAAA,UACEI,QAAST,EACTM,UAAU,2CAA0CC,SACrD,kCAIDF,EAAAA,EAAAA,KAAA,KAAGC,UAAU,uDAAsDC,SAAC,mGAUzE,KArIwC,IAADgB,E","sources":["pages/OnboardingPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { db, storage } from '../services/firebase';\r\nimport { doc, updateDoc, collection, query, where, getDocs } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst OnboardingPage = () => {\r\n  const { currentUser, userData } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [step, setStep] = useState('welcome'); // welcome, slides, name, photo, invite-welcome, bestie-circle\r\n  const [slideIndex, setSlideIndex] = useState(0);\r\n  const [displayName, setDisplayName] = useState('');\r\n  const [uploading, setUploading] = useState(false);\r\n  const [hasBesties, setHasBesties] = useState(false);\r\n  const [checkingBesties, setCheckingBesties] = useState(false);\r\n  const [inviterInfo, setInviterInfo] = useState(null);\r\n\r\n  // Check for inviter info on mount\r\n  useEffect(() => {\r\n    const storedInviterInfo = sessionStorage.getItem('inviter_info') || localStorage.getItem('inviter_info');\r\n    if (storedInviterInfo) {\r\n      try {\r\n        setInviterInfo(JSON.parse(storedInviterInfo));\r\n      } catch (e) {\r\n        console.error('Failed to parse inviter info:', e);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Prefill name from user data when it loads\r\n  useEffect(() => {\r\n    if (userData?.displayName && !displayName) {\r\n      setDisplayName(userData.displayName);\r\n    } else if (currentUser?.displayName && !displayName) {\r\n      setDisplayName(currentUser.displayName);\r\n    }\r\n  }, [userData, currentUser, displayName]);\r\n\r\n  const slides = [\r\n    {\r\n      emoji: 'üëã',\r\n      title: 'Welcome to Besties!',\r\n      description: 'Your personal safety check-in app that keeps your loved ones informed.',\r\n    },\r\n    {\r\n      emoji: '‚è∞',\r\n      title: 'How It Works',\r\n      description: 'Create a check-in with a time limit. If you don\\'t mark yourself safe before time runs out, your besties get alerted.',\r\n    },\r\n    {\r\n      emoji: 'üíú',\r\n      title: 'Your Safety Network',\r\n      description: 'Add up to 5 besties to your circle. They\\'ll be notified if you miss a check-in, so they can make sure you\\'re okay.',\r\n    },\r\n    {\r\n      emoji: 'üì±',\r\n      title: 'Stay Connected',\r\n      description: 'Your besties get SMS alerts when you miss a check-in. They can also see your location and notes from your last check-in.',\r\n    },\r\n    {\r\n      emoji: '‚ú®',\r\n      title: 'Let\\'s Get Started!',\r\n      description: 'We\\'ll help you set up your profile and add your first bestie. Then you\\'ll be ready to create your first check-in!',\r\n    },\r\n  ];\r\n\r\n  const currentSlide = slides[slideIndex];\r\n\r\n  // Check if user already has besties\r\n  useEffect(() => {\r\n    if (step === 'bestie-circle' && currentUser) {\r\n      checkForBesties();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [step, currentUser]);\r\n\r\n  const checkForBesties = async () => {\r\n    setCheckingBesties(true);\r\n    try {\r\n      // If there's a pending invite, wait for it to be processed\r\n      // AuthContext removes pending_invite after processing\r\n      const pendingInvite = sessionStorage.getItem('pending_invite') || localStorage.getItem('pending_invite');\r\n      if (pendingInvite) {\r\n        // Wait up to 3 seconds for invite to process\r\n        for (let i = 0; i < 6; i++) {\r\n          await new Promise(resolve => setTimeout(resolve, 500));\r\n          const stillPending = sessionStorage.getItem('pending_invite') || localStorage.getItem('pending_invite');\r\n          if (!stillPending) break; // Invite processed!\r\n        }\r\n      }\r\n\r\n      // Now check for besties in Firestore\r\n      const [requesterQuery, recipientQuery] = await Promise.all([\r\n        getDocs(query(collection(db, 'besties'), where('requesterId', '==', currentUser.uid), where('status', '==', 'accepted'))),\r\n        getDocs(query(collection(db, 'besties'), where('recipientId', '==', currentUser.uid), where('status', '==', 'accepted'))),\r\n      ]);\r\n\r\n      setHasBesties(!requesterQuery.empty || !recipientQuery.empty);\r\n    } catch (error) {\r\n      console.error('Error checking besties:', error);\r\n    } finally {\r\n      setCheckingBesties(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveName = async () => {\r\n    if (!displayName.trim()) {\r\n      toast.error('Please enter a name');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await updateDoc(doc(db, 'users', currentUser.uid), {\r\n        displayName: displayName.trim(),\r\n      });\r\n      setStep('photo');\r\n    } catch (error) {\r\n      console.error('Error updating name:', error);\r\n      toast.error('Failed to update name');\r\n    }\r\n  };\r\n\r\n  const handlePhotoUpload = async (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      toast.error('Photo must be less than 5MB');\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    const uploadToast = toast.loading('Uploading photo...');\r\n\r\n    try {\r\n      const storageRef = ref(storage, `profile-pictures/${currentUser.uid}/${Date.now()}_${file.name}`);\r\n      await uploadBytes(storageRef, file);\r\n      const downloadURL = await getDownloadURL(storageRef);\r\n\r\n      await updateDoc(doc(db, 'users', currentUser.uid), {\r\n        photoURL: downloadURL,\r\n      });\r\n\r\n      toast.success('Photo uploaded!', { id: uploadToast });\r\n\r\n      // If user joined via invite, show welcome screen first\r\n      if (inviterInfo) {\r\n        setStep('invite-welcome');\r\n      } else {\r\n        setStep('bestie-circle');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error uploading photo:', error);\r\n      toast.error('Failed to upload photo', { id: uploadToast });\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleSkipPhoto = () => {\r\n    // If user joined via invite, show welcome screen first\r\n    if (inviterInfo) {\r\n      setStep('invite-welcome');\r\n    } else {\r\n      setStep('bestie-circle');\r\n    }\r\n  };\r\n\r\n  const handleFinish = async () => {\r\n    try {\r\n      await updateDoc(doc(db, 'users', currentUser.uid), {\r\n        onboardingCompleted: true,\r\n      });\r\n\r\n      // Track analytics\r\n      const { logAnalyticsEvent } = require('../services/firebase');\r\n      logAnalyticsEvent('onboarding_completed', {\r\n        has_besties: hasBesties\r\n      });\r\n\r\n      if (hasBesties) {\r\n        navigate('/create');\r\n      } else {\r\n        navigate('/profile');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error completing onboarding:', error);\r\n      toast.error('Failed to complete onboarding');\r\n    }\r\n  };\r\n\r\n  // Welcome Screen\r\n  if (step === 'welcome') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-primary flex items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full text-center\">\r\n          <div className=\"text-8xl mb-6 animate-bounce\">üíú</div>\r\n          <h1 className=\"text-4xl font-display text-white mb-4\">Welcome to Besties!</h1>\r\n          <p className=\"text-xl text-white/90 mb-8\">\r\n            Your personal safety network in your pocket\r\n          </p>\r\n          <button\r\n            onClick={() => setStep('slides')}\r\n            className=\"btn bg-white dark:bg-gray-800 text-primary hover:bg-white/90 dark:hover:bg-gray-700 text-lg px-8 py-4\"\r\n          >\r\n            Get Started ‚Üí\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Slides\r\n  if (step === 'slides') {\r\n    return (\r\n      <div className=\"min-h-screen bg-white dark:bg-gray-800 flex flex-col items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full text-center\">\r\n          <div className=\"text-7xl mb-6\">{currentSlide.emoji}</div>\r\n          <h2 className=\"text-3xl font-display text-gray-800 dark:text-gray-200 mb-4\">\r\n            {currentSlide.title}\r\n          </h2>\r\n          <p className=\"text-lg text-gray-600 dark:text-gray-400 mb-8\">\r\n            {currentSlide.description}\r\n          </p>\r\n\r\n          {/* Dots */}\r\n          <div className=\"flex justify-center gap-2 mb-8\">\r\n            {slides.map((_, index) => (\r\n              <div\r\n                key={index}\r\n                className={`w-2 h-2 rounded-full transition-all ${\r\n                  index === slideIndex ? 'bg-primary w-6' : 'bg-gray-300 dark:bg-gray-600'\r\n                }`}\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          {/* Navigation */}\r\n          <div className=\"flex gap-3\">\r\n            {slideIndex < slides.length - 1 ? (\r\n              <>\r\n                <button\r\n                  onClick={() => setStep('name')}\r\n                  className=\"flex-1 btn btn-secondary\"\r\n                >\r\n                  Skip\r\n                </button>\r\n                <button\r\n                  onClick={() => setSlideIndex(slideIndex + 1)}\r\n                  className=\"flex-1 btn btn-primary\"\r\n                >\r\n                  Next ‚Üí\r\n                </button>\r\n              </>\r\n            ) : (\r\n              <button\r\n                onClick={() => setStep('name')}\r\n                className=\"w-full btn btn-primary text-lg py-4\"\r\n              >\r\n                Let's check your details! ‚Üí\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Name Edit\r\n  if (step === 'name') {\r\n    return (\r\n      <div className=\"min-h-screen bg-white dark:bg-gray-800 flex items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"text-6xl mb-4\">üë§</div>\r\n            <h2 className=\"text-3xl font-display text-gray-800 dark:text-gray-200 mb-2\">\r\n              Is this name correct?\r\n            </h2>\r\n            <p className=\"text-gray-600 dark:text-gray-400\">\r\n              This is how your besties will see you\r\n            </p>\r\n          </div>\r\n\r\n          <input\r\n            type=\"text\"\r\n            value={displayName}\r\n            onChange={(e) => setDisplayName(e.target.value)}\r\n            className=\"w-full p-4 border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-xl focus:border-primary focus:outline-none text-lg mb-6\"\r\n            placeholder=\"Your name\"\r\n          />\r\n\r\n          <button\r\n            onClick={handleSaveName}\r\n            className=\"w-full btn btn-primary text-lg py-4\"\r\n          >\r\n            Looks Good! ‚úì\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Photo Upload\r\n  if (step === 'photo') {\r\n    return (\r\n      <div className=\"min-h-screen bg-white dark:bg-gray-800 flex items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"text-6xl mb-4\">üì∑</div>\r\n            <h2 className=\"text-3xl font-display text-gray-800 dark:text-gray-200 mb-2\">\r\n              Add a Profile Picture?\r\n            </h2>\r\n            <p className=\"text-gray-600 dark:text-gray-400\">\r\n              Help your besties recognize you (optional)\r\n            </p>\r\n          </div>\r\n\r\n          {userData?.photoURL && (\r\n            <div className=\"mb-6 flex justify-center\">\r\n              <img\r\n                src={userData.photoURL}\r\n                alt=\"Profile\"\r\n                className=\"w-32 h-32 rounded-full object-cover border-4 border-primary\"\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          <label className=\"block w-full mb-4\">\r\n            <div className=\"btn btn-primary text-lg py-4 text-center cursor-pointer\">\r\n              {uploading ? 'Uploading...' : 'üì§ Upload Photo'}\r\n            </div>\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              onChange={handlePhotoUpload}\r\n              className=\"hidden\"\r\n              disabled={uploading}\r\n            />\r\n          </label>\r\n\r\n          <button\r\n            onClick={handleSkipPhoto}\r\n            className=\"w-full btn btn-secondary text-lg py-4\"\r\n            disabled={uploading}\r\n          >\r\n            Skip for Now ‚Üí\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Invite Welcome Screen (only shown if user joined via invite)\r\n  if (step === 'invite-welcome' && inviterInfo) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-secondary flex items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full text-center\">\r\n          <div className=\"text-8xl mb-6 animate-bounce\">üíú</div>\r\n\r\n          {/* Inviter's Photo */}\r\n          {inviterInfo.photoURL ? (\r\n            <div className=\"mb-6 flex justify-center\">\r\n              <img\r\n                src={inviterInfo.photoURL}\r\n                alt={inviterInfo.displayName}\r\n                className=\"w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl\"\r\n              />\r\n            </div>\r\n          ) : (\r\n            <div className=\"mb-6 flex justify-center\">\r\n              <div className=\"w-32 h-32 rounded-full bg-gradient-primary flex items-center justify-center text-white text-5xl font-display border-4 border-white shadow-xl\">\r\n                {inviterInfo.displayName?.[0] || '?'}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <h1 className=\"text-4xl font-display text-white mb-4\">\r\n            Welcome to Besties!\r\n          </h1>\r\n          <p className=\"text-2xl text-white/90 mb-2\">\r\n            You accepted <span className=\"font-bold\">{inviterInfo.displayName}'s</span> request\r\n          </p>\r\n          <p className=\"text-xl text-white/90 mb-8\">\r\n            You are now besties! üéâ\r\n          </p>\r\n\r\n          <button\r\n            onClick={() => {\r\n              // Clean up inviter info and proceed to bestie circle\r\n              sessionStorage.removeItem('inviter_info');\r\n              localStorage.removeItem('inviter_info');\r\n              setInviterInfo(null);\r\n              setStep('bestie-circle');\r\n            }}\r\n            className=\"btn bg-white dark:bg-gray-800 text-primary hover:bg-white/90 dark:hover:bg-gray-700 text-lg px-8 py-4\"\r\n          >\r\n            Continue ‚Üí\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Bestie Circle Intro\r\n  if (step === 'bestie-circle') {\r\n    if (checkingBesties) {\r\n      return (\r\n        <div className=\"min-h-screen bg-white dark:bg-gray-800 flex items-center justify-center\">\r\n          <div className=\"spinner\"></div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"min-h-screen bg-white dark:bg-gray-800 flex items-center justify-center p-4 overflow-y-auto\">\r\n        <div className=\"max-w-2xl w-full py-8\">\r\n          <div className=\"text-center mb-8\">\r\n            <div className=\"text-6xl mb-4\">‚≠ê</div>\r\n            <h2 className=\"text-3xl font-display text-gray-800 dark:text-gray-200 mb-2\">\r\n              Your Bestie Circle\r\n            </h2>\r\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\r\n              These are the 5 besties who get notified if you miss a check-in.\r\n            </p>\r\n\r\n            {!hasBesties && (\r\n              <div className=\"bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-300 dark:border-yellow-600 rounded-xl p-4 mb-6\">\r\n                <p className=\"text-sm font-semibold text-yellow-800 dark:text-yellow-200\">\r\n                  ‚ö†Ô∏è You need at least one bestie to create a check-in\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {hasBesties && (\r\n              <div className=\"bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-600 rounded-xl p-4 mb-6\">\r\n                <p className=\"text-sm font-semibold text-green-800 dark:text-green-200\">\r\n                  ‚úÖ Great! You already have a bestie in your circle\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"card p-6 mb-6\">\r\n            <h3 className=\"font-display text-lg mb-4 text-center text-gray-800 dark:text-gray-200\">How It Works:</h3>\r\n            <ul className=\"space-y-3 text-sm text-gray-600 dark:text-gray-400\">\r\n              <li className=\"flex gap-3\">\r\n                <span className=\"text-2xl\">1Ô∏è‚É£</span>\r\n                <span>Choose up to 5 besties for your safety circle</span>\r\n              </li>\r\n              <li className=\"flex gap-3\">\r\n                <span className=\"text-2xl\">2Ô∏è‚É£</span>\r\n                <span>They'll get SMS alerts if you miss a check-in</span>\r\n              </li>\r\n              <li className=\"flex gap-3\">\r\n                <span className=\"text-2xl\">3Ô∏è‚É£</span>\r\n                <span>You can change who's in your circle anytime</span>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n\r\n          {hasBesties ? (\r\n            <button\r\n              onClick={handleFinish}\r\n              className=\"w-full btn btn-primary text-lg py-4\"\r\n            >\r\n              Start Creating Check-Ins! ‚Üí\r\n            </button>\r\n          ) : (\r\n            <>\r\n              <button\r\n                onClick={handleFinish}\r\n                className=\"w-full btn btn-primary text-lg py-4 mb-3\"\r\n              >\r\n                ‚ûï Add Your First Bestie\r\n              </button>\r\n\r\n              <p className=\"text-xs text-center text-gray-600 dark:text-gray-400\">\r\n                You'll be taken to your profile. Click on a + button in your bestie circle to continue\r\n              </p>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport default OnboardingPage;\r\n"],"names":["OnboardingPage","currentUser","userData","useAuth","navigate","useNavigate","step","setStep","useState","slideIndex","setSlideIndex","displayName","setDisplayName","uploading","setUploading","hasBesties","setHasBesties","checkingBesties","setCheckingBesties","inviterInfo","setInviterInfo","useEffect","storedInviterInfo","sessionStorage","getItem","localStorage","JSON","parse","e","console","error","slides","emoji","title","description","currentSlide","checkForBesties","async","i","Promise","resolve","setTimeout","requesterQuery","recipientQuery","all","getDocs","query","collection","db","where","uid","empty","handleSaveName","trim","updateDoc","doc","toast","handlePhotoUpload","file","target","files","size","uploadToast","loading","storageRef","ref","storage","concat","Date","now","name","uploadBytes","downloadURL","getDownloadURL","photoURL","success","id","handleSkipPhoto","handleFinish","onboardingCompleted","logAnalyticsEvent","require","has_besties","_jsx","className","children","_jsxs","onClick","map","_","index","length","_Fragment","type","value","onChange","placeholder","src","alt","accept","disabled","_inviterInfo$displayN","removeItem"],"sourceRoot":""}