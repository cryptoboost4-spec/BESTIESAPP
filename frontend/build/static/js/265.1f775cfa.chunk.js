"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[265],{3265:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var a=s(5043),l=s(7400),n=s(5472),i=s(579);const c=e=>{let{timeRange:t,setTimeRange:s}=e;return(0,i.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,i.jsx)("button",{onClick:()=>s("7d"),className:"px-4 py-2 rounded-full font-semibold ".concat("7d"===t?"bg-primary text-white":"bg-white text-text-primary"),children:"Last 7 Days"}),(0,i.jsx)("button",{onClick:()=>s("30d"),className:"px-4 py-2 rounded-full font-semibold ".concat("30d"===t?"bg-primary text-white":"bg-white text-text-primary"),children:"Last 30 Days"}),(0,i.jsx)("button",{onClick:()=>s("all"),className:"px-4 py-2 rounded-full font-semibold ".concat("all"===t?"bg-primary text-white":"bg-white text-text-primary"),children:"All Time"})]})},r=e=>{let{value:t,label:s,colorClass:a="text-primary",bgClass:l=""}=e;return(0,i.jsxs)("div",{className:"card p-4 text-center ".concat(l),children:[(0,i.jsx)("div",{className:"text-3xl font-display ".concat(a),children:t}),(0,i.jsx)("div",{className:"text-sm text-text-secondary",children:s})]})},o=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udc65 Users"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,i.jsx)(r,{value:t.users.total,label:"Total Users",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.users.new7days,label:"New (7d)",colorClass:"text-success"}),(0,i.jsx)(r,{value:t.users.new30days,label:"New (30d)",colorClass:"text-success"}),(0,i.jsx)(r,{value:t.users.active7days,label:"Active (7d)",colorClass:"text-secondary"}),(0,i.jsx)(r,{value:t.users.active30days,label:"Active (30d)",colorClass:"text-secondary"})]})]})},d=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\u2705 Check-ins"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,i.jsx)(r,{value:t.checkIns.total,label:"Total",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.checkIns.active,label:"Active Now",colorClass:"text-warning"}),(0,i.jsx)(r,{value:t.checkIns.completed,label:"Completed",colorClass:"text-success"}),(0,i.jsx)(r,{value:t.checkIns.alerted,label:"Alerted",colorClass:"text-danger"}),(0,i.jsx)(r,{value:t.checkIns.avgDuration,label:"Avg Minutes",colorClass:"text-accent"}),(0,i.jsx)(r,{value:"".concat(t.checkIns.completionRate,"%"),label:"Completion",colorClass:"text-success"})]})]})},x=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udc9c Besties Network"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsx)(r,{value:t.besties.totalConnections,label:"Total Connections",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.besties.accepted,label:"Accepted",colorClass:"text-success"}),(0,i.jsx)(r,{value:t.besties.pending,label:"Pending",colorClass:"text-warning"}),(0,i.jsx)(r,{value:t.besties.avgPerUser,label:"Avg Per User",colorClass:"text-secondary"})]})]})},m=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udcb0 Revenue"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsx)(r,{value:"$".concat(t.revenue.mrr),label:"MRR",colorClass:"text-white",bgClass:"bg-gradient-primary text-white"}),(0,i.jsx)(r,{value:t.revenue.smsSubscribers,label:"SMS Subscribers",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.revenue.donorsActive,label:"Active Donors",colorClass:"text-secondary"}),(0,i.jsx)(r,{value:"$".concat(t.revenue.totalDonations),label:"Total Donated",colorClass:"text-success"})]})]})},h=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udcc8 Engagement"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsx)(r,{value:t.engagement.avgCheckInsPerUser,label:"Check-ins/User",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.engagement.avgBestiesPerUser,label:"Besties/User",colorClass:"text-secondary"}),(0,i.jsx)(r,{value:t.engagement.templatesCreated,label:"Templates",colorClass:"text-accent"}),(0,i.jsx)(r,{value:t.engagement.badgesEarned,label:"Badges Earned",colorClass:"text-warning"})]})]})},u=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udcb8 Cost Tracking (Estimates)"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsx)(r,{value:"$".concat(t.costs.estimatedSMS),label:"SMS Costs",colorClass:"text-danger",bgClass:"bg-danger/10"}),(0,i.jsx)(r,{value:"$".concat(t.costs.estimatedWhatsApp),label:"WhatsApp Costs",colorClass:"text-success",bgClass:"bg-success/10"}),(0,i.jsx)(r,{value:"$".concat(t.costs.estimatedEmail),label:"Email Costs",colorClass:"text-primary",bgClass:"bg-primary/10"}),(0,i.jsx)(r,{value:t.costs.totalAlertsSent,label:"Total Alerts",colorClass:"text-accent"})]})]})},v=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udcca Growth Metrics"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"card p-4 text-center",children:[(0,i.jsxs)("div",{className:"text-3xl font-display ".concat(parseFloat(t.growth.userGrowthRate)>=0?"text-success":"text-danger"),children:[t.growth.userGrowthRate>0?"+":"",t.growth.userGrowthRate,"%"]}),(0,i.jsx)("div",{className:"text-sm text-text-secondary",children:"User Growth (WoW)"})]}),(0,i.jsxs)("div",{className:"card p-4 text-center",children:[(0,i.jsxs)("div",{className:"text-3xl font-display ".concat(parseFloat(t.growth.checkInGrowthRate)>=0?"text-success":"text-danger"),children:[t.growth.checkInGrowthRate>0?"+":"",t.growth.checkInGrowthRate,"%"]}),(0,i.jsx)("div",{className:"text-sm text-text-secondary",children:"Check-in Growth (WoW)"})]}),(0,i.jsxs)("div",{className:"card p-4 text-center",children:[(0,i.jsxs)("div",{className:"text-3xl font-display text-primary",children:[t.growth.retentionRate,"%"]}),(0,i.jsx)("div",{className:"text-sm text-text-secondary",children:"Retention Rate"})]})]})]})},g=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83c\udfaf User Funnel"}),(0,i.jsx)("div",{className:"card p-6",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-text-primary",children:"1. Sign Ups"}),(0,i.jsxs)("div",{className:"text-sm text-text-secondary",children:[t.funnel.signups," users"]})]}),(0,i.jsx)("div",{className:"text-2xl font-display text-primary",children:"100%"})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-text-primary",children:"2. Completed Onboarding"}),(0,i.jsxs)("div",{className:"text-sm text-text-secondary",children:[t.funnel.completedOnboarding," users"]})]}),(0,i.jsxs)("div",{className:"text-2xl font-display text-success",children:[t.funnel.onboardingRate,"%"]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-text-primary",children:"3. Added First Bestie"}),(0,i.jsxs)("div",{className:"text-sm text-text-secondary",children:[t.funnel.addedBestie," users"]})]}),(0,i.jsxs)("div",{className:"text-2xl font-display text-warning",children:[t.funnel.bestieRate,"%"]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-text-primary",children:"4. Created First Check-in"}),(0,i.jsxs)("div",{className:"text-sm text-text-secondary",children:[t.funnel.firstCheckIn," users"]})]}),(0,i.jsxs)("div",{className:"text-2xl font-display text-accent",children:[t.funnel.checkInRate,"%"]})]})]})})]})},p=e=>{let{analytics:t}=e;return(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-4",children:"\ud83d\udd50 User Behavior"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,i.jsx)(r,{value:"".concat(t.behavior.peakHour,":00"),label:"Peak Hour (24h)",colorClass:"text-primary"}),(0,i.jsx)(r,{value:t.behavior.peakDay,label:"Peak Day",colorClass:"text-secondary"}),(0,i.jsx)(r,{value:"".concat(t.behavior.mostCommonDuration,"m"),label:"Common Duration",colorClass:"text-accent"})]})]})},b=e=>{let{topLocations:t}=e;return(0,i.jsxs)("div",{className:"card p-6",children:[(0,i.jsx)("h3",{className:"font-display text-xl text-text-primary mb-4",children:"\ud83d\udccd Top Check-in Locations"}),t.length>0?(0,i.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,i.jsx)("span",{className:"font-semibold text-text-primary",children:e.location}),(0,i.jsx)("span",{className:"badge badge-primary",children:e.count})]},t))}):(0,i.jsx)("p",{className:"text-text-secondary text-center py-8",children:"No data yet"})]})},y=e=>{let{recentAlerts:t}=e;return(0,i.jsxs)("div",{className:"card p-6",children:[(0,i.jsx)("h3",{className:"font-display text-xl text-text-primary mb-4",children:"\ud83d\udea8 Recent Alerts"}),t.length>0?(0,i.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,i.jsxs)("div",{className:"p-3 bg-danger/10 border border-danger/20 rounded-lg",children:[(0,i.jsx)("div",{className:"font-semibold text-danger",children:e.userName}),(0,i.jsx)("div",{className:"text-sm text-text-secondary",children:e.location}),e.alertedAt&&(0,i.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:new Date(e.alertedAt.toDate()).toLocaleString()})]},e.id))}):(0,i.jsx)("p",{className:"text-text-secondary text-center py-8",children:"No alerts \ud83c\udf89"})]})},j=()=>{const[e,t]=(0,a.useState)({users:{total:0,new7days:0,new30days:0,active7days:0,active30days:0},checkIns:{total:0,active:0,completed:0,alerted:0,avgDuration:0,completionRate:0},besties:{totalConnections:0,avgPerUser:0,pending:0,accepted:0},revenue:{smsSubscribers:0,donorsActive:0,totalDonations:0,mrr:0},engagement:{avgCheckInsPerUser:0,avgBestiesPerUser:0,templatesCreated:0,badgesEarned:0},costs:{estimatedSMS:0,estimatedWhatsApp:0,estimatedEmail:0,totalAlertsSent:0},growth:{userGrowthRate:0,checkInGrowthRate:0,retentionRate:0},funnel:{signups:0,completedOnboarding:0,addedBestie:0,firstCheckIn:0,onboardingRate:0,bestieRate:0,checkInRate:0},behavior:{peakHour:0,peakDay:"",mostCommonDuration:0},topLocations:[],recentAlerts:[]}),[s,r]=(0,a.useState)(!0),[j,N]=(0,a.useState)("7d"),f=(0,a.useCallback)(async()=>{r(!0);try{var e,s;const a=new Date,i=new Date(a.getTime()-6048e5),c=new Date(a.getTime()-2592e6);let o=a;o="7d"===j?i:"30d"===j?c:new Date(0),console.log("[Analytics] Loading users...");const d=await(0,n.GG)((0,n.rJ)(l.db,"users"));console.log("[Analytics] \u2713 Users loaded:",d.size);let x=0,m=0,h=0,u=0,v=0;d.forEach(e=>{var t,s,a;const l=e.data();x++;const n=null===(t=l.stats)||void 0===t||null===(s=t.joinedAt)||void 0===s?void 0:s.toDate();n&&n>i&&m++,n&&n>c&&h++;const r=null===(a=l.lastActive)||void 0===a?void 0:a.toDate();r&&r>i&&u++,r&&r>c&&v++});let g=(0,n.rJ)(l.db,"checkins");"all"!==j&&(g=(0,n.P)(g,(0,n._M)("createdAt",">=",n.Dc.fromDate(o)))),console.log("[Analytics] Loading checkins...");const p=await(0,n.GG)(g);console.log("[Analytics] \u2713 Checkins loaded:",p.size);let b=0,y=0,N=0,f=0,C=0;const w={};p.forEach(e=>{const t=e.data();b++,C+=t.duration||0,"active"===t.status&&y++,"completed"===t.status&&N++,"alerted"===t.status&&f++,t.location&&(w[t.location]=(w[t.location]||0)+1)});const A=Object.entries(w).map(e=>{let[t,s]=e;return{location:t,count:s}}).sort((e,t)=>t.count-e.count).slice(0,10),k=b>0?(N/b*100).toFixed(1):0;console.log("[Analytics] Loading besties...");const R=await(0,n.GG)((0,n.rJ)(l.db,"besties"));console.log("[Analytics] \u2713 Besties loaded:",R.size);let D=0,S=0,I=0;R.forEach(e=>{const t=e.data();D++,"pending"===t.status&&S++,"accepted"===t.status&&I++});let E=0,F=0,G=0,U=0;d.forEach(e=>{var t,s;const a=e.data();var l,n;(null!==(t=a.smsSubscription)&&void 0!==t&&t.active&&(E++,U+=1),null!==(s=a.donationStats)&&void 0!==s&&s.isActive)&&(F++,G+=(null===(l=a.donationStats)||void 0===l?void 0:l.totalDonated)||0,null!==(n=a.donationStats)&&void 0!==n&&n.monthlyAmount&&(U+=a.donationStats.monthlyAmount))});const T=U;console.log("[Analytics] Loading templates...");const M=await(0,n.GG)((0,n.rJ)(l.db,"templates"));console.log("[Analytics] \u2713 Templates loaded:",M.size),console.log("[Analytics] Loading badges...");const B=await(0,n.GG)((0,n.rJ)(l.db,"badges"));console.log("[Analytics] \u2713 Badges loaded:",B.size);let P=0;B.forEach(e=>{var t;const s=e.data();P+=(null===(t=s.badges)||void 0===t?void 0:t.length)||0}),console.log("[Analytics] Loading recent alerts...");const L=(0,n.P)((0,n.rJ)(l.db,"checkins"),(0,n._M)("status","==","alerted"),(0,n.My)("alertedAt","desc")),O=await(0,n.GG)(L);console.log("[Analytics] \u2713 Recent alerts loaded:",O.size);const W=[],z=[];O.forEach(e=>{if(W.length<10){const t=e.data();z.push((async()=>{let s="Unknown";try{const a=await(0,n.x7)(e(l.db,"users",t.userId));a.exists()&&(s=a.data().displayName||"Unknown")}catch(a){console.error("Error fetching user name:",a)}W.push({id:e.id,location:t.location,alertedAt:t.alertedAt,userName:s})})())}}),await Promise.all(z);let J=0,H=0,$=0;p.forEach(e=>{const t=e.data();if("alerted"===t.status&&t.bestieIds){const e=t.bestieIds.length;J+=e,$+=Math.ceil(.7*e),H+=Math.floor(.3*e)}});const _=(.0075*H).toFixed(2),q=(.005*$).toFixed(2),K=0,Q=new Date(i.getTime()-6048e5);let V=0,X=0;d.forEach(e=>{var t,s;const a=null===(t=e.data().stats)||void 0===t||null===(s=t.joinedAt)||void 0===s?void 0:s.toDate();a&&a>Q&&a<i&&V++}),p.forEach(e=>{var t;const s=null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate();s&&s>Q&&s<i&&X++});const Y=V>0?((m-V)/V*100).toFixed(1):m>0?"\u221e":"N/A",Z=X>0?((b-X)/X*100).toFixed(1):b>0?"\u221e":"N/A",ee={};p.forEach(e=>{const t=e.data().userId;ee[t]=(ee[t]||0)+1});const te=Object.values(ee).filter(e=>e>1).length,se=x>0?(te/x*100).toFixed(1):0;console.log("[Analytics] Calculating funnel metrics...");let ae=0,le=0,ne=0,ie=null;d.forEach(e=>{var t,s;const a=e.data();var l,n;ie||(ie={id:e.id,onboardingCompleted:a.onboardingCompleted,statsExists:!!a.stats,totalBesties:null===(l=a.stats)||void 0===l?void 0:l.totalBesties,totalCheckIns:null===(n=a.stats)||void 0===n?void 0:n.totalCheckIns});a.onboardingCompleted&&ae++,(null===(t=a.stats)||void 0===t?void 0:t.totalBesties)>0&&le++,(null===(s=a.stats)||void 0===s?void 0:s.totalCheckIns)>0&&ne++}),console.log("[Analytics] Funnel Debug - Sample User:",ie),console.log("[Analytics] Funnel Counts:",{totalUsers:x,completedOnboarding:ae,addedBestie:le,firstCheckIn:ne});const ce=x>0?(ae/x*100).toFixed(1):0,re=ae>0?(le/ae*100).toFixed(1):0,oe=le>0?(ne/le*100).toFixed(1):0,de=new Array(24).fill(0),xe={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0},me={};p.forEach(e=>{var t;const s=e.data(),a=null===(t=s.createdAt)||void 0===t?void 0:t.toDate();if(a){de[a.getUTCHours()]++;xe[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a.getUTCDay()]]++}s.duration&&(me[s.duration]=(me[s.duration]||0)+1)});const he=de.indexOf(Math.max(...de)),ue=(null===(e=Object.entries(xe).sort((e,t)=>t[1]-e[1])[0])||void 0===e?void 0:e[0])||"N/A",ve=(null===(s=Object.entries(me).sort((e,t)=>t[1]-e[1])[0])||void 0===s?void 0:s[0])||30;t({users:{total:x,new7days:m,new30days:h,active7days:u,active30days:v},checkIns:{total:b,active:y,completed:N,alerted:f,avgDuration:b>0?Math.round(C/b):0,completionRate:k},besties:{totalConnections:D,avgPerUser:x>0?(2*I/x).toFixed(1):0,pending:S,accepted:I},revenue:{smsSubscribers:E,donorsActive:F,totalDonations:G.toFixed(2),mrr:T.toFixed(2)},engagement:{avgCheckInsPerUser:x>0?(b/x).toFixed(1):0,avgBestiesPerUser:x>0?(2*I/x).toFixed(1):0,templatesCreated:M.size,badgesEarned:P},costs:{estimatedSMS:_,estimatedWhatsApp:q,estimatedEmail:K,totalAlertsSent:J},growth:{userGrowthRate:Y,checkInGrowthRate:Z,retentionRate:se},funnel:{signups:x,completedOnboarding:ae,addedBestie:le,firstCheckIn:ne,onboardingRate:ce,bestieRate:re,checkInRate:oe},behavior:{peakHour:he,peakDay:ue,mostCommonDuration:ve},topLocations:A,recentAlerts:W}),r(!1)}catch(a){console.error("Error loading analytics:",a),"failed-precondition"===a.code?(console.error("Firestore index missing. Create index at:",a.message),alert("Analytics require database indices. Check console for index creation link.")):"permission-denied"===a.code?alert("Permission denied. Make sure your user document has the field:\n- isAdmin: true"):alert("Failed to load analytics: ".concat(a.message)),r(!1)}},[j]);return(0,a.useEffect)(()=>{f()},[f]),s?(0,i.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,i.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,i.jsx)("div",{className:"spinner"})})}):(0,i.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto p-4 pb-20",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"\ud83d\udcca Developer Analytics"}),(0,i.jsx)("p",{className:"text-text-secondary",children:"Real-time app metrics and insights"})]}),(0,i.jsx)(c,{timeRange:j,setTimeRange:N}),(0,i.jsx)(o,{analytics:e}),(0,i.jsx)(d,{analytics:e}),(0,i.jsx)(x,{analytics:e}),(0,i.jsx)(m,{analytics:e}),(0,i.jsx)(h,{analytics:e}),(0,i.jsx)(u,{analytics:e}),(0,i.jsx)(v,{analytics:e}),(0,i.jsx)(g,{analytics:e}),(0,i.jsx)(p,{analytics:e}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,i.jsx)(b,{topLocations:e.topLocations}),(0,i.jsx)(y,{recentAlerts:e.recentAlerts})]}),(0,i.jsx)("button",{onClick:f,className:"w-full btn btn-primary",disabled:s,children:"\ud83d\udd04 Refresh Data"})]})})}}}]);
//# sourceMappingURL=265.1f775cfa.chunk.js.map