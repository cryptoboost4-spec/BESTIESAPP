"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[206],{3319:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(2555),a=r(5043),i=r(8838);const l=e=>{let{trigger:t=!1,type:r="default"}=e;return(0,a.useEffect)(()=>{if(!t)return;(()=>{if("badge"===r){const e=200,t={origin:{y:.7},shapes:["circle","square"],colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]};function a(r,a){(0,i.A)((0,s.A)((0,s.A)((0,s.A)({},t),a),{},{particleCount:Math.floor(e*r)}))}a(.25,{spread:26,startVelocity:55}),a(.2,{spread:60}),a(.35,{spread:100,decay:.91,scalar:.8}),a(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),a(.1,{spread:120,startVelocity:45})}else"milestone"===r?((0,i.A)({particleCount:150,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#87CEEB","#98FB98"]}),setTimeout(()=>{(0,i.A)({particleCount:100,angle:60,spread:55,origin:{x:0},colors:["#FF69B4","#DDA0DD","#FFB6C1"]})},200),setTimeout(()=>{(0,i.A)({particleCount:100,angle:120,spread:55,origin:{x:1},colors:["#87CEEB","#98FB98","#FFB6C1"]})},400)):(0,i.A)({particleCount:100,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]})})()},[t,r]),null}},8206:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var s=r(2555),a=r(5043),i=r(3216),l=r(4528),n=r(7400),o=r(5472),d=r(8147),c=r(2339),x=r(559);const u=e=>{if(!e)return!1;return/^\+[1-9]\d{1,14}$/.test(e)};var m=r(6823);const p=(e,t,r)=>{var s;const a=!(null===t||void 0===t||!t.email),i=!(null===e||void 0===e||!e.phoneNumber),l=!(null===e||void 0===e||!e.photoURL),n=!(null===e||void 0===e||null===(s=e.profile)||void 0===s||!s.bio);return a&&i&&l&&n&&r>=5},h=async e=>{try{const t="profile_perfectionist",r=await(0,o.x7)((0,o.H9)(n.db,"badges",e));if(r.exists()){const s=r.data().badges||[];if(s.some(e=>e.id===t))return!1;await(0,o.mZ)((0,o.H9)(n.db,"badges",e),{badges:(0,o.hq)({id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"})})}else await(0,o.BN)((0,o.H9)(n.db,"badges",e),{badges:[{id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"}]});return await m.l.notifyBadgeEarned(e,"Profile Perfectionist","You completed your entire profile! You're all set to stay safe with your besties."),!0}catch(t){return console.error("Error awarding profile completion badge:",t),!1}},f=async(e,t,r,s)=>{if(p(t,r,s)){return await h(e)}return!1};var b=r(3319),y=r(579);const v=e=>{let{isOpen:t,onClose:r}=e;const[s,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(t){i(!0);const e=setTimeout(()=>{i(!1)},5e3);return()=>clearTimeout(e)}},[t]),t?(0,y.jsxs)(y.Fragment,{children:[s&&(0,y.jsx)(b.A,{}),(0,y.jsx)("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",children:(0,y.jsxs)("div",{className:"card max-w-lg w-full p-8 animate-scale-up relative overflow-hidden bg-white dark:bg-gray-800",children:[(0,y.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,y.jsx)("div",{className:"absolute top-6 left-6 text-3xl animate-float opacity-60",children:"\u2b50"}),(0,y.jsx)("div",{className:"absolute top-10 right-8 text-2xl animate-float delay-1s opacity-50",children:"\ud83d\udcab"}),(0,y.jsx)("div",{className:"absolute bottom-10 left-10 text-2xl animate-float delay-2s opacity-60",children:"\u2728"}),(0,y.jsx)("div",{className:"absolute bottom-6 right-6 text-3xl animate-float delay-3s opacity-50",children:"\ud83c\udf89"})]}),(0,y.jsxs)("div",{className:"relative z-10 text-center",children:[(0,y.jsx)("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-yellow-200 to-yellow-400 rounded-full mb-6 shadow-2xl animate-bounce-slow",children:(0,y.jsx)("span",{className:"text-5xl",children:"\u2b50"})}),(0,y.jsx)("h2",{className:"text-4xl font-display bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Congratulations!"}),(0,y.jsx)("h3",{className:"text-2xl font-display text-text-primary dark:text-white mb-4",children:"Profile Perfectionist Unlocked!"}),(0,y.jsx)("p",{className:"text-lg text-text-secondary dark:text-gray-300 mb-6 max-w-md mx-auto",children:"You've completed your entire profile! Your besties can now see all your info, and you're all set to stay safe together."}),(0,y.jsxs)("div",{className:"inline-block bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30 rounded-2xl p-6 mb-6 border-2 border-pink-200 dark:border-pink-700 shadow-xl",children:[(0,y.jsx)("div",{className:"text-5xl mb-2",children:"\u2b50"}),(0,y.jsx)("div",{className:"text-xl font-display text-text-primary dark:text-white mb-1",children:"Profile Perfectionist"}),(0,y.jsx)("div",{className:"text-sm text-text-secondary dark:text-gray-300",children:"Completed your full profile"})]}),(0,y.jsxs)("div",{className:"bg-gradient-to-r from-pink-100 to-purple-100 dark:from-pink-900/40 dark:to-purple-900/40 rounded-xl p-4 mb-6 border border-pink-200 dark:border-pink-800",children:[(0,y.jsx)("div",{className:"text-sm font-semibold text-text-primary dark:text-white mb-2",children:"\ud83c\udfaf Profile Complete! Here's what you unlocked:"}),(0,y.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary dark:text-gray-300",children:[(0,y.jsx)("div",{children:"\u2705 Full profile visibility to your besties"}),(0,y.jsx)("div",{children:"\u2705 Profile Perfectionist badge"}),(0,y.jsx)("div",{children:"\u2705 Priority support access"}),(0,y.jsx)("div",{children:"\u2705 Shareable profile cards"})]})]}),(0,y.jsx)("button",{onClick:r,className:"btn btn-primary w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transition-all",children:"Awesome! Let's Go! \ud83c\udf89"}),(0,y.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400 mt-4",children:"Check your Notifications to see your new badge"})]})]})})]}):null},g=()=>{var e,t,r,m;const{currentUser:p,userData:h}=(0,l.As)(),b=(0,i.Zp)(),[g,j]=(0,a.useState)((null===h||void 0===h?void 0:h.displayName)||""),[N,w]=(0,a.useState)((null===h||void 0===h||null===(e=h.profile)||void 0===e?void 0:e.bio)||""),[k,C]=(0,a.useState)((null===h||void 0===h||null===(t=h.profile)||void 0===t?void 0:t.birthdate)||""),[A,P]=(0,a.useState)((null===h||void 0===h?void 0:h.phoneNumber)||""),[F,D]=(0,a.useState)(null),[S,B]=(0,a.useState)((null===h||void 0===h?void 0:h.photoURL)||null),[R,L]=(0,a.useState)(!1),[U,E]=(0,a.useState)(!1),[V,G]=(0,a.useState)(""),[M,z]=(0,a.useState)(null),[I,T]=(0,a.useState)(""),[_,Y]=(0,a.useState)(!1),q=async()=>{if(!A||A===(null===h||void 0===h?void 0:h.phoneNumber))return void c.Ay.error("Please enter a new phone number");const e=A.trim();if(!e)return void c.Ay.error("Please enter a phone number");if(!/^[0-9+\s\-()]+$/.test(e))return void c.Ay.error("Phone number can only contain digits, +, spaces, hyphens, and parentheses");let t=e.replace(/[\s\-()]/g,"");if(t.startsWith("+")||(t=t.startsWith("0")?"+61"+t.slice(1):"+"+t),!u(t))return void c.Ay.error("Invalid phone number format. Please enter a valid international number (e.g., +61412345678 or 0412345678)",{duration:5e3});const r=t.slice(1);if(r.length<8)return void c.Ay.error("Phone number is too short. Please enter a complete phone number");if(r.length>15)return void c.Ay.error("Phone number is too long. Please check and try again");L(!0);const s=n.y1.setupRecaptcha("phone-recaptcha-container");if(!s.success)return c.Ay.error("Failed to set up verification. Please refresh the page."),void L(!1);const a=await n.y1.sendPhoneVerification(t,s.verifier);L(!1),a.success?(z(a.confirmationResult),T(t),E(!0),c.Ay.success("Verification code sent to your phone!")):c.Ay.error(a.error||"Failed to send verification code")},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=(null===h||void 0===h?void 0:h.photoURL)||null;if(F){const e=await(async()=>{if(!F)return(null===h||void 0===h?void 0:h.photoURL)||null;try{const e=(0,d.KR)(n.IG,"profile-pictures/".concat(p.uid,"/").concat(Date.now(),"_").concat(F.name));return await(0,d.D)(e,F),await(0,d.qk)(e)}catch(e){return console.error("Error uploading profile picture:",e),c.Ay.error("Failed to upload profile picture"),(null===h||void 0===h?void 0:h.photoURL)||null}})();e&&(t=e)}await(0,o.mZ)((0,o.H9)(n.db,"users",p.uid),{displayName:g,phoneNumber:e||A,photoURL:t,"profile.bio":N,"profile.birthdate":k,updatedAt:new Date}),c.Ay.success("Profile updated successfully!");const r=(0,o.P)((0,o.rJ)(n.db,"besties"),(0,o._M)("requesterId","==",p.uid),(0,o._M)("status","==","accepted")),a=(0,o.P)((0,o.rJ)(n.db,"besties"),(0,o._M)("recipientId","==",p.uid),(0,o._M)("status","==","accepted")),[i,l]=await Promise.all([(0,o.GG)(r),(0,o.GG)(a)]),x=i.size+l.size,u=(0,s.A)((0,s.A)({},h),{},{displayName:g,phoneNumber:e||A,photoURL:t,profile:(0,s.A)((0,s.A)({},null===h||void 0===h?void 0:h.profile),{},{bio:N,birthdate:k})});await f(p.uid,u,p,x)?Y(!0):setTimeout(()=>{b("/profile")},500)}catch(t){console.error("Error updating profile:",t),c.Ay.error(t.message||"Failed to update profile")}finally{L(!1)}};return(0,y.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,y.jsx)(x.A,{}),(0,y.jsxs)("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[(0,y.jsxs)("div",{className:"mb-6",children:[(0,y.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"Edit Profile"}),(0,y.jsx)("p",{className:"text-text-secondary",children:"Update your personal information"})]}),(0,y.jsxs)("form",{onSubmit:async e=>{e.preventDefault();A&&A!==(null===h||void 0===h?void 0:h.phoneNumber)?q():(L(!0),await H())},className:"space-y-6",children:[(0,y.jsxs)("div",{className:"card p-6",children:[(0,y.jsx)("label",{className:"block text-lg font-display text-text-primary mb-4",children:"Profile Picture"}),(0,y.jsxs)("div",{className:"flex items-center gap-6",children:[(0,y.jsx)("div",{className:"w-24 h-24 bg-gradient-primary rounded-full flex items-center justify-center text-white text-3xl font-display overflow-hidden",children:S?(0,y.jsx)("img",{src:S,alt:"Profile",className:"w-full h-full object-cover"}):(null===g||void 0===g?void 0:g[0])||"U"}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return void c.Ay.error("File size must be less than 5MB");D(t),B(URL.createObjectURL(t))}},className:"hidden",id:"profile-picture"}),(0,y.jsx)("label",{htmlFor:"profile-picture",className:"btn btn-secondary cursor-pointer inline-block",children:"Choose Photo"}),(0,y.jsx)("div",{className:"text-sm text-text-secondary mt-2",children:"JPG, PNG or GIF. Max size 5MB"})]})]})]}),(0,y.jsxs)("div",{className:"card p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Basic Information"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Display Name"}),(0,y.jsx)("input",{type:"text",value:g,onChange:e=>j(e.target.value),className:"input",placeholder:"Your name",required:!0})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Bio"}),(0,y.jsx)("textarea",{value:N,onChange:e=>w(e.target.value),className:"input min-h-[80px] resize-none",placeholder:"Tell people about yourself...",maxLength:150}),(0,y.jsxs)("div",{className:"text-xs text-text-secondary mt-1",children:[N.length,"/150 characters"]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Birthday \ud83c\udf82"}),(0,y.jsx)("input",{type:"date",value:k,onChange:e=>C(e.target.value),className:"input",max:(new Date).toISOString().split("T")[0]}),(0,y.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"Your besties will be notified on your birthday! (Optional)"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Phone Number"}),(0,y.jsxs)("div",{className:"flex gap-2",children:[(0,y.jsx)("input",{type:"tel",value:A,onChange:e=>P(e.target.value),className:"input flex-1",placeholder:"+61 400 000 000 or 0400 000 000"}),A!==(null===h||void 0===h?void 0:h.phoneNumber)&&A&&(0,y.jsx)("button",{type:"button",onClick:q,disabled:R,className:"btn btn-primary whitespace-nowrap",children:R?"Sending...":"Verify Now"})]}),A!==(null===h||void 0===h?void 0:h.phoneNumber)&&A&&(0,y.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:'\u26a0\ufe0f Click "Verify Now" to verify this number via SMS'})]})]})]}),(0,y.jsxs)("div",{className:"card p-6",children:[(0,y.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Account Info"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Email"}),(0,y.jsx)("div",{className:"font-semibold text-text-primary",children:null===p||void 0===p?void 0:p.email}),(0,y.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"To change your email, use Google authentication"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Member Since"}),(0,y.jsx)("div",{className:"font-semibold text-text-primary",children:(null===h||void 0===h||null===(r=h.stats)||void 0===r||null===(m=r.joinedAt)||void 0===m?void 0:m.toDate().toLocaleDateString())||"Recently"})]})]})]}),(0,y.jsxs)("div",{className:"flex gap-3",children:[(0,y.jsx)("button",{type:"button",onClick:()=>b("/profile"),className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,y.jsxs)("button",{type:"submit",disabled:R,className:"flex-1 btn btn-primary flex items-center justify-center gap-2",children:[R&&(0,y.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),R?"Sending verification...":"Save Changes"]})]})]}),U&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,y.jsxs)("div",{className:"card dark:bg-gray-800 p-6 max-w-md w-full animate-scale-up",children:[(0,y.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"Verify Phone Number"}),(0,y.jsxs)("p",{className:"text-text-secondary mb-4",children:["We sent a 6-digit code to ",(0,y.jsx)("strong",{children:I})]}),(0,y.jsxs)("div",{className:"mb-4",children:[(0,y.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Verification Code"}),(0,y.jsx)("input",{type:"text",value:V,onChange:e=>G(e.target.value),className:"input",placeholder:"123456",maxLength:6,autoFocus:!0})]}),(0,y.jsxs)("div",{className:"flex gap-3",children:[(0,y.jsx)("button",{onClick:()=>{E(!1),G(""),z(null)},className:"flex-1 btn btn-secondary",disabled:R,children:"Cancel"}),(0,y.jsxs)("button",{onClick:async()=>{if(!V||!M)return void c.Ay.error("Please enter the verification code");L(!0);const e=await n.y1.verifyPhoneCode(M,V);e.success?(c.Ay.success("Phone number verified!"),E(!1),P(I),H(I)):(L(!1),c.Ay.error(e.error||"Invalid verification code"))},className:"flex-1 btn btn-primary flex items-center justify-center gap-2",disabled:R||6!==V.length,children:[R&&(0,y.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),R?"Verifying & Saving...":"Verify & Save"]})]}),(0,y.jsxs)("p",{className:"text-xs text-text-secondary mt-4 text-center",children:["Didn't receive the code?"," ",(0,y.jsx)("button",{onClick:q,className:"text-primary underline",disabled:R,children:"Resend"})]})]})}),(0,y.jsx)("div",{id:"phone-recaptcha-container"}),(0,y.jsx)(v,{isOpen:_,onClose:()=>{Y(!1),b("/profile")}})]})]})}}}]);
//# sourceMappingURL=206.8bda7b8f.chunk.js.map