"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[745],{2184:(e,s,t)=>{t.d(s,{Gv:()=>r,Ol:()=>a});const r={core:!0,auth:!0,checkIns:!0,besties:!0,templates:!0,quickButtons:!0,celebrationMessages:!0,gpsLocation:!0,manualLocation:!0,extendButtons:!0,bestieCircle:!0,badges:!0,shareableCards:!0,mediaUpload:!0,photoCapture:!0,donations:!0,smsSubscription:!0,messengerAlerts:!0,telegramAlerts:!0,emergency:!1,reversePin:!1,liveTracking:!1,videoRecording:!1,facebookLogin:!1,phoneAuth:!1},a=e=>!0===r[e]},3745:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var r=t(5043),a=t(3216),n=t(4528),i=t(3889),l=t(3984),o=t(5472),c=t(2339),d=t(4505),x=t(7329);const m={botUsername:"Bestiesappbot",getLinkForUser:e=>"https://t.me/Bestiesappbot?start=".concat(e),botLink:"https://t.me/Bestiesappbot"};var u=t(5979),h=t(579);const y=e=>{var s,t,r,a,n;let{userData:i,currentUserId:l,toggleNotification:o,togglePushNotifications:c,pushNotificationsSupported:d,pushNotificationsEnabled:x,loading:y,smsWeeklyCount:b,onOpenTestModal:g}=e;return(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Notifications"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between opacity-50",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center gap-2 flex-wrap",children:["WhatsApp",(0,h.jsx)("span",{className:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full whitespace-nowrap",children:"Coming Soon"}),(0,h.jsx)(u.A,{message:"WhatsApp notifications will be sent when your besties check in or need help. This is the most reliable option for mobile alerts and will be completely free!"})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:"Integration in development"})]}),(0,h.jsx)("button",{className:"w-12 h-6 rounded-full transition-colors bg-gray-300 dark:bg-gray-600 cursor-not-allowed flex-shrink-0 ml-3",disabled:!0,children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform translate-x-1"})})]}),(0,h.jsxs)("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center gap-2 flex-wrap",children:["Telegram",(0,h.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded-full whitespace-nowrap",children:"Free & Unlimited"}),(0,h.jsx)(u.A,{message:"Connect YOUR Telegram account to receive safety alerts when your besties need help. Click 'Connect' below, then send /start to the bot!"})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary mt-1",children:null!==i&&void 0!==i&&i.telegramChatId?"\u2705 Connected":"\u26a0\ufe0f Not connected"})]}),(0,h.jsx)("button",{onClick:()=>o("telegram"),disabled:!(null!==i&&void 0!==i&&i.telegramChatId),className:"w-12 h-6 rounded-full transition-colors flex-shrink-0 ml-3 ".concat(null!==i&&void 0!==i&&i.telegramChatId?null!==i&&void 0!==i&&null!==(s=i.notificationPreferences)&&void 0!==s&&s.telegram?"bg-primary":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700 cursor-not-allowed"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(null!==i&&void 0!==i&&null!==(t=i.notificationPreferences)&&void 0!==t&&t.telegram?"translate-x-6":"translate-x-1")})})]}),!(null!==i&&void 0!==i&&i.telegramChatId)&&(0,h.jsxs)("button",{onClick:()=>{const e=m.getLinkForUser(l);window.open(e,"_blank")},className:"btn btn-primary w-full text-sm py-2",children:[(0,h.jsx)("svg",{className:"w-4 h-4 mr-2 inline",fill:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{d:"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18.717-.962 3.767-1.362 5.001-.168.525-.504.7-.826.717-.698.025-1.23-.461-1.907-.903-1.061-.696-1.659-1.128-2.69-1.806-1.19-.782-.42-1.211.26-1.911.177-.184 3.252-2.98 3.31-3.233.007-.032.014-.15-.056-.212-.07-.062-.174-.041-.249-.024-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.752-.245-1.349-.374-1.297-.789.027-.216.324-.437.892-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.332-1.386 4.025-1.627 4.476-1.635.099-.001.321.023.465.14.121.098.155.231.171.324.016.093.036.304.02.469z"})}),"Connect Telegram"]})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["Push Notifications",(0,h.jsx)(u.A,{message:"Browser push notifications work when your browser is open. For mobile alerts, we recommend Telegram or SMS."})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:d?"Browser notifications":"Not supported in this browser"})]}),(0,h.jsx)("button",{onClick:c,disabled:!d||y,className:"w-12 h-6 rounded-full transition-colors ".concat(d?x?"bg-primary":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700 cursor-not-allowed"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(x?"translate-x-6":"translate-x-1")})})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["SMS Alerts",(0,h.jsx)(u.A,{message:"Text message alerts - currently free during beta (5 per week)."})]}),(0,h.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-1 rounded-full font-semibold",children:"Free Beta"})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:null!==i&&void 0!==i&&null!==(r=i.notificationPreferences)&&void 0!==r&&r.sms?"Active - ".concat(b,"/5 this week"):"Not enabled"})]}),(0,h.jsx)("button",{onClick:()=>o("sms"),className:"w-12 h-6 rounded-full transition-colors ".concat(null!==i&&void 0!==i&&null!==(a=i.notificationPreferences)&&void 0!==a&&a.sms?"bg-primary":"bg-gray-300 dark:bg-gray-600"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(null!==i&&void 0!==i&&null!==(n=i.notificationPreferences)&&void 0!==n&&n.sms?"translate-x-6":"translate-x-1")})})]})]}),(0,h.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:[(0,h.jsx)("button",{onClick:g,disabled:y,className:"w-full btn btn-primary",children:"\ud83e\uddea Test Notifications"}),(0,h.jsx)("p",{className:"text-xs text-text-secondary mt-2 text-center",children:"Send a test notification to verify your setup"})]})]})};var b=t(5080),g=t(2555);const p=e=>{let{userId:s}=e;const[t,a]=(0,r.useState)([]),[n,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!s)return;const e=(0,o.rJ)(l.db,"messengerContacts"),t=(0,o.P)(e,(0,o._M)("userId","==",s)),r=(0,o.aQ)(t,e=>{const s=e.docs.map(e=>(0,g.A)({id:e.id},e.data())),t=Date.now(),r=s.filter(e=>{var s;return(null===(s=e.expiresAt)||void 0===s?void 0:s.toMillis())>t}).sort((e,s)=>{var t,r;return(null===(t=s.connectedAt)||void 0===t?void 0:t.toMillis())-(null===(r=e.connectedAt)||void 0===r?void 0:r.toMillis())});a(r),i(!1)});return()=>r()},[s]),(0,r.useEffect)(()=>{const e=setInterval(()=>{d(e=>e+1)},6e4);return()=>clearInterval(e)},[]);const x=e=>{const s=Date.now(),t=(null===e||void 0===e?void 0:e.toMillis())-s;if(t<=0)return"Expired";const r=Math.floor(t/36e5),a=Math.floor(t%36e5/6e4);return r>0?"".concat(r,"h ").concat(a,"m remaining"):"".concat(a,"m remaining")};return n?(0,h.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,h.jsx)("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg"}),(0,h.jsx)("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded-lg"})]}):0===t.length?(0,h.jsxs)("div",{className:"text-center py-8",children:[(0,h.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcac"}),(0,h.jsx)("p",{className:"text-text-secondary text-sm",children:"No active Messenger contacts yet"}),(0,h.jsx)("p",{className:"text-text-secondary text-xs mt-1",children:"Share your link to get emergency contacts connected!"})]}):(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("h3",{className:"text-sm font-semibold text-text-primary",children:["Connected Contacts (",t.length,")"]}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"text-xs text-text-secondary",children:"Auto-updates"}),(0,h.jsx)("button",{onClick:()=>{d(e=>e+1)},className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Refresh countdown timers",children:(0,h.jsx)("svg",{className:"w-4 h-4 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})]}),t.map(e=>{var s;return(0,h.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,h.jsx)("div",{className:"flex-shrink-0",children:e.photoURL?(0,h.jsx)("img",{src:e.photoURL,alt:e.name,className:"w-12 h-12 rounded-full object-cover"}):(0,h.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-semibold",children:(null===(s=e.name)||void 0===s?void 0:s.charAt(0))||"?"})}),(0,h.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary truncate",children:e.name}),(0,h.jsx)("div",{className:"text-xs text-text-secondary",children:x(e.expiresAt)})]}),(0,h.jsx)("div",{className:"flex-shrink-0",children:(0,h.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,h.jsx)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{d:"M12 2C6.477 2 2 6.145 2 11.235c0 2.894 1.447 5.48 3.71 7.155V22l3.477-1.906c.929.257 1.915.394 2.813.394 5.523 0 10-4.145 10-9.235C22 6.145 17.523 2 12 2zm.972 12.413l-2.562-2.732-5.002 2.732 5.502-5.838 2.623 2.732 4.941-2.732-5.502 5.838z"})})})})]},"".concat(e.id,"-").concat(c))}),(0,h.jsxs)("div",{className:"text-xs text-text-secondary mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:["\ud83d\udca1 ",(0,h.jsx)("strong",{children:"Tip:"})," Contacts can reconnect anytime by sending you another message using your Messenger link."]})]})},v=e=>{let{userId:s}=e;const[t,a]=(0,r.useState)(!1),[n,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(0),x=b.d.getLinkForUser(s);(0,r.useEffect)(()=>{if(!s)return;const e=(0,o.rJ)(l.db,"messengerContacts"),t=(0,o.P)(e,(0,o._M)("userId","==",s)),r=(0,o.aQ)(t,e=>{const s=Date.now(),t=e.docs.filter(e=>{var t;return(null===(t=e.data().expiresAt)||void 0===t?void 0:t.toMillis())>s}).length;d(t)});return()=>r()},[s]);const m=async()=>{try{await navigator.clipboard.writeText(x),a(!0),setTimeout(()=>a(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,h.jsxs)("h2",{className:"text-xl font-display text-text-primary flex items-center gap-2",children:["Facebook Messenger Contacts",(0,h.jsx)(u.A,{message:"Share your personal Messenger link with emergency contacts. When they click it and send any message, they're connected for 20 hours. They'll get alerts if you don't check in safely.\n\nHow it works:\n1. Share link with emergency contacts\n2. They click & send ANY message on Messenger\n3. Connected for 20 hours automatically\n4. Select them when creating check-ins\n5. They get alerts if you don't check in\n\nWhy use this?\n\u2022 Unlimited contacts (no 5-person limit)\n\u2022 Completely free forever\n\u2022 Easy setup - just one message\n\u2022 Auto-expires after 20 hours for privacy\n\u2022 Instant real-time alerts"})]}),(0,h.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-3 py-1 rounded-full font-semibold",children:"Free & Unlimited"})]}),(0,h.jsx)("div",{className:"mb-3",children:(0,h.jsxs)("div",{className:"flex gap-2",children:[(0,h.jsx)("div",{className:"flex-1 bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2 text-sm font-mono text-text-primary overflow-x-auto whitespace-nowrap",children:x}),(0,h.jsx)("button",{onClick:m,className:"btn ".concat(t?"btn-success":"btn-secondary"," flex-shrink-0"),children:t?"Copied!":"Copy"})]})}),(0,h.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-3",children:[(0,h.jsx)("button",{onClick:()=>{window.open("https://www.facebook.com/dialog/send?link=".concat(encodeURIComponent(x),"&app_id=464891037130549&redirect_uri=").concat(encodeURIComponent(window.location.href)),"_blank")},className:"w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center transition-colors",title:"Share via Messenger",children:(0,h.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{d:"M12 2C6.477 2 2 6.145 2 11.235c0 2.894 1.447 5.48 3.71 7.155V22l3.477-1.906c.929.257 1.915.394 2.813.394 5.523 0 10-4.145 10-9.235C22 6.145 17.523 2 12 2z"})})}),(0,h.jsx)("a",{href:"https://wa.me/?text=".concat(encodeURIComponent("Add me as your safety bestie! ".concat(x))),target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-green-500 hover:bg-green-600 text-white flex items-center justify-center transition-colors",title:"Share via WhatsApp",children:(0,h.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})})}),(0,h.jsx)("a",{href:"sms:?body=".concat(encodeURIComponent("Add me as your safety bestie! ".concat(x))),className:"w-10 h-10 rounded-full bg-gray-500 hover:bg-gray-600 text-white flex items-center justify-center transition-colors",title:"Share via SMS",children:(0,h.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,h.jsx)("button",{onClick:m,className:"w-10 h-10 rounded-full ".concat(t?"bg-green-500":"bg-purple-500 hover:bg-purple-600"," text-white flex items-center justify-center transition-colors"),title:t?"Copied!":"Copy Link",children:(0,h.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t?(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}):(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),(0,h.jsxs)("button",{onClick:()=>i(!n),className:"w-full text-sm text-primary hover:text-primary-dark transition-colors flex items-center justify-center gap-2",children:[c>0?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("span",{className:"font-semibold",children:c}),"active connection",1!==c?"s":""]}):"No active connections",(0,h.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(n?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,h.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:(0,h.jsx)(p,{userId:s})})]})},f=e=>{var s,t;let{isOpen:a,onClose:n,userData:i,onSendTest:l,loading:o}=e;const[c,d]=(0,r.useState)({push:!0,sms:!1,telegram:!1});if(!a)return null;const x=[{id:"push",name:"Push Notifications",enabled:null===i||void 0===i?void 0:i.notificationsEnabled,description:"Browser push notification"},{id:"telegram",name:"Telegram",enabled:(null===i||void 0===i||null===(s=i.notificationPreferences)||void 0===s?void 0:s.telegram)&&(null===i||void 0===i?void 0:i.telegramChatId),description:"Send to your Telegram"},{id:"sms",name:"SMS",enabled:(null===i||void 0===i||null===(t=i.notificationPreferences)||void 0===t?void 0:t.sms)&&(null===i||void 0===i?void 0:i.phoneNumber),description:"Send text message"}],m=Object.values(c).filter(Boolean).length,u=x.some(e=>e.enabled&&c[e.id]);return(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:n,children:(0,h.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,h.jsx)("h2",{className:"text-2xl font-display text-text-primary",children:"Test Alerts"}),(0,h.jsx)("button",{onClick:n,className:"text-text-secondary hover:text-text-primary transition-colors",children:(0,h.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,h.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:"Select which notification channels to test."}),(0,h.jsx)("div",{className:"space-y-3 mb-6",children:x.map(e=>(0,h.jsx)("div",{className:"border rounded-lg p-4 transition-colors ".concat(e.enabled?c[e.id]?"border-primary bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary":"border-gray-200 dark:border-gray-700 opacity-50 cursor-not-allowed"),children:(0,h.jsxs)("label",{className:"flex items-start gap-3 ".concat(e.enabled?"cursor-pointer":"cursor-not-allowed"),children:[(0,h.jsx)("input",{type:"checkbox",checked:c[e.id],onChange:()=>{return s=e.id,void d(e=>(0,g.A)((0,g.A)({},e),{},{[s]:!e[s]}));var s},disabled:!e.enabled,className:"mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:"font-semibold text-text-primary",children:e.name}),e.enabled&&(0,h.jsx)("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded-full",children:"Enabled"})]}),(0,h.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:e.description}),!e.enabled&&(0,h.jsx)("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:"Enable this in notification settings first"})]})]})},e.id))}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("button",{onClick:n,className:"flex-1 btn btn-secondary",disabled:o,children:"Cancel"}),(0,h.jsx)("button",{onClick:()=>{l(c)},disabled:o||!u,className:"flex-1 btn btn-primary",children:o?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,h.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,h.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"Send Test ".concat(m>0?"(".concat(m,")"):"")})]})]})})},j=e=>{var s;let{userData:t,handleSMSSubscription:r,loading:a,setLoading:n,navigate:i}=e;return(0,h.jsx)(h.Fragment,{children:null!==t&&void 0!==t&&null!==(s=t.smsSubscription)&&void 0!==s&&s.active?(0,h.jsxs)("div",{className:"card p-6 mb-6 bg-green-50 dark:bg-green-900/30 border-2 border-green-300 dark:border-green-600",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-2",children:"\u2705 Premium SMS Active"}),(0,h.jsx)("p",{className:"text-text-secondary mb-4",children:"You're subscribed to premium SMS alerts - up to 20 SMS per month"}),(0,h.jsx)("button",{onClick:async()=>{n(!0);try{const e=await d.Ay.createPortalSession();e.data&&e.data.url?window.location.href=e.data.url:c.Ay.error("Failed to open subscription portal")}catch(e){console.error("Portal session error:",e),c.Ay.error("Failed to open subscription portal")}finally{n(!1)}},disabled:a,className:"btn btn-secondary",children:a?"Loading...":"Manage Subscription"})]}):(0,h.jsxs)("div",{className:"card p-6 mb-6 bg-gradient-secondary dark:from-purple-900/30 dark:to-pink-900/30",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-2",children:"Premium SMS Alerts"}),(0,h.jsx)("p",{className:"text-text-secondary mb-4",children:"Get up to 20 SMS alerts per month for just $1/month"}),(0,h.jsxs)("ul",{className:"text-sm text-text-secondary mb-4 space-y-1",children:[(0,h.jsx)("li",{children:"\u2713 20 SMS alerts per month"}),(0,h.jsx)("li",{children:"\u2713 Priority delivery"}),(0,h.jsx)("li",{children:"\u2713 No weekly limits"})]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("button",{onClick:r,disabled:a,className:"btn btn-primary flex-1",children:"Subscribe for $1/month"}),(0,h.jsx)("button",{onClick:()=>i("/about"),className:"btn btn-secondary",children:"Learn More"})]})]})})},N=e=>{var s,t,r,a,n,i,d,x,m;let{userData:y,currentUser:b}=e;return(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-2",children:"Privacy"}),(0,h.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:"Control what your besties can see on your profile"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["Show Stats to Besties",(0,h.jsx)(u.A,{message:"Control whether your besties can see your check-in stats and safety record on your profile. This includes streaks, badges, and check-in history."})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:!1!==(null===y||void 0===y||null===(s=y.privacySettings)||void 0===s?void 0:s.showStatsToBesties)?"Besties can see your stats":"Stats are private"})]}),(0,h.jsx)("button",{onClick:async()=>{try{var e;const s=!(!1!==(null===y||void 0===y||null===(e=y.privacySettings)||void 0===e?void 0:e.showStatsToBesties));await(0,o.mZ)((0,o.H9)(l.db,"users",b.uid),{"privacySettings.showStatsToBesties":s}),c.Ay.success(s?"Stats now visible to besties":"Stats are now private")}catch(s){console.error("Error updating privacy:",s),c.Ay.error("Failed to update privacy setting")}},className:"w-12 h-6 rounded-full transition-colors ".concat(!1!==(null===y||void 0===y||null===(t=y.privacySettings)||void 0===t?void 0:t.showStatsToBesties)?"bg-primary":"bg-gray-300 dark:bg-gray-600"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(!1!==(null===y||void 0===y||null===(r=y.privacySettings)||void 0===r?void 0:r.showStatsToBesties)?"translate-x-6":"translate-x-1")})})]}),(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary mb-2 flex items-center",children:["Check-in Visibility",(0,h.jsx)(u.A,{message:"Choose who can see your check-ins in their activity feed. This helps you control your privacy while still letting your closest besties know you're safe."})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary mb-3",children:"Control who can see your check-ins (last 7 days)"})]}),(0,h.jsxs)("div",{className:"space-y-2",children:[(0,h.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",style:{borderColor:"all_besties"===((null===y||void 0===y||null===(a=y.privacySettings)||void 0===a?void 0:a.checkInVisibility)||"all_besties")?"#FF6B9D":"#e5e7eb"},children:[(0,h.jsx)("input",{type:"radio",name:"checkInVisibility",value:"all_besties",checked:"all_besties"===((null===y||void 0===y||null===(n=y.privacySettings)||void 0===n?void 0:n.checkInVisibility)||"all_besties"),onChange:async e=>{try{await(0,o.mZ)((0,o.H9)(l.db,"users",b.uid),{"privacySettings.checkInVisibility":"all_besties"}),c.Ay.success("All besties can now see your check-ins")}catch(s){console.error("Error updating privacy:",s),c.Ay.error("Failed to update privacy setting")}},className:"mt-1"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"All Besties"}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:"All your besties can see your check-ins."})]})]}),(0,h.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",style:{borderColor:"circle"===((null===y||void 0===y||null===(i=y.privacySettings)||void 0===i?void 0:i.checkInVisibility)||"all_besties")?"#FF6B9D":"#e5e7eb"},children:[(0,h.jsx)("input",{type:"radio",name:"checkInVisibility",value:"circle",checked:"circle"===((null===y||void 0===y||null===(d=y.privacySettings)||void 0===d?void 0:d.checkInVisibility)||"all_besties"),onChange:async e=>{try{await(0,o.mZ)((0,o.H9)(l.db,"users",b.uid),{"privacySettings.checkInVisibility":"circle"}),c.Ay.success("Only circle besties can see your check-ins")}catch(s){console.error("Error updating privacy:",s),c.Ay.error("Failed to update privacy setting")}},className:"mt-1"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"Bestie Circle Only"}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:"Only your top 5 circle besties can see your check-ins."})]})]}),(0,h.jsxs)("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",style:{borderColor:"alerts_only"===((null===y||void 0===y||null===(x=y.privacySettings)||void 0===x?void 0:x.checkInVisibility)||"all_besties")?"#FF6B9D":"#e5e7eb"},children:[(0,h.jsx)("input",{type:"radio",name:"checkInVisibility",value:"alerts_only",checked:"alerts_only"===((null===y||void 0===y||null===(m=y.privacySettings)||void 0===m?void 0:m.checkInVisibility)||"all_besties"),onChange:async e=>{try{await(0,o.mZ)((0,o.H9)(l.db,"users",b.uid),{"privacySettings.checkInVisibility":"alerts_only"}),c.Ay.success("Check-ins only visible when alerts trigger")}catch(s){console.error("Error updating privacy:",s),c.Ay.error("Failed to update privacy setting")}},className:"mt-1"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"Alerts Only (Most Private)"}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:"Check-ins are hidden until an alert goes off."})]})]})]})]})]})]})},k=e=>{var s,t,r,a,n,i,l,o;let{userData:c,showPasscodeInfo:d,setShowPasscodeInfo:x,setPasscodeType:m,setShowPasscodeModal:y,handleRemovePasscode:b,loading:g}=e;return(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary",children:"Security Passcodes"}),(0,h.jsx)("button",{onClick:()=>x(!d),className:"text-primary text-sm font-semibold hover:underline",children:d?"Hide Info":"Learn More"})]}),(0,h.jsx)("p",{className:"text-sm text-text-secondary mb-4",children:"Protect your check-ins with passcodes"}),d&&(0,h.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-4",children:[(0,h.jsx)("h3",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"How Passcodes Work:"}),(0,h.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-2 list-disc ml-4",children:[(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{children:"Safety Passcode:"})," Required to end check-ins or cancel SOS alerts. This ensures only you can mark yourself safe."]}),(0,h.jsxs)("li",{children:[(0,h.jsx)("strong",{children:"Duress Code:"})," A special code that ",(0,h.jsx)("em",{children:"appears"})," to cancel the alert, but secretly triggers an emergency alert to all besties in your circle. Use this if you're in danger and being forced to cancel."]}),(0,h.jsx)("li",{children:"Both codes must be different and at least 4 digits."}),(0,h.jsx)("li",{children:"Your codes are encrypted and stored securely."})]})]}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"border-2 border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["\ud83d\udd12 Safety",(0,h.jsx)("br",{}),"Passcode",(0,h.jsx)(u.A,{message:"Required to cancel check-ins or SOS alerts. This ensures only you can mark yourself safe, protecting you from coercion."})]}),(null===c||void 0===c||null===(s=c.security)||void 0===s?void 0:s.safetyPasscode)&&(0,h.jsx)("div",{className:"text-green-600 text-xl",children:"\u2713"})]}),null!==c&&void 0!==c&&null!==(t=c.security)&&void 0!==t&&t.safetyPasscode?(0,h.jsx)("button",{onClick:()=>{m("safety"),y(!0)},className:"text-primary text-sm font-semibold hover:underline",children:"Edit"}):(0,h.jsx)("button",{onClick:()=>{m("safety"),y(!0)},className:"btn btn-primary btn-sm px-6",children:"Set"})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:null!==c&&void 0!==c&&null!==(r=c.security)&&void 0!==r&&r.safetyPasscode?"Passcode is set":"Not set"}),(null===c||void 0===c||null===(a=c.security)||void 0===a?void 0:a.safetyPasscode)&&(0,h.jsx)("button",{onClick:()=>b("safety"),disabled:g,className:"text-red-600 text-sm font-semibold hover:underline mt-2",children:"Remove Passcode"})]}),(0,h.jsxs)("div",{className:"border-2 border-red-200 dark:border-red-600 rounded-lg p-4 bg-red-50/50 dark:bg-red-900/10",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["\ud83d\udea8 Duress",(0,h.jsx)("br",{}),"Code",(0,h.jsx)(u.A,{message:"A special code that appears to cancel alerts but secretly sends an emergency signal to all besties. Use if you're in danger and being forced to cancel."})]}),(null===c||void 0===c||null===(n=c.security)||void 0===n?void 0:n.duressCode)&&(0,h.jsx)("div",{className:"text-green-600 text-xl",children:"\u2713"})]}),null!==c&&void 0!==c&&null!==(i=c.security)&&void 0!==i&&i.duressCode?(0,h.jsx)("button",{onClick:()=>{m("duress"),y(!0)},className:"text-primary text-sm font-semibold hover:underline",children:"Edit"}):(0,h.jsx)("button",{onClick:()=>{m("duress"),y(!0)},className:"btn btn-primary btn-sm px-6",children:"Set"})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:null!==c&&void 0!==c&&null!==(l=c.security)&&void 0!==l&&l.duressCode?"Duress code is set":"Not set"}),(null===c||void 0===c||null===(o=c.security)||void 0===o?void 0:o.duressCode)&&(0,h.jsx)("button",{onClick:()=>b("duress"),disabled:g,className:"text-red-600 text-sm font-semibold hover:underline mt-2",children:"Remove Code"})]})]})]})},w=e=>{var s,t,r;let{isDark:a,toggleDarkMode:n,toggleHoldData:i,userData:l,navigate:o}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Preferences"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["Dark Mode",(0,h.jsx)(u.A,{message:"Toggle between light and dark color themes. Dark mode is easier on your eyes at night and can save battery on OLED screens."})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:a?"Dark mode enabled":"Light mode enabled"})]}),(0,h.jsx)("button",{onClick:n,className:"w-12 h-6 rounded-full transition-colors ".concat(a?"bg-primary":"bg-gray-300 dark:bg-gray-600"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(a?"translate-x-6":"translate-x-1")})})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"font-semibold text-text-primary flex items-center",children:["Data Retention",(0,h.jsx)(u.A,{message:"Choose whether to keep your check-in history indefinitely or auto-delete after 7 days. We keep running totals (like badge progress) but delete actual location/check-in data for privacy."})]}),(0,h.jsx)("div",{className:"text-sm text-text-secondary",children:null!==l&&void 0!==l&&null!==(s=l.settings)&&void 0!==s&&s.holdData?"Keeping all check-in history":"Auto-delete after 7 days (default)"}),(0,h.jsx)("button",{onClick:()=>o("/data-policy"),className:"text-xs text-primary hover:underline mt-1",children:"Learn how we handle your data \u2192"})]}),(0,h.jsx)("button",{onClick:i,className:"w-12 h-6 rounded-full transition-colors ".concat(null!==l&&void 0!==l&&null!==(t=l.settings)&&void 0!==t&&t.holdData?"bg-primary":"bg-gray-300 dark:bg-gray-600"),children:(0,h.jsx)("div",{className:"w-5 h-5 bg-white dark:bg-gray-300 rounded-full transition-transform ".concat(null!==l&&void 0!==l&&null!==(r=l.settings)&&void 0!==r&&r.holdData?"translate-x-6":"translate-x-1")})})]})]})]}),(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Quick Access"}),(0,h.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,h.jsx)("button",{onClick:()=>o("/history"),className:"btn btn-secondary text-left px-4 py-3",children:(0,h.jsx)("div",{className:"text-sm",children:"\ud83d\udcca History"})}),(0,h.jsx)("button",{onClick:()=>o("/export-data"),className:"btn btn-secondary text-left px-4 py-3",children:(0,h.jsx)("div",{className:"text-sm",children:"\ud83d\udce5 Export Data"})}),(null===l||void 0===l?void 0:l.isAdmin)&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{onClick:()=>o("/dev-analytics"),className:"btn btn-secondary text-left px-4 py-3",children:(0,h.jsx)("div",{className:"text-sm",children:"\ud83d\udcc8 Analytics"})}),(0,h.jsx)("button",{onClick:()=>o("/monitoring"),className:"btn bg-gradient-primary text-white text-left px-4 py-3",children:(0,h.jsx)("div",{className:"text-sm",children:"\ud83d\udd0d Monitoring"})})]})]})]})]})},S=e=>{let{navigate:s}=e;return(0,h.jsxs)("div",{className:"card p-6 mb-6",children:[(0,h.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Legal & Privacy"}),(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("span",{className:"text-2xl",children:"\ud83d\udd12"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"Privacy Policy"}),(0,h.jsx)("div",{className:"text-xs text-text-secondary",children:"How we protect your data"})]})]}),(0,h.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"\u2192"})]}),(0,h.jsxs)("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("span",{className:"text-2xl",children:"\ud83d\udcdc"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"Terms of Service"}),(0,h.jsx)("div",{className:"text-xs text-text-secondary",children:"Terms and conditions"})]})]}),(0,h.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"\u2192"})]}),(0,h.jsxs)("a",{href:"/about",className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("span",{className:"text-2xl",children:"\ud83d\udc95"}),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{className:"font-semibold text-text-primary",children:"About Besties"}),(0,h.jsx)("div",{className:"text-xs text-text-secondary",children:"Our story and mission"})]})]}),(0,h.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"\u2192"})]})]})]})};var C=t(2184);const A=()=>{var e,s,m;const{currentUser:u,userData:b}=(0,n.As)(),{isDark:g,toggle:p}=(0,i.D)(),A=(0,a.Zp)(),[M,P]=(0,r.useState)(!1),[D,T]=(0,r.useState)(!1),[I,F]=(0,r.useState)(!0),[L,E]=(0,r.useState)(!1),[B,_]=(0,r.useState)(0),[U,H]=(0,r.useState)(!1),[W,R]=(0,r.useState)(!1),[O,V]=(0,r.useState)(null),[z,Z]=(0,r.useState)(""),[Y,$]=(0,r.useState)(""),[q,G]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=x.A.isSupported();F(e),e&&T((null===b||void 0===b?void 0:b.notificationsEnabled)||!1)},[b]),(0,r.useEffect)(()=>{const e=window.location.hash.slice(1);e&&setTimeout(()=>{const s=document.getElementById(e);s&&(s.scrollIntoView({behavior:"smooth",block:"start"}),s.style.transition="background-color 0.3s",s.style.backgroundColor="rgba(168, 85, 247, 0.1)",setTimeout(()=>{s.style.backgroundColor=""},2e3),u&&"notifications"===e?(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{"profileCompletion.reviewedNotifications":!0}).catch(e=>console.error("Error updating profile completion:",e)):u&&"privacy"===e?(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{"profileCompletion.reviewedPrivacy":!0}).catch(e=>console.error("Error updating profile completion:",e)):u&&"security"===e&&(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{"profileCompletion.reviewedPasscode":!0}).catch(e=>console.error("Error updating profile completion:",e)))},100)},[u]),(0,r.useEffect)(()=>{(async()=>{if(u)try{const e=await(0,o.x7)((0,o.H9)(l.db,"users",u.uid));if(e.exists()){const s=e.data();_(s.smsWeeklyCount||0)}}catch(e){console.error("Error loading SMS count:",e)}})()},[u]);const Q=async e=>{if(u){P(!0);try{const s="safety"===e?"safetyPasscode":"duressCode";await(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{["security.".concat(s)]:null}),c.Ay.success("".concat("safety"===e?"Safety passcode":"Duress code"," removed"))}catch(s){console.error("Error removing passcode:",s),c.Ay.error("Failed to remove passcode")}finally{P(!1)}}};return(0,h.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,h.jsxs)("div",{className:"max-w-4xl mx-auto p-4 pb-24 md:pb-6",children:[(0,h.jsxs)("div",{className:"mb-6",children:[(0,h.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"Settings"}),(0,h.jsx)("p",{className:"text-text-secondary",children:"Manage your account and preferences"})]}),(0,h.jsx)("div",{id:"notifications",children:(0,h.jsx)(y,{userData:b,currentUserId:u.uid,toggleNotification:async e=>{if(u){if("sms"===e){var s;const e=(null===b||void 0===b||null===(s=b.notificationPreferences)||void 0===s?void 0:s.sms)||!1;if(!e&&(null===b||void 0===b||!b.hasSeenSMSPopup))return void E(!0);if(!e&&B>=5)return void c.Ay.error("You've reached the weekly limit of 5 SMS alerts. Limit resets every Monday.",{duration:6e3})}try{var r;const s=!(null!==b&&void 0!==b&&null!==(r=b.notificationPreferences)&&void 0!==r&&r[e]);if("whatsapp"===e&&s)return void c.Ay.error("WhatsApp integration coming soon! \ud83d\ude80",{duration:4e3});if("facebook"===e&&s)return void c.Ay.error("Facebook integration coming soon! \ud83d\ude80",{duration:4e3});await(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{["notificationPreferences.".concat(e)]:s});const{logAnalyticsEvent:a}=t(3984);a("notification_setting_changed",{notification_type:e,enabled:s}),c.Ay.success("".concat(e," notifications ").concat(s?"enabled":"disabled"))}catch(a){console.error("Error updating notification:",a),c.Ay.error("Failed to update notification setting")}}},togglePushNotifications:async()=>{if(I){P(!0);try{if(D){await x.A.disableNotifications()&&T(!1)}else{await x.A.enableNotifications()&&T(!0)}}catch(e){console.error("Push notification error:",e),c.Ay.error("Failed to update push notifications")}finally{P(!1)}}else c.Ay.error("Push notifications are not supported in your browser")},pushNotificationsSupported:I,pushNotificationsEnabled:D,loading:M,smsWeeklyCount:B,onOpenTestModal:()=>H(!0)})}),C.Gv.messengerAlerts&&(0,h.jsx)("div",{id:"messenger",children:(0,h.jsx)(v,{userId:null===u||void 0===u?void 0:u.uid})}),(0,h.jsx)(j,{userData:b,handleSMSSubscription:async()=>{P(!0);try{const e=await d.Ay.createCheckoutSession({amount:1,type:"subscription"});e.data&&e.data.url?window.location.href=e.data.url:c.Ay.error("Failed to start subscription")}catch(e){console.error("Subscription error:",e),c.Ay.error("Failed to start subscription")}finally{P(!1)}},loading:M,setLoading:P,navigate:A}),(0,h.jsx)("div",{id:"privacy",children:(0,h.jsx)(N,{userData:b,currentUser:u})}),(0,h.jsx)("div",{id:"security",children:(0,h.jsx)(k,{userData:b,showPasscodeInfo:q,setShowPasscodeInfo:G,setPasscodeType:V,setShowPasscodeModal:R,handleRemovePasscode:Q,loading:M})}),(0,h.jsx)(w,{isDark:g,toggleDarkMode:p,toggleHoldData:async()=>{if(u)try{var e;const s=!(null!==b&&void 0!==b&&null!==(e=b.settings)&&void 0!==e&&e.holdData);await(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{"settings.holdData":s});const{logAnalyticsEvent:r}=t(3984);r("data_retention_changed",{hold_data:s}),c.Ay.success(s?"Data will be kept indefinitely":"Data will be deleted after 24h")}catch(s){console.error("Error updating data retention:",s),c.Ay.error("Failed to update setting")}},userData:b,navigate:A}),(null===b||void 0===b||null===(e=b.donationStats)||void 0===e?void 0:e.isActive)&&(0,h.jsxs)("div",{className:"card p-6 mb-6 bg-gradient-primary text-white",children:[(0,h.jsx)("h2",{className:"text-xl font-display mb-2",children:"Thank You! \ud83d\udc9c"}),(0,h.jsx)("p",{className:"mb-2",children:"You're helping keep Besties free"}),(0,h.jsxs)("div",{className:"text-2xl font-display",children:["$",b.donationStats.monthlyAmount,"/month"]}),(0,h.jsxs)("div",{className:"text-sm mt-2 opacity-80",children:["Total donated: $",b.donationStats.totalDonated]})]}),(0,h.jsx)(S,{navigate:A}),(0,h.jsx)("div",{className:"card p-6 mb-6",children:(0,h.jsx)("button",{onClick:async()=>{(await l.authService.signOut()).success?(c.Ay.success("Signed out successfully"),A("/login")):c.Ay.error("Sign out failed")},className:"w-full btn bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-3 text-base font-medium transition-colors",children:"Log Out"})})]}),W&&(0,h.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,h.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"safety"===O?"\ud83d\udd12 Set Safety Passcode":"\u26a0\ufe0f Set Duress Code"}),(0,h.jsx)("p",{className:"text-text-secondary mb-4",children:"safety"===O?"This passcode will be required to end check-ins and cancel alerts.":"This code appears to cancel alerts but secretly triggers an emergency alert to your besties."}),"duress"===O&&(0,h.jsx)("div",{className:"bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700 rounded-lg p-3 mb-4",children:(0,h.jsxs)("p",{className:"text-sm text-orange-800 dark:text-orange-300",children:["\u26a0\ufe0f ",(0,h.jsx)("strong",{children:"Warning:"})," Use your duress code only in genuine emergencies when you're being forced to cancel an alert under duress."]})}),(0,h.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"safety"===O?"Passcode":"Duress Code"}),(0,h.jsx)("input",{type:"password",inputMode:"numeric",pattern:"[0-9]*",value:z,onChange:e=>Z(e.target.value.replace(/\D/g,"")),className:"w-full px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none text-center text-2xl tracking-widest bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"\u2022\u2022\u2022\u2022",maxLength:6,autoFocus:!0}),(0,h.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"At least 4 digits"})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:["Confirm ","safety"===O?"Passcode":"Code"]}),(0,h.jsx)("input",{type:"password",inputMode:"numeric",pattern:"[0-9]*",value:Y,onChange:e=>$(e.target.value.replace(/\D/g,"")),className:"w-full px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none text-center text-2xl tracking-widest bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"\u2022\u2022\u2022\u2022",maxLength:6})]})]}),(0,h.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("button",{onClick:()=>{R(!1),Z(""),$(""),V(null)},className:"flex-1 btn btn-secondary",disabled:M,children:"Cancel"}),(0,h.jsx)("button",{onClick:async()=>{if(z)if(z.length<4)c.Ay.error("Passcode must be at least 4 digits");else if(z===Y){var e;if("duress"===O){if(z===(null===b||void 0===b||null===(e=b.security)||void 0===e?void 0:e.safetyPasscode))return void c.Ay.error("Duress code must be different from safety passcode")}else if("safety"===O){var s;if(z===(null===b||void 0===b||null===(s=b.security)||void 0===s?void 0:s.duressCode))return void c.Ay.error("Safety passcode must be different from duress code")}P(!0);try{const e="safety"===O?"safetyPasscode":"duressCode";await(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{["security.".concat(e)]:z}),c.Ay.success("".concat("safety"===O?"Safety passcode":"Duress code"," updated!")),R(!1),Z(""),$(""),V(null)}catch(t){console.error("Error saving passcode:",t),c.Ay.error("Failed to save passcode")}finally{P(!1)}}else c.Ay.error("Passcodes do not match");else c.Ay.error("Please enter a passcode")},disabled:M||!z||!Y,className:"flex-1 btn ".concat("duress"===O?"bg-orange-600 hover:bg-orange-700":"btn-primary"," text-white"),children:M?"Saving...":"Save"})]}),"safety"===O&&null!==b&&void 0!==b&&null!==(s=b.security)&&void 0!==s&&s.safetyPasscode||"duress"===O&&null!==b&&void 0!==b&&null!==(m=b.security)&&void 0!==m&&m.duressCode?(0,h.jsxs)("button",{onClick:()=>{Q(O),R(!1),Z(""),$(""),V(null)},disabled:M,className:"w-full btn bg-red-500 text-white hover:bg-red-600 text-sm",children:["Remove ","safety"===O?"Safety Passcode":"Duress Code"]}):null]})]})}),L&&(0,h.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,h.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:[(0,h.jsxs)("div",{className:"text-center mb-4",children:[(0,h.jsx)("div",{className:"text-5xl mb-3",children:"\ud83d\udcf1"}),(0,h.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"About SMS Alerts"})]}),(0,h.jsxs)("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300 mb-6",children:[(0,h.jsx)("p",{className:"font-semibold text-primary",children:"SMS alerts are currently FREE during beta testing!"}),(0,h.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg",children:[(0,h.jsx)("p",{className:"font-semibold mb-1",children:"Free Tier Limits:"}),(0,h.jsxs)("ul",{className:"list-disc ml-4 space-y-1",children:[(0,h.jsx)("li",{children:"Up to 5 SMS alerts per week"}),(0,h.jsx)("li",{children:"Resets every Monday"}),(0,h.jsxs)("li",{children:["You've used ",B,"/5 this week"]})]})]}),(0,h.jsxs)("div",{className:"bg-orange-50 dark:bg-orange-900/30 p-3 rounded-lg",children:[(0,h.jsx)("p",{className:"font-semibold mb-1",children:"Important to Know:"}),(0,h.jsxs)("ul",{className:"list-disc ml-4 space-y-1",children:[(0,h.jsx)("li",{children:"SMS messages are expensive to send"}),(0,h.jsx)("li",{children:"Once WhatsApp and Facebook integrations launch, SMS will become a premium feature ($1/month for up to 20 alerts)"}),(0,h.jsx)("li",{children:"We recommend using email or WhatsApp for unlimited free alerts"})]})]}),(0,h.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 italic",children:"By enabling SMS, you understand these limitations and agree to use SMS responsibly."})]}),(0,h.jsxs)("div",{className:"flex gap-3",children:[(0,h.jsx)("button",{onClick:()=>E(!1),className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,h.jsx)("button",{onClick:async()=>{if(u)try{await(0,o.mZ)((0,o.H9)(l.db,"users",u.uid),{"notificationPreferences.sms":!0,hasSeenSMSPopup:!0}),E(!1),c.Ay.success("SMS notifications enabled!")}catch(e){console.error("Error enabling SMS:",e),c.Ay.error("Failed to enable SMS")}},className:"flex-1 btn btn-primary",children:"I Understand - Enable SMS"})]})]})}),(0,h.jsx)(f,{isOpen:U,onClose:()=>H(!1),userData:b,onSendTest:async e=>{P(!0);try{const s=await d.Ay.sendTestAlert(e);if(s.data&&s.data.success){const e=s.data.channels,t=[];e.email&&t.push("Email"),e.push&&t.push("Push"),e.sms&&t.push("SMS"),e.whatsapp&&t.push("WhatsApp"),e.telegram&&t.push("Telegram"),t.length>0?(c.Ay.success("\u2705 Test alerts sent successfully to: ".concat(t.join(", "),"!"),{duration:6e3}),H(!1)):c.Ay.error("No channels were tested. Make sure channels are enabled and configured.",{duration:5e3})}else c.Ay.error("Failed to send test alert")}catch(s){console.error("Test alert error:",s),c.Ay.error(s.message||"Failed to send test alert")}finally{P(!1)}},loading:M})]})}},5080:(e,s,t)=>{t.d(s,{d:()=>r});const r={pageUsername:"besties.safety",getLinkForUser:e=>"https://m.me/besties.safety?ref=".concat(e),contactExpiryHours:20,contactExpiryMs:72e6}}}]);
//# sourceMappingURL=745.5b340102.chunk.js.map