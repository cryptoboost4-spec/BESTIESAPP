"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[299],{2299:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var o=a(2555),n=a(5043),r=a(3216),s=a(4528),i=a(7400),l=a(5472),c=a(8147),d=a(2339);const m={core:!0,auth:!0,checkIns:!0,besties:!0,templates:!0,quickButtons:!0,celebrationMessages:!0,gpsLocation:!0,manualLocation:!0,extendButtons:!0,bestieCircle:!0,badges:!0,shareableCards:!0,mediaUpload:!0,photoCapture:!0,donations:!0,smsSubscription:!0,emergency:!1,reversePin:!1,liveTracking:!1,videoRecording:!1,facebookLogin:!1,phoneAuth:!1},u=e=>!0===m[e];var p=a(1182),g=a(7688),h=a(7766),b=a(579);const x=()=>{const e=["Wrapping you in safety... Your besties will watch over you \ud83d\udc96","Building your protection... We've got your back, always \u2728","Setting up your safety circle... You're never alone with us \ud83c\udf38","Preparing your safety net... Because you deserve to feel secure \ud83d\udc95"],[t]=(0,n.useState)(()=>e[Math.floor(Math.random()*e.length)]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 via-purple-50 to-indigo-50 dark:from-purple-900/30 dark:via-pink-900/30 dark:to-indigo-900/30 flex items-center justify-center p-4 relative overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(20)].map((e,t)=>(0,b.jsx)("div",{className:"absolute animate-float-elegant",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),animationDelay:"".concat(4*Math.random(),"s"),animationDuration:"".concat(6+4*Math.random(),"s"),opacity:.3+.3*Math.random()},children:(0,b.jsx)("span",{className:"text-2xl",children:["\u2728","\ud83d\udc8e","\ud83c\udf38","\ud83e\udd8b","\ud83d\udcab","\ud83c\udf3a","\ud83c\udff5\ufe0f","\ud83c\udf80"][Math.floor(8*Math.random())]})},t))}),(0,b.jsx)("div",{className:"w-full max-w-lg text-center relative z-10",children:(0,b.jsxs)("div",{className:"relative bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl rounded-[2rem] p-10 shadow-[0_20px_60px_rgba(0,0,0,0.1)] border border-white/50 dark:border-gray-600/50",children:[(0,b.jsx)("h2",{className:"font-display text-3xl text-gradient mb-4",children:"Creating your check-in!"}),(0,b.jsx)("p",{className:"text-xl text-text-secondary font-semibold mb-8 animate-fade-in",children:t}),(0,b.jsx)("div",{className:"flex justify-center gap-2 mb-8",children:[0,1,2].map(e=>(0,b.jsx)("div",{className:"w-4 h-4 bg-gradient-primary rounded-full animate-bounce",style:{animationDelay:"".concat(.15*e,"s")}},e))}),(0,b.jsx)("div",{className:"flex justify-center items-center gap-2 mb-8",children:[0,1,2,3,4].map(e=>(0,b.jsx)("div",{className:"w-2 h-2 bg-gradient-to-r from-pink-400 to-purple-400 rounded-full animate-wave",style:{animationDelay:"".concat(.15*e,"s"),animationDuration:"1.5s"}},e))}),(0,b.jsxs)("div",{className:"relative w-full h-2 bg-gradient-to-r from-pink-100 via-purple-100 to-fuchsia-100 dark:from-pink-900/50 dark:via-purple-900/50 dark:to-fuchsia-900/50 rounded-full overflow-hidden shadow-inner",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-pink-400 via-purple-400 via-fuchsia-400 to-pink-400 animate-silk-shimmer bg-[length:300%_100%] opacity-80"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-white/30 dark:bg-white/10 animate-silk-shine"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-400 mt-6 italic",children:"Taking care of you, always \ud83d\udc95"})]})})]}),(0,b.jsx)("style",{children:"\n        @keyframes float-elegant {\n          0%, 100% {\n            transform: translateY(0px) translateX(0px) rotate(0deg);\n            opacity: 0.3;\n          }\n          50% {\n            transform: translateY(-30px) translateX(10px) rotate(5deg);\n            opacity: 0.6;\n          }\n        }\n        @keyframes pulse-slow {\n          0%, 100% { transform: scale(1); opacity: 0.4; }\n          50% { transform: scale(1.2); opacity: 0.2; }\n        }\n        @keyframes pulse-gentle {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(1.05); }\n        }\n        @keyframes wave {\n          0%, 100% { transform: translateY(0); }\n          50% { transform: translateY(-8px); }\n        }\n        @keyframes silk-shimmer {\n          0% { background-position: 0% center; }\n          100% { background-position: 300% center; }\n        }\n        @keyframes silk-shine {\n          0% { transform: translateX(-100%) skewX(-15deg); opacity: 0; }\n          50% { opacity: 0.5; }\n          100% { transform: translateX(200%) skewX(-15deg); opacity: 0; }\n        }\n        @keyframes draw-check {\n          0% { stroke-dasharray: 0, 100; }\n          100% { stroke-dasharray: 100, 0; }\n        }\n        .animate-float-elegant {\n          animation: float-elegant 8s ease-in-out infinite;\n        }\n        .animate-pulse-slow {\n          animation: pulse-slow 3s ease-in-out infinite;\n        }\n        .animate-pulse-gentle {\n          animation: pulse-gentle 2s ease-in-out infinite;\n        }\n        .animate-wave {\n          animation: wave 1.5s ease-in-out infinite;\n        }\n        .animate-silk-shimmer {\n          animation: silk-shimmer 3s linear infinite;\n        }\n        .animate-silk-shine {\n          animation: silk-shine 3s ease-in-out infinite;\n        }\n        .animate-draw-check {\n          animation: draw-check 2s ease-in-out infinite;\n          stroke-dasharray: 100;\n        }\n      "})]})},y=()=>{const{currentUser:e,userData:t,loading:a}=(0,s.As)(),m=(0,r.Zp)(),y=(0,r.zy)(),[f,w]=(0,n.useState)(""),[v,k]=(0,n.useState)(30),[j,N]=(0,n.useState)([]),[A,C]=(0,n.useState)(""),[S,M]=(0,n.useState)(""),[P,_]=(0,n.useState)(""),[E,I]=(0,n.useState)([]),[L,D]=(0,n.useState)([]),[F,T]=(0,n.useState)([]),[U,z]=(0,n.useState)(!1),[B,R]=(0,n.useState)(!1),[q,G]=(0,n.useState)(!1),{executeOptimistic:O}=(0,g.Ay)(),[W,H]=(0,n.useState)(null),[K,Y]=(0,n.useState)(!1),[V,X]=(0,n.useState)(!0),[J,Z]=(0,n.useState)(null),[Q,$]=(0,n.useState)(!1),[ee,te]=(0,n.useState)(!1),[ae,oe]=(0,n.useState)(!1),[ne,re]=(0,n.useState)(!1),[se,ie]=(0,n.useState)(!1),le={lat:37.7749,lng:-122.4194},ce=(0,n.useRef)(null),de=(0,n.useRef)(null),me=(0,n.useRef)(null),ue=(0,n.useRef)(null),pe=(0,n.useRef)(null);(0,n.useEffect)(()=>{a||t&&!1===t.onboardingCompleted&&m("/onboarding")},[t,a,m]),(0,n.useEffect)(()=>{var e,t,a;if(p.A.trackFunnelStep("checkin","view_create_page"),null!==(e=y.state)&&void 0!==e&&e.quickMinutes&&(p.A.trackFunnelStep("checkin","use_quick_button",{minutes:y.state.quickMinutes}),k(y.state.quickMinutes)),null!==(t=y.state)&&void 0!==t&&t.quickType){const{quickType:e,duration:t,rego:a,meetingWith:o,skipLocation:n}=y.state;p.A.trackFunnelStep("checkin","use_quick_".concat(e),{duration:t}),t&&k(t),n&&(w("No location set"),oe(!0)),"rideshare"===e&&a&&C("\ud83d\ude97 Rideshare - Vehicle: ".concat(a)),"quickmeet"===e&&o&&M(o),"walking"===e&&C("\ud83d\udeb6\u200d\u2640\ufe0f Walking alone")}if(null!==(a=y.state)&&void 0!==a&&a.template){p.A.trackFunnelStep("checkin","use_template");const e=y.state.template;w(e.location||""),k(e.duration||30),N(e.bestieIds||[]),C(e.notes||"")}},[y.state]),(0,n.useEffect)(()=>{if(!e||a)return;console.group("\ud83d\udd0d Setting up Bestie Circle Listener");const t=(0,l.H9)(i.db,"users",e.uid),n=(0,l.aQ)(t,async t=>{try{var a;if(!t.exists())return console.error("\u274c User document does not exist"),console.groupEnd(),void T([]);const n=t.data().featuredCircle||[];if(0===n.length)return console.warn("\u26a0\ufe0f featuredCircle is empty - no besties to load"),void T([]);const[r,s]=await Promise.all([(0,l.GG)((0,l.P)((0,l.rJ)(i.db,"besties"),(0,l._M)("requesterId","==",e.uid),(0,l._M)("status","==","accepted"))),(0,l.GG)((0,l.P)((0,l.rJ)(i.db,"besties"),(0,l._M)("recipientId","==",e.uid),(0,l._M)("status","==","accepted")))]),c=[];r.forEach(e=>{const t=e.data();c.push({id:t.recipientId,name:t.recipientName||"Bestie",phone:t.recipientPhone,email:t.recipientEmail})}),s.forEach(e=>{const t=e.data();c.push({id:t.requesterId,name:t.requesterName||"Bestie",phone:t.requesterPhone,email:t.requesterEmail})});const m=c.filter(e=>n.includes(e.id)),u=await Promise.all(m.map(async e=>{try{const a=await(0,l.x7)((0,l.H9)(i.db,"users",e.id));if(a.exists()){var t;const n=a.data();return(0,o.A)((0,o.A)({},e),{},{name:n.displayName||e.name||e.email||"Bestie",photoURL:n.photoURL||null,email:n.email||e.email,phone:n.phoneNumber||e.phone,smsEnabled:(null===(t=n.notificationPreferences)||void 0===t?void 0:t.sms)||!1,requestAttention:n.requestAttention||null})}return e}catch(a){return console.error("Error fetching user data for ".concat(e.id,":"),a),e}}));if(T(u),(null===(a=y.state)||void 0===a||!a.template)&&u.length>0){const e=u.filter(e=>e.phone&&e.smsEnabled);N(e.map(e=>e.id));const t=u.filter(e=>!e.phone||!e.smsEnabled);if(t.length>0){console.warn("\u26a0\ufe0f Some circle besties missing phone/SMS:",t);const e=t.filter(e=>!e.phone).length,a=t.filter(e=>e.phone&&!e.smsEnabled).length;let o="";o=e>0&&a>0?"".concat(e," bestie(s) need to add their phone number and ").concat(a," need to enable SMS alerts"):e>0?"".concat(e," bestie(s) need to add their phone number"):"".concat(a," bestie(s) need to enable SMS alerts in Settings"),(0,d.Ay)(o,{icon:"\u2139\ufe0f",duration:5e3})}}}catch(n){console.error("Error loading besties:",n),d.Ay.error("Failed to load besties")}},e=>{console.error("Error in featuredCircle listener:",e),d.Ay.error("Failed to load besties")});return console.groupEnd(),()=>{n()}},[e,a]),(0,n.useEffect)(()=>{if(ae&&j.length>0&&!U){console.log("Auto-submitting quick check-in with besties:",j);const e=document.querySelector("#create-checkin-submit-btn");e&&!e.disabled?(console.log("Clicking submit button"),e.click(),oe(!1)):console.warn("Submit button not ready:",{submitBtn:e,disabled:null===e||void 0===e?void 0:e.disabled})}},[ae,j,U]),(0,n.useEffect)(()=>{const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GOOGLE_MAPS_API_KEY;if(!e)return console.warn("Google Maps API key not configured"),void d.Ay.error("Address autocomplete is not available. Please type your location manually.",{duration:5e3,id:"maps-api-missing"});const t=()=>!!(window.google&&window.google.maps&&window.google.maps.places)&&(G(!0),!0);if(t())return;if(document.querySelector('script[src*="maps.googleapis.com"]')){let e=0;const a=100,o=setInterval(()=>{e++,t()?clearInterval(o):e>=a&&(clearInterval(o),console.error("Google Maps API loading timeout"),d.Ay.error("Map is taking too long to load. Please refresh the page.",{duration:5e3,id:"maps-timeout"}))},100);return()=>clearInterval(o)}const a=document.createElement("script");a.src="https://maps.googleapis.com/maps/api/js?key=".concat(e,"&libraries=places&loading=async"),a.async=!0,a.defer=!0;const o=setTimeout(()=>{t()||(console.error("Google Maps API script load timeout"),d.Ay.error("Map failed to load. Please check your internet connection and refresh.",{duration:5e3,id:"maps-load-timeout"}))},15e3);return a.onload=()=>{clearTimeout(o);const e=setInterval(()=>{t()&&clearInterval(e)},100);setTimeout(()=>{t()&&console.log("Google Maps API loaded successfully")},500)},a.onerror=e=>{clearTimeout(o),console.error("Failed to load Google Maps API:",e),d.Ay.error("Failed to load address autocomplete. Please refresh the page.",{duration:5e3,id:"maps-error"})},document.head.appendChild(a),()=>clearTimeout(o)},[]),(0,n.useEffect)(()=>{if(q&&ue.current&&!K){if(!window.google||!window.google.maps||!window.google.maps.Map){console.warn("Google Maps API not fully ready yet, retrying...");const e=setTimeout(()=>{G(!1),setTimeout(()=>G(!0),100)},500);return()=>clearTimeout(e)}try{console.log("Initializing Google Map..."),pe.current=new window.google.maps.Map(ue.current,{center:le,zoom:12,disableDefaultUI:!0,zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,draggable:!1,gestureHandling:"none"}),pe.current.addListener("dblclick",e=>{if(V)X(!1),pe.current.setOptions({draggable:!0,gestureHandling:"greedy"}),d.Ay.success("\ud83d\uddfa\ufe0f Map unlocked! Drag to explore",{duration:2e3});else{const e=pe.current.getCenter(),t={lat:e.lat(),lng:e.lng()};H(t);(new window.google.maps.Geocoder).geocode({location:t},(e,a)=>{if("OK"===a&&e[0]){const t=e[0].formatted_address;w(t),console.log("Pin placed, location updated to:",t)}else{const e="".concat(t.lat.toFixed(6),", ").concat(t.lng.toFixed(6));w(e),console.log("Pin placed, using coordinates:",e)}}),d.Ay.success("\ud83d\udccd Pin location saved!",{duration:1500})}}),pe.current.addListener("dragend",()=>{if(!V){const e=pe.current.getCenter(),t={lat:e.lat(),lng:e.lng()};H(t);(new window.google.maps.Geocoder).geocode({location:t},(e,a)=>{if("OK"===a&&e[0]){const t=e[0].formatted_address;w(t),console.log("Map dragged, location updated to:",t)}else{const e="".concat(t.lat.toFixed(6),", ").concat(t.lng.toFixed(6));w(e),console.log("Map dragged, using coordinates:",e)}})}}),pe.current.addListener("click",()=>{V&&(0,d.Ay)("\ud83d\udca1 Double-tap to unlock map!",{duration:2e3,icon:"\ud83d\udd12",style:{background:"#fef3c7",color:"#92400e",fontWeight:600}})}),Y(!0),console.log("Google Map initialized successfully")}catch(e){console.error("Error initializing map:",e),d.Ay.error("Failed to initialize map. Please refresh the page.",{duration:4e3,id:"map-init-error"})}}},[q,K,V]),(0,n.useEffect)(()=>{if(q&&ce.current){if(!window.google||!window.google.maps||!window.google.maps.places||!window.google.maps.places.Autocomplete){console.warn("Google Places API not fully ready yet, retrying...");const e=setTimeout(()=>{G(!1),setTimeout(()=>G(!0),100)},500);return()=>clearTimeout(e)}try{console.log("Initializing Google Places Autocomplete..."),de.current=new window.google.maps.places.Autocomplete(ce.current,{types:["establishment","geocode"],fields:["formatted_address","name","geometry"]}),de.current.addListener("place_changed",()=>{try{const e=de.current.getPlace();if(e.formatted_address){const t=e.name&&e.name!==e.formatted_address?"".concat(e.name,", ").concat(e.formatted_address):e.formatted_address;if(w(t),e.geometry&&e.geometry.location&&pe.current){const t=e.geometry.location,a={lat:t.lat(),lng:t.lng()};pe.current.setCenter(a),pe.current.setZoom(15),H(a)}}}catch(e){console.error("Error handling place selection:",e),d.Ay.error("Error selecting location. Please try again.",{duration:3e3})}}),console.log("Autocomplete initialized successfully")}catch(e){console.error("Error initializing autocomplete:",e),d.Ay.error("Could not initialize address search. Please type your location manually.",{duration:4e3,id:"autocomplete-init-error"})}return()=>{de.current&&window.google.maps.event.clearInstanceListeners(de.current)}}},[q]),(0,n.useEffect)(()=>{if(W&&pe.current)try{pe.current.setCenter(W),pe.current.setZoom(16)}catch(e){console.error("Error updating map with GPS:",e)}},[W]);const ge=()=>{u("gpsLocation")?navigator.geolocation?(z(!0),d.Ay.loading("Getting your location...",{id:"gps-loading"}),navigator.geolocation.getCurrentPosition(e=>{const t=e.coords.latitude,a=e.coords.longitude,o={lat:t,lng:a};(new window.google.maps.Geocoder).geocode({location:o},(e,n)=>{d.Ay.dismiss("gps-loading"),z(!1),"OK"===n&&e[0]?(w(e[0].formatted_address),d.Ay.success("Location captured!",{duration:2e3})):(w("GPS: ".concat(t.toFixed(4),", ").concat(a.toFixed(4))),d.Ay.success("Location captured (coordinates only)",{duration:2e3})),H(o)})},e=>{d.Ay.dismiss("gps-loading"),z(!1),console.error("Geolocation error:",e),1===e.code?d.Ay.error("Location permission denied. Please enable location access in your browser settings.",{duration:6e3}):2===e.code?d.Ay.error("Location unavailable. Make sure location services are enabled on your device.",{duration:5e3}):3===e.code?d.Ay.error("Location request timed out. Please try again or search for your location.",{duration:5e3}):d.Ay.error("Could not get location. Please search manually.",{duration:4e3})},{timeout:3e4,enableHighAccuracy:!0,maximumAge:0})):d.Ay.error("Geolocation not supported by your browser. Please search for your location manually."):d.Ay.error("GPS location is not enabled")},he=(e,t)=>{const a="Hey! You haven't added your phone number on Besties yet. I can't use you as my emergency contact until you do. Can you add it please? \u2764\ufe0f\n\nDownload Besties: ".concat(window.location.origin),o=encodeURIComponent(a),n=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);switch(e){case"whatsapp":n?window.location.href="whatsapp://send?text=".concat(o):window.open("https://wa.me/?text=".concat(o),"_blank");break;case"messenger":n?(window.location.href="fb-messenger://share?link=".concat(encodeURIComponent(window.location.origin)),setTimeout(()=>{window.open("https://www.facebook.com/dialog/send?link=".concat(encodeURIComponent(window.location.origin),"&app_id=&redirect_uri=").concat(encodeURIComponent(window.location.origin)),"_blank")},1500)):window.open("https://www.facebook.com/dialog/send?link=".concat(encodeURIComponent(window.location.origin),"&app_id=&redirect_uri=").concat(encodeURIComponent(window.location.origin)),"_blank","width=600,height=400");break;case"instagram":navigator.clipboard.writeText(a).then(()=>{d.Ay.success("Message copied! Opening Instagram DMs..."),n?(window.location.href="instagram://direct/inbox",setTimeout(()=>{window.open("https://www.instagram.com/direct/inbox/","_blank")},1500)):window.open("https://www.instagram.com/direct/inbox/","_blank")}).catch(()=>{d.Ay.error("Failed to copy message")});break;case"sms":window.location.href="sms:?body=".concat(o);break;case"facebook":const e=encodeURIComponent("Hey! Please add your phone number on Besties \u2764\ufe0f"),t=encodeURIComponent(window.location.origin);n?(window.location.href="fb://profile",setTimeout(()=>{window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(t,"&quote=").concat(e),"_blank")},1500)):window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(t,"&quote=").concat(e),"_blank","width=600,height=400")}d.Ay.success("Opening ".concat(e,"...")),Z(null)};return B?(0,b.jsx)(x,{}):(0,b.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,b.jsx)("div",{className:"max-w-2xl mx-auto p-4 pb-20 ".concat(ae?"opacity-0 pointer-events-none":""),children:(0,b.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),0===j.length)return p.A.trackFunnelStep("checkin","error_no_besties"),void d.Ay.error("Please select at least one bestie from your circle to notify",{duration:4e3});const o=j.filter(e=>{const t=F.find(t=>t.id===e);return!(null!==t&&void 0!==t&&t.phone)}).map(e=>{const t=F.find(t=>t.id===e);return(null===t||void 0===t?void 0:t.name)||"Unknown"});if(!(o.length>0))return f.trim()?void(v<10||v>180?d.Ay.error("Duration must be between 10 and 180 minutes"):(p.A.trackFunnelStep("checkin","submit_checkin",{besties:j.length,duration:v,hasNotes:!!A}),R(!0),await O({optimisticUpdate:()=>{},serverUpdate:async()=>{z(!0);try{var a;const n=new Date,r=new Date(n.getTime()+60*v*1e3),s=[];if(E.length>0)for(let t=0;t<E.length;t++){const a=E[t];try{const o=(0,c.KR)(i.IG,"checkin-photos/".concat(e.uid,"/").concat(Date.now(),"_").concat(t,"_").concat(a.name));await(0,c.D)(o,a);const n=await(0,c.qk)(o);n?s.push(n):console.warn("Failed to get download URL for photo ".concat(t))}catch(o){console.error("Error uploading photo ".concat(t,":"),o)}}const d=s.filter(e=>e&&""!==e.trim()),u=(null===t||void 0===t||null===(a=t.privacySettings)||void 0===a?void 0:a.checkInVisibility)||"all_besties",g=(null===t||void 0===t?void 0:t.featuredCircle)||[],h={userId:e.uid,location:f,gpsCoords:W||null,duration:v,alertTime:l.Dc.fromDate(r),bestieIds:j,notes:A||null,meetingWith:S||null,socialMediaLinks:P||null,status:"active",privacyLevel:u,circleSnapshot:g,createdAt:l.Dc.now(),lastUpdate:l.Dc.now()};d.length>0&&(h.photoURLs=d);const b=await(0,l.gS)((0,l.rJ)(i.db,"checkins"),h),x=await(0,l.x7)((0,l.H9)(i.db,"checkins",b.id));if(!x.exists())throw new Error("Check-in was not saved properly. Please try again.");const y=x.data();if(y.userId!==e.uid||"active"!==y.status)throw new Error("Check-in data verification failed. Please try again.");if(!y.bestieIds||y.bestieIds.length!==j.length)throw new Error("Bestie list was not saved correctly. Please try again.");if(!j.every(e=>y.bestieIds.includes(e)))throw new Error("Bestie list verification failed. Please try again.");return p.A.trackFunnelStep("checkin","complete_checkin"),setTimeout(()=>{m("/")},1e3),b}finally{z(!1)}},rollback:()=>{R(!1)},onError:e=>{console.error("Error creating check-in:",e),p.A.logCustomError("Failed to create check-in",{error:e.message}),R(!1)},successMessage:"Check-in created! Stay safe! \ud83d\udc9c",errorMessage:"Failed to create check-in. Please try creating it again.",showLoadingToast:!1,loadingMessage:"Creating your check-in..."}))):(p.A.trackFunnelStep("checkin","error_no_location"),void d.Ay.error("Please enter a location"));d.Ay.error("These besties need to add their phone number: ".concat(o.join(", ")),{duration:6e3})},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"card p-0 overflow-hidden",children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary p-6 pb-3 text-center",children:"Create Check-In"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{ref:ue,className:"w-full h-80",style:{minHeight:"320px"}}),(0,b.jsxs)("div",{className:"absolute top-3 left-3 right-3 z-10",children:[(0,b.jsx)("input",{ref:ce,type:"text",value:f,onChange:e=>w(e.target.value),onFocus:()=>re(!0),onBlur:()=>setTimeout(()=>re(!1),200),className:"input w-full shadow-lg",placeholder:"Search for a place...",required:!0,autoComplete:"off"}),ne&&u("gpsLocation")&&(0,b.jsx)("div",{className:"mt-2 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-600 overflow-hidden",children:(0,b.jsxs)("button",{type:"button",onClick:()=>{ge(),re(!1)},className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left",children:[(0,b.jsxs)("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4M2 12h4m12 0h4"})]}),(0,b.jsx)("span",{className:"font-semibold text-text-primary",children:"Your Location"})]})})]}),(0,b.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-full z-10 pointer-events-none",children:(0,b.jsx)("svg",{className:"w-12 h-12 text-primary drop-shadow-lg",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})}),u("gpsLocation")&&(0,b.jsx)("button",{type:"button",onClick:ge,className:"absolute right-3 top-20 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 p-3 rounded-lg shadow-lg border border-gray-300 dark:border-gray-600 transition-all z-10",disabled:U,title:"Use my current location",children:U?(0,b.jsx)("div",{className:"w-5 h-5 spinner-small"}):(0,b.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2v4m0 12v4M2 12h4m12 0h4"})]})})]}),(0,b.jsxs)("p",{className:"text-xs text-text-secondary p-3 px-6",children:["\ud83d\udca1 ",(0,b.jsx)("strong",{className:"text-primary",children:"Double-tap to unlock the map,"})," then drag to move it and double-tap again to save"]})]}),(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary mb-3",children:"Who are you meeting? \ud83d\udc65 (Optional)"}),(0,b.jsx)("input",{type:"text",value:S,onChange:e=>M(e.target.value),className:"input mb-3",placeholder:"e.g., Alex, Sarah, John..."}),se?(0,b.jsxs)("div",{className:"animate-fade-in",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-secondary mb-2",children:"Their Social Media"}),(0,b.jsx)("input",{type:"text",value:P,onChange:e=>_(e.target.value),className:"input mb-2",placeholder:"e.g., @username on Instagram, facebook.com/profile...",autoFocus:!0}),(0,b.jsx)("button",{type:"button",onClick:()=>ie(!1),className:"w-full btn btn-secondary text-sm py-2",children:"Done"})]}):(0,b.jsx)("button",{type:"button",onClick:()=>ie(!0),className:"w-full border-2 ".concat(P?"border-primary bg-primary/10 text-primary":"border-dashed border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:border-primary hover:bg-primary/5"," rounded-xl p-3 text-sm font-semibold transition-all"),children:P?"\u2713 Social Media Added":"\ud83d\udcf1 Add Their Social Media"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary mb-3",children:"How long? \u23f0"}),(0,b.jsx)("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[15,30,60,120].map(e=>(0,b.jsx)("button",{type:"button",onClick:()=>k(e),className:"py-3 rounded-xl font-semibold transition-all ".concat(v===e?"bg-gradient-primary text-white shadow-lg":"bg-gray-100 dark:bg-gray-700 text-text-primary hover:bg-gray-200 dark:hover:bg-gray-600"),children:e<60?"".concat(e,"m"):"".concat(e/60,"h")},e))}),(0,b.jsx)("input",{type:"range",min:"15",max:"180",step:"15",value:v,onChange:e=>k(parseInt(e.target.value)),className:"w-full"}),(0,b.jsxs)("div",{className:"text-center mt-3",children:[(0,b.jsxs)("div",{className:"text-sm text-text-secondary",children:[v," minutes"]}),(0,b.jsxs)("div",{className:"text-sm font-semibold text-primary mt-1",children:["Alert at: ",new Date(Date.now()+60*v*1e3).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]})]})]}),(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary mb-3",children:"Who should we alert? \ud83d\udc9c"}),0===F.length?(0,b.jsxs)("div",{className:"text-center py-8 bg-orange-50 dark:bg-orange-900/30 border-2 border-orange-200 dark:border-orange-800 rounded-xl",children:[(0,b.jsx)("p",{className:"font-semibold text-text-primary mb-2",children:"\u26a0\ufe0f No besties in your circle"}),(0,b.jsx)("p",{className:"text-text-secondary text-sm mb-4",children:"Add besties to your bestie circle on the home page to create check-ins"}),(0,b.jsx)("button",{type:"button",onClick:()=>m("/"),className:"btn btn-primary",children:"Go to Home Page"})]}):(0,b.jsx)("div",{className:"space-y-2",children:F.map(e=>{const t=j.indexOf(e.id),a=-1!==t,o=a?t+1:null,n=J===e.id;return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsx)("button",{type:"button",onClick:()=>e.phone&&e.smsEnabled&&(e=>{if(j.includes(e))N(j.filter(t=>t!==e));else{if(j.length>=5)return void d.Ay.error("Maximum 5 besties per check-in");N([...j,e])}})(e.id),disabled:!e.phone||!e.smsEnabled,className:"w-full p-4 rounded-xl border-2 transition-all text-left ".concat(e.phone&&e.smsEnabled?a?"border-primary bg-primary/5":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500":"border-orange-300 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/30 opacity-60"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)(h.A,{photoURL:e.photoURL,name:e.name||e.email||"Unknown",requestAttention:e.requestAttention,size:"md",showBubble:!0}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-semibold text-text-primary",children:e.name||e.email||"Unknown"}),(0,b.jsx)("div",{className:"text-sm text-text-secondary",children:e.phone?e.smsEnabled?e.email||e.phone:"\u26a0\ufe0f SMS alerts not enabled":"\u26a0\ufe0f No phone number"})]})]}),e.phone?a&&(0,b.jsxs)("div",{className:"bg-primary text-white px-3 py-1 rounded-full text-sm font-bold",children:[o,"/5"]}):(0,b.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),Z(n?null:e.id)},className:"btn btn-sm btn-primary",children:"Ask to Add"})]})}),!e.phone&&n&&(0,b.jsxs)("div",{className:"mt-2 p-4 bg-purple-50 dark:bg-purple-900/30 border-2 border-purple-200 dark:border-purple-800 rounded-xl",children:[(0,b.jsxs)("p",{className:"text-sm font-semibold text-purple-900 dark:text-purple-200 mb-3",children:["\ud83d\udcf1 Ask ",e.name," to add their phone number"]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>he("whatsapp",e.name),className:"flex flex-col items-center gap-1 p-3 rounded-lg bg-[#25D366] hover:bg-[#20BA5A] text-white transition-colors",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})}),(0,b.jsx)("span",{className:"text-xs",children:"WhatsApp"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>he("messenger",e.name),className:"flex flex-col items-center gap-1 p-3 rounded-lg bg-[#0084FF] hover:bg-[#0073E6] text-white transition-colors",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 0C5.373 0 0 4.975 0 11.111c0 3.497 1.745 6.616 4.472 8.652V24l4.086-2.242c1.09.301 2.246.464 3.442.464 6.627 0 12-4.974 12-11.111C24 4.975 18.627 0 12 0zm1.191 14.963l-3.055-3.26-5.963 3.26L10.732 8l3.131 3.259L19.752 8l-6.561 6.963z"})}),(0,b.jsx)("span",{className:"text-xs",children:"Messenger"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>he("instagram",e.name),className:"flex flex-col items-center gap-1 p-3 rounded-lg bg-gradient-to-r from-[#833AB4] via-[#FD1D1D] to-[#F77737] hover:opacity-90 text-white transition-opacity",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})}),(0,b.jsx)("span",{className:"text-xs",children:"Instagram"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>he("sms",e.name),className:"flex flex-col items-center gap-1 p-3 rounded-lg bg-success hover:bg-green-600 text-white transition-colors",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),(0,b.jsx)("span",{className:"text-xs",children:"SMS"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>he("facebook",e.name),className:"flex flex-col items-center gap-1 p-3 rounded-lg bg-[#1877F2] hover:bg-[#166FE5] text-white transition-colors",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(0,b.jsx)("span",{className:"text-xs",children:"Facebook"})]})]})]})]},e.id)})}),(0,b.jsxs)("div",{className:"mt-3 text-sm text-primary font-semibold",children:["Selected: ",j.length,"/5"]})]}),(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary mb-3",children:"Notes & Photos (Optional)"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>{$(!Q),Q||te(!1)},className:"py-4 px-4 rounded-xl font-semibold transition-all border-2 ".concat(Q?"bg-gradient-primary text-white border-primary shadow-lg scale-105":A?"bg-primary/10 border-primary text-primary":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-text-primary hover:border-primary hover:bg-primary/5"),children:[(0,b.jsx)("div",{className:"text-2xl mb-1",children:"\ud83d\udcdd"}),(0,b.jsx)("div",{className:"text-sm",children:"Add Notes"}),A&&!Q&&(0,b.jsx)("div",{className:"text-xs mt-1 opacity-75",children:"\u2713 Added"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>{te(!ee),ee||$(!1)},className:"py-4 px-4 rounded-xl font-semibold transition-all border-2 ".concat(ee?"bg-gradient-primary text-white border-primary shadow-lg scale-105":E.length>0?"bg-primary/10 border-primary text-primary":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-text-primary hover:border-primary hover:bg-primary/5"),children:[(0,b.jsx)("div",{className:"text-2xl mb-1",children:"\ud83d\udcf7"}),(0,b.jsx)("div",{className:"text-sm",children:"Add Photos"}),E.length>0&&!ee&&(0,b.jsxs)("div",{className:"text-xs mt-1 opacity-75",children:["\u2713 ",E.length,"/5"]})]})]}),Q&&(0,b.jsxs)("div",{className:"mb-4 animate-fade-in",children:[(0,b.jsx)("textarea",{value:A,onChange:e=>C(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$(!1),e.target.blur())},className:"input min-h-[120px] resize-none",placeholder:"Any additional info for your besties...",autoFocus:!0}),(0,b.jsx)("button",{type:"button",onClick:()=>$(!1),className:"mt-2 w-full btn btn-secondary text-sm py-2",children:"Done"})]}),ee&&(0,b.jsxs)("div",{className:"animate-fade-in",children:[(0,b.jsxs)("div",{className:"text-sm font-semibold text-text-primary mb-2",children:["Add Photos (",E.length,"/5)"]}),L.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-3",children:L.map((e,t)=>(0,b.jsxs)("div",{className:"relative aspect-square",children:[(0,b.jsx)("img",{src:e,alt:"Preview ".concat(t+1),className:"w-full h-full rounded-xl object-cover"}),(0,b.jsx)("button",{type:"button",onClick:()=>(e=>{I(E.filter((t,a)=>a!==e)),D(L.filter((t,a)=>a!==e))})(t),className:"absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-full text-sm font-bold hover:bg-red-600 flex items-center justify-center",children:"\u2715"})]},t))}),E.length<5&&(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("input",{ref:me,type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=Array.from(e.target.files);if(0===t.length)return;if(E.length+t.length>5)return void d.Ay.error("You can only upload up to 5 photos per check-in");for(const o of t){if(o.size>5242880)return void d.Ay.error("".concat(o.name," is too large. Photos must be less than 5MB"));if(!o.type.startsWith("image/"))return void d.Ay.error("".concat(o.name," is not an image file"))}I([...E,...t]);const a=t.map(e=>URL.createObjectURL(e));D([...L,...a]),me.current&&(me.current.value="")},className:"hidden",id:"photo-input"}),(0,b.jsxs)("label",{htmlFor:"photo-input",className:"block w-full p-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-colors",children:[(0,b.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcf7"}),(0,b.jsx)("div",{className:"text-sm text-text-secondary",children:"Click to add photos (up to 5, max 5MB each)"})]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>te(!1),className:"w-full btn btn-secondary text-sm py-2",children:"Done"})]})]}),(0,b.jsx)("button",{type:"submit",id:"create-checkin-submit-btn",disabled:U||0===j.length,className:"w-full btn btn-primary text-lg py-4",children:U?"Creating...":"\ud83d\udee1\ufe0f Start Check-In"})]})})})}}}]);
//# sourceMappingURL=299.55e8b3b6.chunk.js.map