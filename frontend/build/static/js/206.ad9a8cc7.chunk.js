"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[206],{3319:(e,t,i)=>{i.d(t,{A:()=>n});var a=i(2555),r=i(5043),s=i(8838);const n=e=>{let{trigger:t=!1,type:i="default"}=e;return(0,r.useEffect)(()=>{if(!t)return;(()=>{if("badge"===i){const e=200,t={origin:{y:.7},shapes:["circle","square"],colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]};function r(i,r){(0,s.A)((0,a.A)((0,a.A)((0,a.A)({},t),r),{},{particleCount:Math.floor(e*i)}))}r(.25,{spread:26,startVelocity:55}),r(.2,{spread:60}),r(.35,{spread:100,decay:.91,scalar:.8}),r(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),r(.1,{spread:120,startVelocity:45})}else"milestone"===i?((0,s.A)({particleCount:150,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#87CEEB","#98FB98"]}),setTimeout(()=>{(0,s.A)({particleCount:100,angle:60,spread:55,origin:{x:0},colors:["#FF69B4","#DDA0DD","#FFB6C1"]})},200),setTimeout(()=>{(0,s.A)({particleCount:100,angle:120,spread:55,origin:{x:1},colors:["#87CEEB","#98FB98","#FFB6C1"]})},400)):(0,s.A)({particleCount:100,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]})})()},[t,i]),null}},6823:(e,t,i)=>{i.d(t,{l:()=>n});var a=i(2555),r=i(7400),s=i(5472);const n=new class{async createNotification(e,t,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{await(0,s.gS)((0,s.rJ)(r.db,"notifications"),(0,a.A)({userId:e,type:t,title:i,message:n,read:!1,createdAt:(0,s.O5)()},o))}catch(l){throw console.error("Error creating notification:",l),l}}async notifyBestieRequest(e,t){return this.createNotification(e,"bestie_request","New Bestie Request","".concat(t," wants to be your bestie!"),{requesterName:t})}async notifyCheckInAlert(e,t,i){return this.createNotification(e,"check_in_alert","Check-in Alert","".concat(t," hasn't checked in yet. They might need help."),{bestieName:t,checkInId:i})}async notifyMissedCheckIn(e,t){return this.createNotification(e,"missed_check_in","Missed Check-in","You missed your check-in. Your besties were notified.",{checkInId:t})}async notifyRequestAttention(e,t,i){return this.createNotification(e,"request_attention","Someone Needs You","".concat(t," is requesting your attention"),{bestieName:t,bestieId:i})}async notifyBadgeEarned(e,t,i){return this.createNotification(e,"badge_earned","New Badge Unlocked!",'You earned the "'.concat(t,'" badge! ').concat(i),{badgeName:t,badgeDescription:i})}async notifySystem(e,t,i){return this.createNotification(e,"system",t,i)}async notifyWelcome(e,t){return this.createNotification(e,"system","Welcome to Besties, ".concat(t,"!"),"Start by adding your first bestie and creating a check-in. We've got your back!")}async notifyBestieAccepted(e,t){return this.createNotification(e,"bestie_request","Bestie Request Accepted!","".concat(t," accepted your bestie request. Stay safe together!"),{bestieName:t})}async notifyCheckInComplete(e,t){return this.createNotification(e,"check_in_alert","Check-in Complete",'Great job! You completed "'.concat(t,'" safely.'),{checkInName:t})}}},8206:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var a=i(2555),r=i(5043),s=i(3216),n=i(4528),o=i(7400),l=i(5472),c=i(8147),d=i(2339);const u=e=>{if(!e)return!1;return/^\+[1-9]\d{1,14}$/.test(e)};var m=i(6823);const x=(e,t,i)=>{var a;const r=!(null===t||void 0===t||!t.email),s=!(null===e||void 0===e||!e.phoneNumber),n=!(null===e||void 0===e||!e.photoURL),o=!(null===e||void 0===e||null===(a=e.profile)||void 0===a||!a.bio);return r&&s&&n&&o&&i>=5},p=async e=>{try{const t="profile_perfectionist",i=await(0,l.x7)((0,l.H9)(o.db,"badges",e));if(i.exists()){const a=i.data().badges||[];if(a.some(e=>e.id===t))return!1;await(0,l.mZ)((0,l.H9)(o.db,"badges",e),{badges:(0,l.hq)({id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"})})}else await(0,l.BN)((0,l.H9)(o.db,"badges",e),{badges:[{id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"}]});return await m.l.notifyBadgeEarned(e,"Profile Perfectionist","You completed your entire profile! You're all set to stay safe with your besties."),!0}catch(t){return console.error("Error awarding profile completion badge:",t),!1}},h=async(e,t,i,a)=>{if(x(t,i,a)){return await p(e)}return!1};var f=i(3319),b=i(579);const y=e=>{let{isOpen:t,onClose:i}=e;const[a,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(t){s(!0);const e=setTimeout(()=>{s(!1)},5e3);return()=>clearTimeout(e)}},[t]),t?(0,b.jsxs)(b.Fragment,{children:[a&&(0,b.jsx)(f.A,{}),(0,b.jsx)("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",children:(0,b.jsxs)("div",{className:"card max-w-lg w-full p-8 animate-scale-up relative overflow-hidden bg-white dark:bg-gray-800",children:[(0,b.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,b.jsx)("div",{className:"absolute top-6 left-6 text-3xl animate-float opacity-60",children:"\u2b50"}),(0,b.jsx)("div",{className:"absolute top-10 right-8 text-2xl animate-float delay-1s opacity-50",children:"\ud83d\udcab"}),(0,b.jsx)("div",{className:"absolute bottom-10 left-10 text-2xl animate-float delay-2s opacity-60",children:"\u2728"}),(0,b.jsx)("div",{className:"absolute bottom-6 right-6 text-3xl animate-float delay-3s opacity-50",children:"\ud83c\udf89"})]}),(0,b.jsxs)("div",{className:"relative z-10 text-center",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-yellow-200 to-yellow-400 rounded-full mb-6 shadow-2xl animate-bounce-slow",children:(0,b.jsx)("span",{className:"text-5xl",children:"\u2b50"})}),(0,b.jsx)("h2",{className:"text-4xl font-display bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Congratulations!"}),(0,b.jsx)("h3",{className:"text-2xl font-display text-text-primary dark:text-white mb-4",children:"Profile Perfectionist Unlocked!"}),(0,b.jsx)("p",{className:"text-lg text-text-secondary dark:text-gray-300 mb-6 max-w-md mx-auto",children:"You've completed your entire profile! Your besties can now see all your info, and you're all set to stay safe together."}),(0,b.jsxs)("div",{className:"inline-block bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30 rounded-2xl p-6 mb-6 border-2 border-pink-200 dark:border-pink-700 shadow-xl",children:[(0,b.jsx)("div",{className:"text-5xl mb-2",children:"\u2b50"}),(0,b.jsx)("div",{className:"text-xl font-display text-text-primary dark:text-white mb-1",children:"Profile Perfectionist"}),(0,b.jsx)("div",{className:"text-sm text-text-secondary dark:text-gray-300",children:"Completed your full profile"})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-r from-pink-100 to-purple-100 dark:from-pink-900/40 dark:to-purple-900/40 rounded-xl p-4 mb-6 border border-pink-200 dark:border-pink-800",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-text-primary dark:text-white mb-2",children:"\ud83c\udfaf Profile Complete! Here's what you unlocked:"}),(0,b.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary dark:text-gray-300",children:[(0,b.jsx)("div",{children:"\u2705 Full profile visibility to your besties"}),(0,b.jsx)("div",{children:"\u2705 Profile Perfectionist badge"}),(0,b.jsx)("div",{children:"\u2705 Priority support access"}),(0,b.jsx)("div",{children:"\u2705 Shareable profile cards"})]})]}),(0,b.jsx)("button",{onClick:i,className:"btn btn-primary w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transition-all",children:"Awesome! Let's Go! \ud83c\udf89"}),(0,b.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400 mt-4",children:"Check your Notifications to see your new badge"})]})]})})]}):null},v=()=>{var e,t,i,m;const{currentUser:x,userData:p}=(0,n.As)(),f=(0,s.Zp)(),[v,g]=(0,r.useState)((null===p||void 0===p?void 0:p.displayName)||""),[N,j]=(0,r.useState)((null===p||void 0===p||null===(e=p.profile)||void 0===e?void 0:e.bio)||""),[k,w]=(0,r.useState)((null===p||void 0===p||null===(t=p.profile)||void 0===t?void 0:t.birthdate)||""),[C,A]=(0,r.useState)((null===p||void 0===p?void 0:p.phoneNumber)||""),[P,F]=(0,r.useState)(null),[S,B]=(0,r.useState)((null===p||void 0===p?void 0:p.photoURL)||null),[D,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=window.location.hash.slice(1);e&&setTimeout(()=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.transition="background-color 0.3s",t.style.backgroundColor="rgba(168, 85, 247, 0.1)",setTimeout(()=>{t.style.backgroundColor=""},2e3))},100)},[]);const[R,_]=(0,r.useState)(!1),[E,q]=(0,r.useState)(""),[T,U]=(0,r.useState)(null),[L,M]=(0,r.useState)(""),[V,G]=(0,r.useState)(!1),Y=async()=>{if(!C||C===(null===p||void 0===p?void 0:p.phoneNumber))return void d.Ay.error("Please enter a new phone number");const e=C.trim();if(!e)return void d.Ay.error("Please enter a phone number");if(!/^[0-9+\s\-()]+$/.test(e))return void d.Ay.error("Phone number can only contain digits, +, spaces, hyphens, and parentheses");let t=e.replace(/[\s\-()]/g,"");if(t.startsWith("+")||(t=t.startsWith("0")?"+61"+t.slice(1):"+"+t),!u(t))return void d.Ay.error("Invalid phone number format. Please enter a valid international number (e.g., +61412345678 or 0412345678)",{duration:5e3});const i=t.slice(1);if(i.length<8)return void d.Ay.error("Phone number is too short. Please enter a complete phone number");if(i.length>15)return void d.Ay.error("Phone number is too long. Please check and try again");I(!0);const a=o.y1.setupRecaptcha("phone-recaptcha-container");if(!a.success)return d.Ay.error("Failed to set up verification. Please refresh the page."),void I(!1);const r=await o.y1.sendPhoneVerification(t,a.verifier);I(!1),r.success?(U(r.confirmationResult),M(t),_(!0),d.Ay.success("Verification code sent to your phone!")):d.Ay.error(r.error||"Failed to send verification code")},z=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=(null===p||void 0===p?void 0:p.photoURL)||null;if(P){const e=await(async()=>{if(!P)return(null===p||void 0===p?void 0:p.photoURL)||null;try{const e=(0,c.KR)(o.IG,"profile-pictures/".concat(x.uid,"/").concat(Date.now(),"_").concat(P.name));return await(0,c.D)(e,P),await(0,c.qk)(e)}catch(e){return console.error("Error uploading profile picture:",e),d.Ay.error("Failed to upload profile picture"),(null===p||void 0===p?void 0:p.photoURL)||null}})();e&&(t=e)}await(0,l.mZ)((0,l.H9)(o.db,"users",x.uid),{displayName:v,phoneNumber:e||C,photoURL:t,"profile.bio":N,"profile.birthdate":k,updatedAt:new Date}),d.Ay.success("Profile updated successfully!");const i=(0,l.P)((0,l.rJ)(o.db,"besties"),(0,l._M)("requesterId","==",x.uid),(0,l._M)("status","==","accepted")),r=(0,l.P)((0,l.rJ)(o.db,"besties"),(0,l._M)("recipientId","==",x.uid),(0,l._M)("status","==","accepted")),[s,n]=await Promise.all([(0,l.GG)(i),(0,l.GG)(r)]),u=s.size+n.size,m=(0,a.A)((0,a.A)({},p),{},{displayName:v,phoneNumber:e||C,photoURL:t,profile:(0,a.A)((0,a.A)({},null===p||void 0===p?void 0:p.profile),{},{bio:N,birthdate:k})});await h(x.uid,m,x,u)?G(!0):setTimeout(()=>{f("/profile")},500)}catch(t){console.error("Error updating profile:",t),d.Ay.error(t.message||"Failed to update profile")}finally{I(!1)}};return(0,b.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,b.jsxs)("div",{className:"max-w-2xl mx-auto p-4 pb-32 md:pb-20",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"Edit Profile"}),(0,b.jsx)("p",{className:"text-text-secondary",children:"Update your personal information"})]}),(0,b.jsxs)("form",{onSubmit:async e=>{e.preventDefault();C&&C!==(null===p||void 0===p?void 0:p.phoneNumber)?Y():(I(!0),await z())},className:"space-y-6",children:[(0,b.jsxs)("div",{id:"profile-picture",className:"card p-6",children:[(0,b.jsx)("label",{className:"block text-lg font-display text-text-primary mb-4",children:"Profile Picture"}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsx)("div",{className:"w-24 h-24 bg-gradient-primary rounded-full flex items-center justify-center text-white text-3xl font-display overflow-hidden",children:S?(0,b.jsx)("img",{src:S,alt:"Profile",className:"w-full h-full object-cover"}):(null===v||void 0===v?void 0:v[0])||"U"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return void d.Ay.error("File size must be less than 5MB");F(t),B(URL.createObjectURL(t))}},className:"hidden",id:"profile-picture"}),(0,b.jsx)("label",{htmlFor:"profile-picture",className:"btn btn-secondary cursor-pointer inline-block",children:"Choose Photo"}),(0,b.jsx)("div",{className:"text-sm text-text-secondary mt-2",children:"JPG, PNG or GIF. Max size 5MB"})]})]})]}),(0,b.jsxs)("div",{id:"basic-info",className:"card p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Basic Information"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{id:"display-name",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Display Name"}),(0,b.jsx)("input",{type:"text",value:v,onChange:e=>g(e.target.value),className:"input",placeholder:"Your name",required:!0})]}),(0,b.jsxs)("div",{id:"bio",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Bio"}),(0,b.jsx)("textarea",{value:N,onChange:e=>j(e.target.value),className:"input min-h-[80px] resize-none",placeholder:"Tell people about yourself...",maxLength:150}),(0,b.jsxs)("div",{className:"text-xs text-text-secondary mt-1",children:[N.length,"/150 characters"]})]}),(0,b.jsxs)("div",{id:"birthday",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Birthday \ud83c\udf82"}),(0,b.jsx)("input",{type:"date",value:k,onChange:e=>w(e.target.value),className:"input",max:(new Date).toISOString().split("T")[0]}),(0,b.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"Your besties will be notified on your birthday! (Optional)"})]}),(0,b.jsxs)("div",{id:"phone",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Phone Number"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"tel",value:C,onChange:e=>A(e.target.value),className:"input flex-1",placeholder:"+61 400 000 000 or 0400 000 000"}),C!==(null===p||void 0===p?void 0:p.phoneNumber)&&C&&(0,b.jsx)("button",{type:"button",onClick:Y,disabled:D,className:"btn btn-primary whitespace-nowrap",children:D?"Sending...":"Verify Now"})]}),C!==(null===p||void 0===p?void 0:p.phoneNumber)&&C&&(0,b.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:'\u26a0\ufe0f Click "Verify Now" to verify this number via SMS'})]})]})]}),(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Account Info"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Email"}),(0,b.jsx)("div",{className:"font-semibold text-text-primary",children:null===x||void 0===x?void 0:x.email}),(0,b.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"To change your email, use Google authentication"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Member Since"}),(0,b.jsx)("div",{className:"font-semibold text-text-primary",children:(null===p||void 0===p||null===(i=p.stats)||void 0===i||null===(m=i.joinedAt)||void 0===m?void 0:m.toDate().toLocaleDateString())||"Recently"})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>f("/profile"),className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,b.jsxs)("button",{type:"submit",disabled:D,className:"flex-1 btn btn-primary flex items-center justify-center gap-2",children:[D&&(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),D?"Sending verification...":"Save Changes"]})]})]}),R&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"card dark:bg-gray-800 p-6 max-w-md w-full animate-scale-up",children:[(0,b.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"Verify Phone Number"}),(0,b.jsxs)("p",{className:"text-text-secondary mb-4",children:["We sent a 6-digit code to ",(0,b.jsx)("strong",{children:L})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Verification Code"}),(0,b.jsx)("input",{type:"text",value:E,onChange:e=>q(e.target.value),className:"input",placeholder:"123456",maxLength:6,autoFocus:!0})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:()=>{_(!1),q(""),U(null)},className:"flex-1 btn btn-secondary",disabled:D,children:"Cancel"}),(0,b.jsxs)("button",{onClick:async()=>{if(!E||!T)return void d.Ay.error("Please enter the verification code");I(!0);const e=await o.y1.verifyPhoneCode(T,E);if(e.success){d.Ay.success("Phone number verified!"),_(!1),A(L);try{await x.getIdToken(!0),await new Promise(e=>setTimeout(e,500))}catch(t){console.error("Token refresh error:",t)}z(L)}else I(!1),d.Ay.error(e.error||"Invalid verification code")},className:"flex-1 btn btn-primary flex items-center justify-center gap-2",disabled:D||6!==E.length,children:[D&&(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),D?"Verifying & Saving...":"Verify & Save"]})]}),(0,b.jsxs)("p",{className:"text-xs text-text-secondary mt-4 text-center",children:["Didn't receive the code?"," ",(0,b.jsx)("button",{onClick:Y,className:"text-primary underline",disabled:D,children:"Resend"})]})]})}),(0,b.jsx)("div",{id:"phone-recaptcha-container"}),(0,b.jsx)(y,{isOpen:V,onClose:()=>{G(!1),f("/profile")}})]})})}}}]);
//# sourceMappingURL=206.ad9a8cc7.chunk.js.map