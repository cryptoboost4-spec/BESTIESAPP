"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[206],{3319:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(2555),a=i(5043);const r=e=>{let{trigger:t=!1,type:r="default"}=e;return(0,a.useEffect)(()=>{if(!t)return;(async()=>{const e=(await i.e(838).then(i.bind(i,8838))).default;if("badge"===r){const t=200,a={origin:{y:.7},shapes:["circle","square"],colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]};function n(i,r){e((0,s.A)((0,s.A)((0,s.A)({},a),r),{},{particleCount:Math.floor(t*i)}))}n(.25,{spread:26,startVelocity:55}),n(.2,{spread:60}),n(.35,{spread:100,decay:.91,scalar:.8}),n(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),n(.1,{spread:120,startVelocity:45})}else"milestone"===r?(e({particleCount:150,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#87CEEB","#98FB98"]}),setTimeout(()=>{e({particleCount:100,angle:60,spread:55,origin:{x:0},colors:["#FF69B4","#DDA0DD","#FFB6C1"]})},200),setTimeout(()=>{e({particleCount:100,angle:120,spread:55,origin:{x:1},colors:["#87CEEB","#98FB98","#FFB6C1"]})},400)):e({particleCount:100,spread:70,origin:{y:.6},colors:["#FF69B4","#DDA0DD","#FFB6C1","#FFC0CB","#FF1493"]})})().catch(console.error)},[t,r]),null}},6823:(e,t,i)=>{i.d(t,{l:()=>n});var s=i(2555),a=i(3984),r=i(5472);const n=new class{async createNotification(e,t,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{await(0,r.gS)((0,r.rJ)(a.db,"notifications"),(0,s.A)({userId:e,type:t,title:i,message:n,read:!1,createdAt:(0,r.O5)()},o))}catch(l){throw console.error("Error creating notification:",l),l}}async notifyBestieRequest(e,t){return this.createNotification(e,"bestie_request","New Bestie Request","".concat(t," wants to be your bestie!"),{requesterName:t})}async notifyCheckInAlert(e,t,i){return this.createNotification(e,"check_in_alert","Check-in Alert","".concat(t," hasn't checked in yet. They might need help."),{bestieName:t,checkInId:i})}async notifyMissedCheckIn(e,t){return this.createNotification(e,"missed_check_in","Missed Check-in","You missed your check-in. Your besties were notified.",{checkInId:t})}async notifyRequestAttention(e,t,i){return this.createNotification(e,"request_attention","Someone Needs You","".concat(t," is requesting your attention"),{bestieName:t,bestieId:i})}async notifyBadgeEarned(e,t,i){return this.createNotification(e,"badge_earned","New Badge Unlocked!",'You earned the "'.concat(t,'" badge! ').concat(i),{badgeName:t,badgeDescription:i})}async notifySystem(e,t,i){return this.createNotification(e,"system",t,i)}async notifyWelcome(e,t){return this.createNotification(e,"system","Welcome to Besties, ".concat(t,"!"),"Start by adding your first bestie and creating a check-in. We've got your back!")}async notifyBestieAccepted(e,t){return this.createNotification(e,"bestie_request","Bestie Request Accepted!","".concat(t," accepted your bestie request. Stay safe together!"),{bestieName:t})}async notifyCheckInComplete(e,t){return this.createNotification(e,"check_in_alert","Check-in Complete",'Great job! You completed "'.concat(t,'" safely.'),{checkInName:t})}}},8206:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var s=i(2555),a=i(5043),r=i(3216),n=i(4528),o=i(3984),l=i(5472),c=i(8147),d=i(2339);const u=e=>{if(!e)return!1;return/^\+[1-9]\d{1,14}$/.test(e)};var m=i(6823);const x=(e,t,i)=>{var s;const a=!(null===t||void 0===t||!t.email),r=!(null===e||void 0===e||!e.phoneNumber),n=!(null===e||void 0===e||!e.photoURL),o=!(null===e||void 0===e||null===(s=e.profile)||void 0===s||!s.bio);return a&&r&&n&&o&&i>=5},h=async e=>{try{const t="profile_perfectionist",i=await(0,l.x7)((0,l.H9)(o.db,"badges",e));if(i.exists()){const s=i.data().badges||[];if(s.some(e=>e.id===t))return!1;await(0,l.mZ)((0,l.H9)(o.db,"badges",e),{badges:(0,l.hq)({id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"})})}else await(0,l.BN)((0,l.H9)(o.db,"badges",e),{badges:[{id:t,name:"Profile Perfectionist",description:"Completed your full profile - ready to connect!",icon:"\u2b50",earnedAt:new Date,category:"profile"}]});return await m.l.notifyBadgeEarned(e,"Profile Perfectionist","You completed your entire profile! You're all set to stay safe with your besties."),!0}catch(t){return console.error("Error awarding profile completion badge:",t),!1}},p=async(e,t,i,s)=>{if(x(t,i,s)){return await h(e)}return!1};var b=i(3319),f=i(579);const y=e=>{let{isOpen:t,onClose:i}=e;const[s,r]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(t){r(!0);const e=setTimeout(()=>{r(!1)},5e3);return()=>clearTimeout(e)}},[t]),t?(0,f.jsxs)(f.Fragment,{children:[s&&(0,f.jsx)(b.A,{}),(0,f.jsx)("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",children:(0,f.jsxs)("div",{className:"card max-w-lg w-full p-8 animate-scale-up relative overflow-hidden bg-white dark:bg-gray-800",children:[(0,f.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,f.jsx)("div",{className:"absolute top-6 left-6 text-3xl animate-float opacity-60",children:"\u2b50"}),(0,f.jsx)("div",{className:"absolute top-10 right-8 text-2xl animate-float delay-1s opacity-50",children:"\ud83d\udcab"}),(0,f.jsx)("div",{className:"absolute bottom-10 left-10 text-2xl animate-float delay-2s opacity-60",children:"\u2728"}),(0,f.jsx)("div",{className:"absolute bottom-6 right-6 text-3xl animate-float delay-3s opacity-50",children:"\ud83c\udf89"})]}),(0,f.jsxs)("div",{className:"relative z-10 text-center",children:[(0,f.jsx)("div",{className:"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-yellow-200 to-yellow-400 rounded-full mb-6 shadow-2xl animate-bounce-slow",children:(0,f.jsx)("span",{className:"text-5xl",children:"\u2b50"})}),(0,f.jsx)("h2",{className:"text-4xl font-display bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent mb-3",children:"Congratulations!"}),(0,f.jsx)("h3",{className:"text-2xl font-display text-text-primary dark:text-white mb-4",children:"Profile Perfectionist Unlocked!"}),(0,f.jsx)("p",{className:"text-lg text-text-secondary dark:text-gray-300 mb-6 max-w-md mx-auto",children:"You've completed your entire profile! Your besties can now see all your info, and you're all set to stay safe together."}),(0,f.jsxs)("div",{className:"inline-block bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30 rounded-2xl p-6 mb-6 border-2 border-pink-200 dark:border-pink-700 shadow-xl",children:[(0,f.jsx)("div",{className:"text-5xl mb-2",children:"\u2b50"}),(0,f.jsx)("div",{className:"text-xl font-display text-text-primary dark:text-white mb-1",children:"Profile Perfectionist"}),(0,f.jsx)("div",{className:"text-sm text-text-secondary dark:text-gray-300",children:"Completed your full profile"})]}),(0,f.jsxs)("div",{className:"bg-gradient-to-r from-pink-100 to-purple-100 dark:from-pink-900/40 dark:to-purple-900/40 rounded-xl p-4 mb-6 border border-pink-200 dark:border-pink-800",children:[(0,f.jsx)("div",{className:"text-sm font-semibold text-text-primary dark:text-white mb-2",children:"\ud83c\udfaf Profile Complete! Here's what you unlocked:"}),(0,f.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary dark:text-gray-300",children:[(0,f.jsx)("div",{children:"\u2705 Full profile visibility to your besties"}),(0,f.jsx)("div",{children:"\u2705 Profile Perfectionist badge"}),(0,f.jsx)("div",{children:"\u2705 Priority support access"}),(0,f.jsx)("div",{children:"\u2705 Shareable profile cards"})]})]}),(0,f.jsx)("button",{onClick:i,className:"btn btn-primary w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transition-all",children:"Awesome! Let's Go! \ud83c\udf89"}),(0,f.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400 mt-4",children:"Check your Notifications to see your new badge"})]})]})})]}):null},v=()=>{var e,t,m,x;const{currentUser:h,userData:b}=(0,n.As)(),v=(0,r.Zp)(),[g,N]=(0,a.useState)((null===b||void 0===b?void 0:b.displayName)||""),[j,k]=(0,a.useState)((null===b||void 0===b||null===(e=b.profile)||void 0===e?void 0:e.bio)||""),[w,C]=(0,a.useState)((null===b||void 0===b||null===(t=b.profile)||void 0===t?void 0:t.birthdate)||""),[A,S]=(0,a.useState)((null===b||void 0===b?void 0:b.phoneNumber)||""),[P,F]=(0,a.useState)(null),[B,D]=(0,a.useState)((null===b||void 0===b?void 0:b.photoURL)||null),[_,I]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=window.location.hash.slice(1);e&&setTimeout(()=>{const t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.transition="background-color 0.3s",t.style.backgroundColor="rgba(168, 85, 247, 0.1)",setTimeout(()=>{t.style.backgroundColor=""},2e3))},100)},[]);const[E,M]=(0,a.useState)(!1),[R,q]=(0,a.useState)(""),[T,U]=(0,a.useState)(null),[L,V]=(0,a.useState)(""),[Y,G]=(0,a.useState)(!1),z=async()=>{if(!A||A===(null===b||void 0===b?void 0:b.phoneNumber))return void d.Ay.error("Please enter a new phone number");const e=A.trim();if(!e)return void d.Ay.error("Please enter a phone number");if(!/^[0-9+\s\-()]+$/.test(e))return void d.Ay.error("Phone number can only contain digits, +, spaces, hyphens, and parentheses");let t=e.replace(/[\s\-()]/g,"");if(t.startsWith("+")||(t=t.startsWith("0")?"+61"+t.slice(1):"+"+t),!u(t))return void d.Ay.error("Invalid phone number format. Please enter a valid international number (e.g., +61412345678 or 0412345678)",{duration:5e3});const i=t.slice(1);if(i.length<8)return void d.Ay.error("Phone number is too short. Please enter a complete phone number");if(i.length>15)return void d.Ay.error("Phone number is too long. Please check and try again");I(!0);const s=o.authService.setupRecaptcha("phone-recaptcha-container");if(!s.success)return d.Ay.error("Failed to set up verification. Please refresh the page."),void I(!1);const a=await o.authService.sendPhoneVerification(t,s.verifier);I(!1),a.success?(U(a.confirmationResult),V(t),M(!0),d.Ay.success("Verification code sent to your phone!")):d.Ay.error(a.error||"Failed to send verification code")},W=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=(null===b||void 0===b?void 0:b.photoURL)||null;if(P){const e=await(async()=>{if(!P)return(null===b||void 0===b?void 0:b.photoURL)||null;try{const e=(0,c.KR)(o.storage,"profile-pictures/".concat(h.uid,"/").concat(Date.now(),"_").concat(P.name));return await(0,c.D)(e,P),await(0,c.qk)(e)}catch(e){return console.error("Error uploading profile picture:",e),d.Ay.error("Failed to upload profile picture"),(null===b||void 0===b?void 0:b.photoURL)||null}})();e&&(t=e)}await(0,l.mZ)((0,l.H9)(o.db,"users",h.uid),{displayName:g,phoneNumber:e||A,photoURL:t,"profile.bio":j,"profile.birthdate":w,updatedAt:new Date});const{logAnalyticsEvent:a}=i(3984);a("profile_updated",{has_photo:!!t,has_bio:!!j,has_birthdate:!!w}),d.Ay.success("Profile updated successfully!");const r=(0,l.P)((0,l.rJ)(o.db,"besties"),(0,l._M)("requesterId","==",h.uid),(0,l._M)("status","==","accepted")),n=(0,l.P)((0,l.rJ)(o.db,"besties"),(0,l._M)("recipientId","==",h.uid),(0,l._M)("status","==","accepted")),[u,m]=await Promise.all([(0,l.GG)(r),(0,l.GG)(n)]),x=u.size+m.size,f=(0,s.A)((0,s.A)({},b),{},{displayName:g,phoneNumber:e||A,photoURL:t,profile:(0,s.A)((0,s.A)({},null===b||void 0===b?void 0:b.profile),{},{bio:j,birthdate:w})});await p(h.uid,f,h,x)?G(!0):setTimeout(()=>{v("/profile")},500)}catch(t){console.error("Error updating profile:",t),d.Ay.error(t.message||"Failed to update profile")}finally{I(!1)}};return(0,f.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,f.jsxs)("div",{className:"max-w-2xl mx-auto p-4 pb-32 md:pb-20",children:[(0,f.jsxs)("div",{className:"mb-6",children:[(0,f.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"Edit Profile"}),(0,f.jsx)("p",{className:"text-text-secondary",children:"Update your personal information"})]}),(0,f.jsxs)("form",{onSubmit:async e=>{e.preventDefault();A&&A!==(null===b||void 0===b?void 0:b.phoneNumber)?z():(I(!0),await W())},className:"space-y-6",children:[(0,f.jsxs)("div",{id:"profile-picture",className:"card p-6",children:[(0,f.jsx)("label",{className:"block text-lg font-display text-text-primary mb-4",children:"Profile Picture"}),(0,f.jsxs)("div",{className:"flex items-center gap-6",children:[(0,f.jsx)("div",{className:"w-24 h-24 bg-gradient-primary rounded-full flex items-center justify-center text-white text-3xl font-display overflow-hidden",children:B?(0,f.jsx)("img",{src:B,alt:"Profile",className:"w-full h-full object-cover"}):(null===g||void 0===g?void 0:g[0])||"U"}),(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return void d.Ay.error("File size must be less than 5MB");F(t),D(URL.createObjectURL(t))}},className:"hidden",id:"profile-picture"}),(0,f.jsx)("label",{htmlFor:"profile-picture",className:"btn btn-secondary cursor-pointer inline-block",children:"Choose Photo"}),(0,f.jsx)("div",{className:"text-sm text-text-secondary mt-2",children:"JPG, PNG or GIF. Max size 5MB"})]})]})]}),(0,f.jsxs)("div",{id:"basic-info",className:"card p-6",children:[(0,f.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Basic Information"}),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{id:"display-name",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Display Name"}),(0,f.jsx)("input",{type:"text",value:g,onChange:e=>N(e.target.value),className:"input",placeholder:"Your name",required:!0})]}),(0,f.jsxs)("div",{id:"bio",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Bio"}),(0,f.jsx)("textarea",{value:j,onChange:e=>k(e.target.value),className:"input min-h-[80px] resize-none",placeholder:"Tell people about yourself...",maxLength:150}),(0,f.jsxs)("div",{className:"text-xs text-text-secondary mt-1",children:[j.length,"/150 characters"]})]}),(0,f.jsxs)("div",{id:"birthday",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Birthday \ud83c\udf82"}),(0,f.jsx)("input",{type:"date",value:w,onChange:e=>C(e.target.value),className:"input",max:(new Date).toISOString().split("T")[0]}),(0,f.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"Your besties will be notified on your birthday! (Optional)"})]}),(0,f.jsxs)("div",{id:"phone",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Phone Number"}),(0,f.jsxs)("div",{className:"flex gap-2",children:[(0,f.jsx)("input",{type:"tel",value:A,onChange:e=>S(e.target.value),className:"input flex-1",placeholder:"+61 400 000 000 or 0400 000 000"}),A!==(null===b||void 0===b?void 0:b.phoneNumber)&&A&&(0,f.jsx)("button",{type:"button",onClick:z,disabled:_,className:"btn btn-primary whitespace-nowrap",children:_?"Sending...":"Verify Now"})]}),A!==(null===b||void 0===b?void 0:b.phoneNumber)&&A&&(0,f.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:'\u26a0\ufe0f Click "Verify Now" to verify this number via SMS'})]})]})]}),(0,f.jsxs)("div",{className:"card p-6",children:[(0,f.jsx)("h3",{className:"text-lg font-display text-text-primary mb-4",children:"Account Info"}),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Email"}),(0,f.jsx)("div",{className:"font-semibold text-text-primary",children:null===h||void 0===h?void 0:h.email}),(0,f.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:"To change your email, use Google authentication"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Member Since"}),(0,f.jsx)("div",{className:"font-semibold text-text-primary",children:(null===b||void 0===b||null===(m=b.stats)||void 0===m||null===(x=m.joinedAt)||void 0===x?void 0:x.toDate().toLocaleDateString())||"Recently"})]})]})]}),(0,f.jsxs)("div",{className:"flex gap-3",children:[(0,f.jsx)("button",{type:"button",onClick:()=>v("/profile"),className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,f.jsxs)("button",{type:"submit",disabled:_,className:"flex-1 btn btn-primary flex items-center justify-center gap-2",children:[_&&(0,f.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),_?"Sending verification...":"Save Changes"]})]})]}),E&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,f.jsxs)("div",{className:"card dark:bg-gray-800 p-6 max-w-md w-full animate-scale-up",children:[(0,f.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"Verify Phone Number"}),(0,f.jsxs)("p",{className:"text-text-secondary mb-4",children:["We sent a 6-digit code to ",(0,f.jsx)("strong",{children:L})]}),(0,f.jsxs)("div",{className:"mb-4",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Verification Code"}),(0,f.jsx)("input",{type:"text",value:R,onChange:e=>q(e.target.value),className:"input",placeholder:"123456",maxLength:6,autoFocus:!0})]}),(0,f.jsxs)("div",{className:"flex gap-3",children:[(0,f.jsx)("button",{onClick:()=>{M(!1),q(""),U(null)},className:"flex-1 btn btn-secondary",disabled:_,children:"Cancel"}),(0,f.jsxs)("button",{onClick:async()=>{if(!R||!T)return void d.Ay.error("Please enter the verification code");I(!0);const e=await o.authService.verifyPhoneCode(T,R);if(e.success){var t;d.Ay.success("Phone number verified!"),M(!1),S(L);try{await h.getIdToken(!0),await new Promise(e=>setTimeout(e,500))}catch(i){console.error("Token refresh error:",i)}null!==b&&void 0!==b&&null!==(t=b.notificationPreferences)&&void 0!==t&&t.sms||(0,d.Ay)(e=>(0,f.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,f.jsx)("div",{className:"font-semibold",children:"\ud83d\udcf1 Enable SMS Alerts?"}),(0,f.jsx)("div",{className:"text-sm",children:"Would you like to receive emergency alerts via SMS?"}),(0,f.jsxs)("div",{className:"flex gap-2",children:[(0,f.jsx)("button",{onClick:async()=>{try{await(0,l.mZ)((0,l.H9)(o.db,"users",h.uid),{"notificationPreferences.sms":!0}),d.Ay.success("SMS alerts enabled!"),d.Ay.dismiss(e.id)}catch(i){console.error("Error enabling SMS:",i),d.Ay.error("Failed to enable SMS")}},className:"btn btn-primary btn-sm",children:"Enable SMS"}),(0,f.jsx)("button",{onClick:()=>d.Ay.dismiss(e.id),className:"btn btn-secondary btn-sm",children:"Not Now"})]}),(0,f.jsx)("div",{className:"text-xs text-gray-500",children:"You can change this later in Settings"})]}),{duration:1e4}),W(L)}else I(!1),d.Ay.error(e.error||"Invalid verification code")},className:"flex-1 btn btn-primary flex items-center justify-center gap-2",disabled:_||6!==R.length,children:[_&&(0,f.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),_?"Verifying & Saving...":"Verify & Save"]})]}),(0,f.jsxs)("p",{className:"text-xs text-text-secondary mt-4 text-center",children:["Didn't receive the code?"," ",(0,f.jsx)("button",{onClick:z,className:"text-primary underline",disabled:_,children:"Resend"})]})]})}),(0,f.jsx)("div",{id:"phone-recaptcha-container"}),(0,f.jsx)(y,{isOpen:Y,onClose:()=>{G(!1),v("/profile")}})]})})}}}]);
//# sourceMappingURL=206.a485a8bd.chunk.js.map