"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[69],{7069:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(2555),l=t(5043),n=t(3216),r=t(7400),i=t(5472),c=t(2339),d=t(559),o=t(579);const x=()=>{var e,s,t;const{alertId:x}=(0,n.g)(),m=(0,n.Zp)(),[h,p]=(0,l.useState)(null),[b,y]=(0,l.useState)(null),[j,u]=(0,l.useState)(!0),[N,g]=(0,l.useState)(null),[f,v]=(0,l.useState)(!1),[w,k]=(0,l.useState)(!1),[A,C]=(0,l.useState)(""),[S,I]=(0,l.useState)(null);(0,l.useEffect)(()=>{T()},[x]);const T=async()=>{try{const e=r.j2.currentUser;if(!e)return void m("/login");let s=await(0,i.x7)((0,i.H9)(r.db,"checkins",x)),t="checkin";if(s.exists()||(s=await(0,i.x7)((0,i.H9)(r.db,"emergency_sos",x)),t="sos"),!s.exists())return void u(!1);const l=(0,a.A)((0,a.A)({id:s.id},s.data()),{},{type:t});p(l);const n=await(0,i.x7)((0,i.H9)(r.db,"users",l.userId));n.exists()&&y(n.data());const c=(0,i.P)((0,i.rJ)(r.db,"alert_responses"),(0,i._M)("alertId","==",x),(0,i._M)("responderId","==",e.uid)),d=await(0,i.GG)(c);d.empty||g(d.docs[0].data())}catch(e){console.error("Error loading alert:",e)}finally{u(!1)}},_=async function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return I(e),void k(!0);await E(e,"")},E=async(e,s)=>{const t=r.j2.currentUser;if(t&&h){v(!0);try{const a=i.Dc.now(),l=h.createdAt||h.alertedAt||a,n=Math.floor((a.toMillis()-l.toMillis())/1e3);await(0,i.gS)((0,i.rJ)(r.db,"alert_responses"),{alertId:x,alertType:h.type,userId:h.userId,responderId:t.uid,responseType:e,responseTime:n,note:s||null,createdAt:a}),await(0,i.gS)((0,i.rJ)(r.db,"interactions"),{userId:h.userId,bestieId:t.uid,type:"alert_response",checkInId:"checkin"===h.type?x:null,alertId:x,metadata:{responseTime:n,action:e},createdAt:a}),g({responseType:e,note:s,createdAt:a}),k(!1),C(""),I(null);const d={acknowledged:"Response recorded - they'll know you saw this",called:"Great! Hope they're okay",on_my_way:"Stay safe! They'll be glad you're coming",contacted_them:"Thanks for reaching out to them"};c.Ay.success(d[e]||"Response recorded")}catch(a){console.error("Error recording response:",a),c.Ay.error("Failed to record response")}finally{v(!1)}}};if(j)return(0,o.jsx)("div",{className:"min-h-screen bg-pattern flex items-center justify-center",children:(0,o.jsx)("div",{className:"spinner"})});if(!h)return(0,o.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,o.jsx)(d.A,{}),(0,o.jsxs)("div",{className:"max-w-2xl mx-auto p-4 text-center mt-20",children:[(0,o.jsx)("div",{className:"text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,o.jsx)("h1",{className:"text-2xl font-display text-text-primary mb-2",children:"Alert Not Found"}),(0,o.jsx)("p",{className:"text-text-secondary mb-6",children:"This alert may have been resolved or removed."}),(0,o.jsx)("button",{onClick:()=>m("/"),className:"btn btn-primary",children:"Go Home"})]})]});const R="checkin"===h.type,L="sos"===h.type;return(0,o.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,o.jsx)(d.A,{}),(0,o.jsxs)("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[(0,o.jsx)("div",{className:"card p-6 mb-6 ".concat(L?"bg-red-50 border-2 border-red-500":"bg-yellow-50 border-2 border-yellow-500"),children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"text-6xl mb-4",children:L?"\ud83c\udd98":"\ud83d\udea8"}),(0,o.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:L?"EMERGENCY ALERT":"SAFETY ALERT"}),(0,o.jsxs)("p",{className:"text-lg text-text-secondary",children:[(null===b||void 0===b?void 0:b.displayName)||"A friend"," ",L?"triggered an emergency SOS":"hasn't checked in"]})]})}),(0,o.jsxs)("div",{className:"card p-6 mb-6",children:[(0,o.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Details"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Person"}),(0,o.jsxs)("div",{className:"font-semibold text-text-primary flex items-center gap-3",children:[(0,o.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white",children:(null===b||void 0===b||null===(e=b.displayName)||void 0===e?void 0:e[0])||"?"}),(null===b||void 0===b?void 0:b.displayName)||"Unknown"]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Location"}),(0,o.jsx)("div",{className:"font-semibold text-text-primary",children:h.location||"Unknown"})]}),R&&h.meetingWith&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Meeting With"}),(0,o.jsx)("div",{className:"font-semibold text-text-primary",children:h.meetingWith})]}),R&&h.notes&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Notes"}),(0,o.jsx)("div",{className:"font-semibold text-text-primary",children:h.notes})]}),h.photoURL&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Photo"}),(0,o.jsx)("img",{src:h.photoURL,alt:"Check-in",className:"w-full rounded-xl max-h-64 object-cover"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Time"}),(0,o.jsx)("div",{className:"font-semibold text-text-primary",children:null===(s=h.createdAt)||void 0===s?void 0:s.toDate().toLocaleString()})]}),R&&h.alertTime&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Expected Check-In By"}),(0,o.jsx)("div",{className:"font-semibold text-text-primary",children:h.alertTime.toDate().toLocaleTimeString()})]})]})]}),(0,o.jsxs)("div",{className:"card p-6 bg-primary/10",children:[(0,o.jsx)("h3",{className:"font-display text-lg text-text-primary mb-3",children:"What to do:"}),(0,o.jsxs)("ul",{className:"space-y-2 text-text-secondary",children:[(0,o.jsxs)("li",{className:"flex gap-2",children:[(0,o.jsx)("span",{children:"1."}),(0,o.jsxs)("span",{children:["Try calling or messaging ",null===b||void 0===b?void 0:b.displayName]})]}),(0,o.jsxs)("li",{className:"flex gap-2",children:[(0,o.jsx)("span",{children:"2."}),(0,o.jsx)("span",{children:"Check if they're at the location listed above"})]}),(0,o.jsxs)("li",{className:"flex gap-2",children:[(0,o.jsx)("span",{children:"3."}),(0,o.jsx)("span",{children:"If you can't reach them, consider contacting local authorities"})]}),L&&(0,o.jsxs)("li",{className:"flex gap-2 font-semibold text-red-600",children:[(0,o.jsx)("span",{children:"\u26a0\ufe0f"}),(0,o.jsx)("span",{children:"This is an EMERGENCY - act immediately!"})]})]})]}),N?(0,o.jsxs)("div",{className:"card p-6 mt-6 bg-green-50 border-2 border-green-500",children:[(0,o.jsxs)("h3",{className:"font-display text-lg text-text-primary mb-2 flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\u2705"}),"You responded to this alert"]}),(0,o.jsxs)("div",{className:"text-sm text-text-secondary space-y-1",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Action:"}),(0,o.jsx)("span",{className:"capitalize",children:N.responseType.replace(/_/g," ")})]}),N.note&&(0,o.jsxs)("div",{className:"flex items-start gap-2 mt-2",children:[(0,o.jsx)("span",{className:"font-semibold",children:"Note:"}),(0,o.jsx)("span",{className:"flex-1",children:N.note})]}),(0,o.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Responded ",null===(t=N.createdAt)||void 0===t?void 0:t.toDate().toLocaleString()]})]})]}):(0,o.jsxs)("div",{className:"card p-6 mt-6 bg-gradient-to-br from-purple-50 to-pink-50",children:[(0,o.jsx)("h3",{className:"font-display text-lg text-text-primary mb-4 text-center",children:"Let them know you're here to help"}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,o.jsxs)("button",{onClick:()=>_("acknowledged"),disabled:f,className:"btn btn-secondary py-3 flex flex-col items-center gap-1",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udc40"}),(0,o.jsx)("span",{className:"text-sm font-semibold",children:"I saw this"})]}),(0,o.jsxs)("button",{onClick:()=>_("called"),disabled:f,className:"btn bg-blue-500 hover:bg-blue-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\udcde"}),(0,o.jsx)("span",{className:"text-sm font-semibold",children:"I called them"})]}),(0,o.jsxs)("button",{onClick:()=>_("on_my_way"),disabled:f,className:"btn bg-orange-500 hover:bg-orange-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\ud83d\ude97"}),(0,o.jsx)("span",{className:"text-sm font-semibold",children:"On my way"})]}),(0,o.jsxs)("button",{onClick:()=>_("contacted_them"),disabled:f,className:"btn bg-green-500 hover:bg-green-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,o.jsx)("span",{className:"text-2xl",children:"\u2705"}),(0,o.jsx)("span",{className:"text-sm font-semibold",children:"Contacted"})]})]}),(0,o.jsx)("button",{onClick:()=>k(!0),disabled:f,className:"w-full btn btn-outline text-sm py-2",children:"\ud83d\udcdd Add a note about what you did"})]}),(null===b||void 0===b?void 0:b.phoneNumber)&&(0,o.jsx)("div",{className:"mt-4",children:(0,o.jsxs)("a",{href:"tel:".concat(b.phoneNumber),className:"w-full btn btn-primary text-lg py-4 block text-center",children:["\ud83d\udcde Call ",b.displayName]})}),w&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>k(!1),children:(0,o.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("h3",{className:"text-xl font-display mb-4",children:"Add a note"}),(0,o.jsx)("textarea",{value:A,onChange:e=>C(e.target.value),placeholder:"What did you do to help? (optional)",className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none min-h-32 resize-none"}),(0,o.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,o.jsx)("button",{onClick:()=>{k(!1),C(""),I(null)},className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,o.jsx)("button",{onClick:()=>E(S||"acknowledged",A),disabled:f,className:"flex-1 btn btn-primary",children:f?"Saving...":"Save Response"})]})]})})]})]})}}}]);
//# sourceMappingURL=69.6bfc4d7c.chunk.js.map