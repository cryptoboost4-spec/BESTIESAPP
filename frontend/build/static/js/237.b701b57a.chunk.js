"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[237],{6237:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(2555),c=s(5043),r=s(4528),i=s(7400),d=s(5472),n=s(3007),l=s(559),o=s(2339),x=s(579);const m=()=>{const{currentUser:e}=(0,r.As)(),[t,s]=(0,c.useState)([]),[m,u]=(0,c.useState)(!0),[p,h]=(0,c.useState)("all");(0,c.useEffect)(()=>{f()},[e,p]);const f=async()=>{if(e){u(!0);try{const t=(0,d.P)((0,d.rJ)(i.db,"besties"),(0,d._M)("requesterId","==",e.uid),(0,d._M)("status","==","accepted")),c=(0,d.P)((0,d.rJ)(i.db,"besties"),(0,d._M)("recipientId","==",e.uid),(0,d._M)("status","==","accepted")),[r,n]=await Promise.all([(0,d.GG)(t),(0,d.GG)(c)]),l=new Set([e.uid]);r.forEach(e=>{const t=e.data();t.recipientId&&l.add(t.recipientId)}),n.forEach(e=>{const t=e.data();t.requesterId&&l.add(t.requesterId)});const o=Array.from(l),x=[];for(const s of o){let t=(0,d.P)((0,d.rJ)(i.db,"checkins"),(0,d._M)("userId","==",s),(0,d.My)("createdAt","desc"),(0,d.AB)(10));"active"===p?t=(0,d.P)((0,d.rJ)(i.db,"checkins"),(0,d._M)("userId","==",s),(0,d._M)("status","==","active"),(0,d.My)("createdAt","desc"),(0,d.AB)(10)):"completed"===p&&(t=(0,d.P)((0,d.rJ)(i.db,"checkins"),(0,d._M)("userId","==",s),(0,d._M)("status","==","completed"),(0,d.My)("createdAt","desc"),(0,d.AB)(10)));const c=await(0,d.GG)(t);for(const r of c.docs){const t=r.data(),c=await(0,d.x7)((0,d.H9)(i.db,"users",s)),n=c.exists()?c.data():null;x.push((0,a.A)((0,a.A)({id:r.id},t),{},{userName:(null===n||void 0===n?void 0:n.displayName)||"Unknown User",userPhoto:(null===n||void 0===n?void 0:n.photoURL)||null,isOwn:s===e.uid}))}}x.sort((e,t)=>t.createdAt-e.createdAt),s(x.slice(0,50)),u(!1)}catch(t){console.error("Error loading feed:",t),o.Ay.error("Failed to load feed"),u(!1)}}},y=e=>{switch(e){case"active":return"text-warning";case"completed":return"text-success";case"alerted":return"text-danger";default:return"text-text-secondary"}},b=e=>{switch(e){case"active":return"\u23f0";case"completed":return"\u2705";case"alerted":return"\ud83d\udea8";default:return"\ud83d\udccd"}};return m?(0,x.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,x.jsx)(l.A,{}),(0,x.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,x.jsx)("div",{className:"spinner"})})]}):(0,x.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,x.jsx)(l.A,{}),(0,x.jsxs)("div",{className:"max-w-4xl mx-auto p-4 pb-20",children:[(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:"Social Feed"}),(0,x.jsx)("p",{className:"text-text-secondary",children:"See what your besties are up to (privacy-safe)"})]}),(0,x.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,x.jsx)("button",{onClick:()=>h("all"),className:"px-4 py-2 rounded-full font-semibold ".concat("all"===p?"bg-primary text-white":"bg-white text-text-primary"),children:"All"}),(0,x.jsx)("button",{onClick:()=>h("active"),className:"px-4 py-2 rounded-full font-semibold ".concat("active"===p?"bg-warning text-white":"bg-white text-text-primary"),children:"Active Now"}),(0,x.jsx)("button",{onClick:()=>h("completed"),className:"px-4 py-2 rounded-full font-semibold ".concat("completed"===p?"bg-success text-white":"bg-white text-text-primary"),children:"Safe & Sound"})]}),0===t.length?(0,x.jsxs)("div",{className:"card p-12 text-center",children:[(0,x.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udc65"}),(0,x.jsx)("h2",{className:"text-2xl font-display text-text-primary mb-2",children:"No activity yet"}),(0,x.jsx)("p",{className:"text-text-secondary",children:"active"===p?"None of your besties are checked in right now":"Add besties to see their check-ins here"})]}):(0,x.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,x.jsx)("div",{className:"card p-4",children:(0,x.jsxs)("div",{className:"flex items-start gap-3",children:[(0,x.jsx)("div",{className:"flex-shrink-0",children:e.userPhoto?(0,x.jsx)("img",{src:e.userPhoto,alt:e.userName,className:"w-12 h-12 rounded-full object-cover"}):(0,x.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-primary flex items-center justify-center text-white font-semibold",children:e.userName.charAt(0).toUpperCase()})}),(0,x.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,x.jsx)("span",{className:"font-semibold text-text-primary",children:e.isOwn?"You":e.userName}),(0,x.jsx)("span",{className:"text-text-secondary text-sm",children:e.createdAt&&(0,n.m)(e.createdAt.toDate(),{addSuffix:!0})})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,x.jsx)("span",{className:"text-lg ".concat(y(e.status)),children:b(e.status)}),(0,x.jsxs)("span",{className:"text-text-primary",children:["active"===e.status&&"is checked in at","completed"===e.status&&"safely returned from","alerted"===e.status&&"needs help at"]}),(0,x.jsx)("span",{className:"font-semibold text-text-primary",children:e.location})]}),(0,x.jsxs)("div",{className:"flex flex-wrap gap-2 text-sm text-text-secondary",children:[(0,x.jsxs)("span",{children:["\u23f1\ufe0f ",e.duration," minutes"]}),"active"===e.status&&e.alertTime&&(0,x.jsxs)("span",{children:["\u2022 Alert in ",Math.round((e.alertTime.toDate()-new Date)/6e4)," min"]}),"completed"===e.status&&e.completedAt&&(0,x.jsxs)("span",{children:["\u2022 Completed ",(0,n.m)(e.completedAt.toDate(),{addSuffix:!0})]})]}),e.notes&&(0,x.jsxs)("div",{className:"mt-2 text-sm text-text-secondary italic",children:['"',e.notes,'"']}),(0,x.jsx)("div",{className:"mt-3",children:(0,x.jsxs)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-semibold ".concat("active"===e.status?"bg-warning/10 text-warning":"completed"===e.status?"bg-success/10 text-success":"alerted"===e.status?"bg-danger/10 text-danger":"bg-gray-100 text-text-secondary"),children:["active"===e.status&&"\ud83d\udfe1 Active","completed"===e.status&&"\ud83d\udfe2 Safe","alerted"===e.status&&"\ud83d\udd34 Alert"]})})]})]})},e.id))}),(0,x.jsx)("div",{className:"card p-4 mt-6 bg-primary/5 border border-primary/20",children:(0,x.jsxs)("div",{className:"text-sm text-text-secondary",children:[(0,x.jsx)("strong",{className:"text-text-primary",children:"\ud83d\udd12 Privacy:"})," Only your accepted besties can see your check-ins. You can only see check-ins from people in your safety circle."]})})]})]})}}}]);
//# sourceMappingURL=237.b701b57a.chunk.js.map