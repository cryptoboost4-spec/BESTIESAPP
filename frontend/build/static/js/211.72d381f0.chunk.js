"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[211],{4211:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var s=a(2555),r=a(5043),d=a(3216),n=a(4528),i=a(3984),l=a(5472),c=a(8639),o=a(3007),x=a(579);const m=()=>{var e,t,a;const m=(0,d.Zp)(),{currentUser:h,userData:k}=(0,n.As)(),[p,y]=(0,r.useState)([]),[g,u]=(0,r.useState)(!0),[b,v]=(0,r.useState)(!1),[j,N]=(0,r.useState)("all"),[f,w]=(0,r.useState)(null),[M,C]=(0,r.useState)(!0),[A,L]=(0,r.useState)(new Set),[S,P]=(0,r.useState)({});(0,r.useEffect)(()=>{I()},[h,j]),(0,r.useEffect)(()=>{p.length>0&&(async()=>{const e=new Set;p.forEach(t=>{t.bestieIds&&t.bestieIds.forEach(t=>e.add(t))}),P(t=>{const a=(0,s.A)({},t),r=[];for(const s of e)a[s]||r.push((0,l.x7)((0,l.H9)(i.db,"users",s)).then(e=>{if(e.exists()){const t=e.data();a[s]=t.displayName||"Unknown"}else a[s]="Unknown"}).catch(e=>{console.error("Error fetching bestie name:",e),a[s]="Unknown"}));return r.length>0&&Promise.all(r).then(()=>P((0,s.A)({},a))),a})})()},[p]);const I=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(h){e?v(!0):(u(!0),y([]),w(null),C(!0));try{let t=(0,l.P)((0,l.rJ)(i.db,"checkins"),(0,l._M)("userId","==",h.uid),(0,l.My)("createdAt","desc"),(0,l.AB)(20));"completed"===j?t=(0,l.P)((0,l.rJ)(i.db,"checkins"),(0,l._M)("userId","==",h.uid),(0,l._M)("status","==","completed"),(0,l.My)("createdAt","desc"),(0,l.AB)(20)):"alerted"===j&&(t=(0,l.P)((0,l.rJ)(i.db,"checkins"),(0,l._M)("userId","==",h.uid),(0,l._M)("status","==","alerted"),(0,l.My)("createdAt","desc"),(0,l.AB)(20))),e&&f&&(t=(0,l.P)(t,(0,l.HM)(f)));const a=await(0,l.GG)(t),r=[];a.forEach(e=>{r.push((0,s.A)({id:e.id},e.data()))}),y(e?e=>[...e,...r]:r),w(a.docs[a.docs.length-1]||null),C(20===r.length),u(!1),v(!1)}catch(t){console.error("Error loading history:",t),e||y([]),u(!1),v(!1)}}},D=e=>{const t=new Set(A);t.has(e)?t.delete(e):t.add(e),L(t)},U=e=>{switch(e){case"completed":return(0,x.jsx)("span",{className:"badge badge-success",children:"\u2705 Safe"});case"alerted":return(0,x.jsx)("span",{className:"badge badge-warning",children:"\ud83d\udea8 Alerted"});case"active":return(0,x.jsx)("span",{className:"badge badge-primary",children:"\u23f0 Active"});default:return(0,x.jsx)("span",{className:"badge",children:"Unknown"})}},B=e=>{if(e<60)return"".concat(e,"m");const t=Math.floor(e/60),a=e%60;return a>0?"".concat(t,"h ").concat(a,"m"):"".concat(t,"h")};return g?(0,x.jsx)("div",{className:"min-h-screen bg-pattern dark:bg-dark-pattern",children:(0,x.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,x.jsx)("div",{className:"spinner"})})}):(0,x.jsx)("div",{className:"min-h-screen bg-pattern dark:bg-dark-pattern",children:(0,x.jsxs)("div",{className:"max-w-4xl mx-auto p-4 pb-20",children:[(0,x.jsxs)("button",{onClick:()=>m(-1),className:"flex items-center gap-2 text-primary dark:text-dark-primary hover:underline mb-4 font-semibold",children:[(0,x.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h1",{className:"text-3xl font-display text-text-primary dark:text-dark-text-primary mb-2",children:"Check-in History"}),(0,x.jsx)("p",{className:"text-text-secondary dark:text-dark-text-secondary",children:"View all your past check-ins"})]}),(0,x.jsxs)("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[(0,x.jsx)("button",{onClick:()=>N("all"),className:"px-4 py-2 rounded-full font-semibold whitespace-nowrap transition-all ".concat("all"===j?"bg-primary text-white":"bg-white dark:bg-dark-card text-text-primary dark:text-dark-text-primary hover:bg-gray-50 dark:hover:bg-dark-hover"),children:"All"}),(0,x.jsx)("button",{onClick:()=>N("completed"),className:"px-4 py-2 rounded-full font-semibold whitespace-nowrap transition-all ".concat("completed"===j?"bg-success text-white":"bg-white dark:bg-dark-card text-text-primary dark:text-dark-text-primary hover:bg-gray-50 dark:hover:bg-dark-hover"),children:"\u2705 Safe"}),(0,x.jsx)("button",{onClick:()=>N("alerted"),className:"px-4 py-2 rounded-full font-semibold whitespace-nowrap transition-all ".concat("alerted"===j?"bg-warning text-white":"bg-white dark:bg-dark-card text-text-primary dark:text-dark-text-primary hover:bg-gray-50 dark:hover:bg-dark-hover"),children:"\ud83d\udea8 Alerted"})]}),(0,x.jsx)("div",{className:"card dark:bg-dark-card p-6 mb-6",children:(0,x.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"text-2xl font-display text-primary dark:text-dark-primary",children:(null===k||void 0===k||null===(e=k.stats)||void 0===e?void 0:e.totalCheckIns)||0}),(0,x.jsx)("div",{className:"text-sm text-text-secondary dark:text-dark-text-secondary",children:"Total"})]}),(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"text-2xl font-display text-success dark:text-dark-success",children:(null===k||void 0===k||null===(t=k.stats)||void 0===t?void 0:t.completedCheckIns)||0}),(0,x.jsx)("div",{className:"text-sm text-text-secondary dark:text-dark-text-secondary",children:"Completed"})]}),(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"text-2xl font-display text-warning dark:text-dark-warning",children:(null===k||void 0===k||null===(a=k.stats)||void 0===a?void 0:a.alertedCheckIns)||0}),(0,x.jsx)("div",{className:"text-sm text-text-secondary dark:text-dark-text-secondary",children:"Alerted"})]})]})}),0===p.length?(0,x.jsxs)("div",{className:"card dark:bg-dark-card p-12 text-center",children:[(0,x.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udccb"}),(0,x.jsx)("h2",{className:"text-2xl font-display text-text-primary dark:text-dark-text-primary mb-2",children:"No check-ins yet"}),(0,x.jsx)("p",{className:"text-text-secondary dark:text-dark-text-secondary",children:"Your check-in history will appear here"})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"space-y-4",children:p.map(e=>{var t,a,s,r,d,n;const i=A.has(e.id),l=(e=>{var t,a;return e.notes||e.meetingWith||e.socialMediaLinks||e.gpsCoords||(null===(t=e.photoURLs)||void 0===t?void 0:t.length)>0||(null===(a=e.bestieIds)||void 0===a?void 0:a.length)>0||e.alertTime||e.completedAt||e.alertedAt})(e);return(0,x.jsxs)("div",{className:"card dark:bg-dark-card p-4 md:p-6 transition-all ".concat(l?"cursor-pointer hover:shadow-lg":""),onClick:()=>l&&D(e.id),children:[(0,x.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,x.jsx)("h3",{className:"font-display text-lg text-text-primary dark:text-dark-text-primary",children:e.location||"No location"}),U(e.status)]}),(0,x.jsx)("div",{className:"text-sm text-text-secondary dark:text-dark-text-secondary",children:null!==(t=e.createdAt)&&void 0!==t&&t.toDate?(0,o.m)(e.createdAt.toDate(),{addSuffix:!0}):"Unknown time"})]}),l&&(0,x.jsx)("button",{className:"text-primary dark:text-dark-primary ml-2 flex-shrink-0",onClick:t=>{t.stopPropagation(),D(e.id)},children:(0,x.jsx)("svg",{className:"w-6 h-6 transition-transform ".concat(i?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm mb-3",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-text-secondary dark:text-dark-text-secondary",children:"Duration"}),(0,x.jsx)("div",{className:"font-semibold text-text-primary dark:text-dark-text-primary",children:e.duration?B(e.duration):"N/A"})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-text-secondary dark:text-dark-text-secondary",children:"Besties Notified"}),(0,x.jsx)("div",{className:"font-semibold text-text-primary dark:text-dark-text-primary",children:(null===(a=e.bestieIds)||void 0===a?void 0:a.length)||0})]})]}),i&&(0,x.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-dark-border space-y-3 animate-fade-in",children:[(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"Timestamps"}),(0,x.jsxs)("div",{className:"space-y-1 text-sm",children:[(null===(s=e.createdAt)||void 0===s?void 0:s.toDate)&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-text-secondary dark:text-dark-text-secondary",children:"Created:"}),(0,x.jsx)("span",{className:"font-medium text-text-primary dark:text-dark-text-primary",children:(0,c.GP)(e.createdAt.toDate(),"MMM d, yyyy h:mm a")})]}),(null===(r=e.alertTime)||void 0===r?void 0:r.toDate)&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-text-secondary dark:text-dark-text-secondary",children:"Alert Time:"}),(0,x.jsx)("span",{className:"font-medium text-text-primary dark:text-dark-text-primary",children:(0,c.GP)(e.alertTime.toDate(),"MMM d, yyyy h:mm a")})]}),(null===(d=e.completedAt)||void 0===d?void 0:d.toDate)&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-success dark:text-dark-success",children:"\u2705 Completed:"}),(0,x.jsx)("span",{className:"font-medium text-success dark:text-dark-success",children:(0,c.GP)(e.completedAt.toDate(),"MMM d, yyyy h:mm a")})]}),(null===(n=e.alertedAt)||void 0===n?void 0:n.toDate)&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-warning dark:text-dark-warning",children:"\ud83d\udea8 Alerted:"}),(0,x.jsx)("span",{className:"font-medium text-warning dark:text-dark-warning",children:(0,c.GP)(e.alertedAt.toDate(),"MMM d, yyyy h:mm a")})]})]})]}),e.bestieIds&&e.bestieIds.length>0&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"Notified Besties"}),(0,x.jsx)("div",{className:"flex flex-wrap gap-2",children:e.bestieIds.map(e=>(0,x.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary dark:bg-primary/20 dark:text-dark-primary rounded-full text-sm",children:["\ud83d\udc64 ",S[e]||"Loading..."]},e))})]}),e.notes&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"Notes"}),(0,x.jsxs)("div",{className:"text-sm text-text-primary dark:text-dark-text-primary italic",children:['"',e.notes,'"']})]}),e.meetingWith&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"Meeting With"}),(0,x.jsx)("div",{className:"text-sm text-text-primary dark:text-dark-text-primary",children:e.meetingWith})]}),e.socialMediaLinks&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"Social Media Links"}),(0,x.jsx)("div",{className:"text-sm text-text-primary dark:text-dark-text-primary break-all",children:e.socialMediaLinks})]}),e.gpsCoords&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsx)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:"GPS Location"}),(0,x.jsxs)("div",{className:"text-sm text-text-primary dark:text-dark-text-primary",children:["\ud83d\udccd ",e.gpsCoords.lat.toFixed(6),", ",e.gpsCoords.lng.toFixed(6)]}),(0,x.jsx)("a",{href:"https://www.google.com/maps?q=".concat(e.gpsCoords.lat,",").concat(e.gpsCoords.lng),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary dark:text-dark-primary hover:underline mt-1 inline-block",onClick:e=>e.stopPropagation(),children:"View on Google Maps \u2192"})]}),e.photoURLs&&e.photoURLs.length>0&&(0,x.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,x.jsxs)("div",{className:"text-xs font-semibold text-text-secondary dark:text-dark-text-secondary mb-2",children:["Photos (",e.photoURLs.length,")"]}),(0,x.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:e.photoURLs.map((e,t)=>(0,x.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"block aspect-square rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-600",onClick:e=>e.stopPropagation(),children:(0,x.jsx)("img",{src:e,alt:"Check-in ".concat(t+1),className:"w-full h-full object-cover hover:opacity-80 transition-opacity",loading:"lazy"})},t))})]})]})]},e.id)})}),M&&(0,x.jsx)("div",{className:"mt-6 text-center",children:(0,x.jsx)("button",{onClick:()=>{I(!0)},disabled:b,className:"btn btn-secondary px-8",children:b?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"spinner-small mr-2"}),"Loading..."]}):"Load More (".concat(20," at a time)")})}),!M&&p.length>0&&(0,x.jsx)("div",{className:"mt-6 text-center text-text-secondary dark:text-dark-text-secondary text-sm",children:"You've reached the end of your check-in history"})]}),(0,x.jsx)("div",{className:"mt-8 text-center",children:(0,x.jsxs)("button",{onClick:()=>m(-1),className:"inline-flex items-center gap-2 text-primary dark:text-dark-primary hover:underline font-semibold",children:[(0,x.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})})]})})}}}]);
//# sourceMappingURL=211.72d381f0.chunk.js.map