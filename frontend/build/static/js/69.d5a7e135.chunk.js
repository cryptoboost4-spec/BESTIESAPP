"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[69],{7069:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(2555),l=t(5043),n=t(3216),r=t(3984),i=t(5472),c=t(2339),d=t(579);const o=()=>{var e,s,t;const{alertId:o}=(0,n.g)(),x=(0,n.Zp)(),[m,h]=(0,l.useState)(null),[p,b]=(0,l.useState)(null),[y,u]=(0,l.useState)(!0),[j,N]=(0,l.useState)(null),[g,f]=(0,l.useState)(!1),[v,w]=(0,l.useState)(!1),[k,C]=(0,l.useState)(""),[A,S]=(0,l.useState)(null);(0,l.useEffect)(()=>{I()},[o]);const I=async()=>{try{const e=r.auth.currentUser;if(!e)return void x("/login");let s=await(0,i.x7)((0,i.H9)(r.db,"checkins",o)),t="checkin";if(s.exists()||(s=await(0,i.x7)((0,i.H9)(r.db,"emergency_sos",o)),t="sos"),!s.exists())return void u(!1);const l=(0,a.A)((0,a.A)({id:s.id},s.data()),{},{type:t});h(l);const n=await(0,i.x7)((0,i.H9)(r.db,"users",l.userId));n.exists()&&b(n.data());const c=(0,i.P)((0,i.rJ)(r.db,"alert_responses"),(0,i._M)("alertId","==",o),(0,i._M)("responderId","==",e.uid)),d=await(0,i.GG)(c);d.empty||N(d.docs[0].data())}catch(e){console.error("Error loading alert:",e)}finally{u(!1)}},T=async function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return S(e),void w(!0);await _(e,"")},_=async(e,s)=>{const t=r.auth.currentUser;if(t&&m){f(!0);try{const a=i.Dc.now(),l=m.createdAt||m.alertedAt||a,n=Math.floor((a.toMillis()-l.toMillis())/1e3);await(0,i.gS)((0,i.rJ)(r.db,"alert_responses"),{alertId:o,alertType:m.type,userId:m.userId,responderId:t.uid,responseType:e,responseTime:n,note:s||null,createdAt:a}),await(0,i.gS)((0,i.rJ)(r.db,"interactions"),{userId:m.userId,bestieId:t.uid,type:"alert_response",checkInId:"checkin"===m.type?o:null,alertId:o,metadata:{responseTime:n,action:e},createdAt:a}),N({responseType:e,note:s,createdAt:a}),w(!1),C(""),S(null);const d={acknowledged:"Response recorded - they'll know you saw this",called:"Great! Hope they're okay",on_my_way:"Stay safe! They'll be glad you're coming",contacted_them:"Thanks for reaching out to them"};c.Ay.success(d[e]||"Response recorded")}catch(a){console.error("Error recording response:",a),c.Ay.error("Failed to record response")}finally{f(!1)}}};if(y)return(0,d.jsx)("div",{className:"min-h-screen bg-pattern flex items-center justify-center",children:(0,d.jsx)("div",{className:"spinner"})});if(!m)return(0,d.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,d.jsxs)("div",{className:"max-w-2xl mx-auto p-4 text-center mt-20",children:[(0,d.jsx)("div",{className:"text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,d.jsx)("h1",{className:"text-2xl font-display text-text-primary mb-2",children:"Alert Not Found"}),(0,d.jsx)("p",{className:"text-text-secondary mb-6",children:"This alert may have been resolved or removed."}),(0,d.jsx)("button",{onClick:()=>x("/"),className:"btn btn-primary",children:"Go Home"})]})});const E="checkin"===m.type,R="sos"===m.type;return(0,d.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,d.jsxs)("div",{className:"max-w-2xl mx-auto p-4 pb-20",children:[(0,d.jsx)("div",{className:"card p-6 mb-6 ".concat(R?"bg-red-50 border-2 border-red-500":"bg-yellow-50 border-2 border-yellow-500"),children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-6xl mb-4",children:R?"\ud83c\udd98":"\ud83d\udea8"}),(0,d.jsx)("h1",{className:"text-3xl font-display text-text-primary mb-2",children:R?"EMERGENCY ALERT":"SAFETY ALERT"}),(0,d.jsxs)("p",{className:"text-lg text-text-secondary",children:[(null===p||void 0===p?void 0:p.displayName)||"A friend"," ",R?"triggered an emergency SOS":"hasn't checked in"]})]})}),(0,d.jsxs)("div",{className:"card p-6 mb-6",children:[(0,d.jsx)("h2",{className:"text-xl font-display text-text-primary mb-4",children:"Details"}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Person"}),(0,d.jsxs)("div",{className:"font-semibold text-text-primary flex items-center gap-3",children:[(0,d.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white",children:(null===p||void 0===p||null===(e=p.displayName)||void 0===e?void 0:e[0])||"?"}),(null===p||void 0===p?void 0:p.displayName)||"Unknown"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Location"}),(0,d.jsx)("div",{className:"font-semibold text-text-primary",children:m.location||"Unknown"})]}),E&&m.meetingWith&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Meeting With"}),(0,d.jsx)("div",{className:"font-semibold text-text-primary",children:m.meetingWith})]}),E&&m.notes&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Notes"}),(0,d.jsx)("div",{className:"font-semibold text-text-primary",children:m.notes})]}),m.photoURL&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Photo"}),(0,d.jsx)("img",{src:m.photoURL,alt:"Check-in",className:"w-full rounded-xl max-h-64 object-cover"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Time"}),(0,d.jsx)("div",{className:"font-semibold text-text-primary",children:null===(s=m.createdAt)||void 0===s?void 0:s.toDate().toLocaleString()})]}),E&&m.alertTime&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"Expected Check-In By"}),(0,d.jsx)("div",{className:"font-semibold text-text-primary",children:m.alertTime.toDate().toLocaleTimeString()})]})]})]}),(0,d.jsxs)("div",{className:"card p-6 bg-primary/10",children:[(0,d.jsx)("h3",{className:"font-display text-lg text-text-primary mb-3",children:"What to do:"}),(0,d.jsxs)("ul",{className:"space-y-2 text-text-secondary",children:[(0,d.jsxs)("li",{className:"flex gap-2",children:[(0,d.jsx)("span",{children:"1."}),(0,d.jsxs)("span",{children:["Try calling or messaging ",null===p||void 0===p?void 0:p.displayName]})]}),(0,d.jsxs)("li",{className:"flex gap-2",children:[(0,d.jsx)("span",{children:"2."}),(0,d.jsx)("span",{children:"Check if they're at the location listed above"})]}),(0,d.jsxs)("li",{className:"flex gap-2",children:[(0,d.jsx)("span",{children:"3."}),(0,d.jsx)("span",{children:"If you can't reach them, consider contacting local authorities"})]}),R&&(0,d.jsxs)("li",{className:"flex gap-2 font-semibold text-red-600",children:[(0,d.jsx)("span",{children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{children:"This is an EMERGENCY - act immediately!"})]})]})]}),j?(0,d.jsxs)("div",{className:"card p-6 mt-6 bg-green-50 border-2 border-green-500",children:[(0,d.jsxs)("h3",{className:"font-display text-lg text-text-primary mb-2 flex items-center gap-2",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\u2705"}),"You responded to this alert"]}),(0,d.jsxs)("div",{className:"text-sm text-text-secondary space-y-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"font-semibold",children:"Action:"}),(0,d.jsx)("span",{className:"capitalize",children:j.responseType.replace(/_/g," ")})]}),j.note&&(0,d.jsxs)("div",{className:"flex items-start gap-2 mt-2",children:[(0,d.jsx)("span",{className:"font-semibold",children:"Note:"}),(0,d.jsx)("span",{className:"flex-1",children:j.note})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Responded ",null===(t=j.createdAt)||void 0===t?void 0:t.toDate().toLocaleString()]})]})]}):(0,d.jsxs)("div",{className:"card p-6 mt-6 bg-gradient-to-br from-purple-50 to-pink-50",children:[(0,d.jsx)("h3",{className:"font-display text-lg text-text-primary mb-4 text-center",children:"Let them know you're here to help"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,d.jsxs)("button",{onClick:()=>T("acknowledged"),disabled:g,className:"btn btn-secondary py-3 flex flex-col items-center gap-1",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udc40"}),(0,d.jsx)("span",{className:"text-sm font-semibold",children:"I saw this"})]}),(0,d.jsxs)("button",{onClick:()=>T("called"),disabled:g,className:"btn bg-blue-500 hover:bg-blue-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\udcde"}),(0,d.jsx)("span",{className:"text-sm font-semibold",children:"I called them"})]}),(0,d.jsxs)("button",{onClick:()=>T("on_my_way"),disabled:g,className:"btn bg-orange-500 hover:bg-orange-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\ud83d\ude97"}),(0,d.jsx)("span",{className:"text-sm font-semibold",children:"On my way"})]}),(0,d.jsxs)("button",{onClick:()=>T("contacted_them"),disabled:g,className:"btn bg-green-500 hover:bg-green-600 text-white py-3 flex flex-col items-center gap-1",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\u2705"}),(0,d.jsx)("span",{className:"text-sm font-semibold",children:"Contacted"})]})]}),(0,d.jsx)("button",{onClick:()=>w(!0),disabled:g,className:"w-full btn btn-outline text-sm py-2",children:"\ud83d\udcdd Add a note about what you did"})]}),(null===p||void 0===p?void 0:p.phoneNumber)&&(0,d.jsx)("div",{className:"mt-4",children:(0,d.jsxs)("a",{href:"tel:".concat(p.phoneNumber),className:"w-full btn btn-primary text-lg py-4 block text-center",children:["\ud83d\udcde Call ",p.displayName]})}),v&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>w(!1),children:(0,d.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h3",{className:"text-xl font-display mb-4",children:"Add a note"}),(0,d.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),placeholder:"What did you do to help? (optional)",className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none min-h-32 resize-none"}),(0,d.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,d.jsx)("button",{onClick:()=>{w(!1),C(""),S(null)},className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>_(A||"acknowledged",k),disabled:g,className:"flex-1 btn btn-primary",children:g?"Saving...":"Save Response"})]})]})})]})})}}}]);
//# sourceMappingURL=69.d5a7e135.chunk.js.map