"use strict";(self.webpackChunkbesties_frontend=self.webpackChunkbesties_frontend||[]).push([[235],{3415:(e,t,s)=>{s.d(t,{HW:()=>a});var r=s(7977);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if("string"!==typeof e)return"";var s;return("string"!==typeof(s=e)?"":r.A.sanitize(s,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]})).substring(0,t)}},6235:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var r=s(2555),a=s(5043),n=s(3216),i=s(4528),l=s(3984),o=s(5472),d=s(2339),c=s(579);const m=e=>{let{onClose:t,onSuccess:s}=e;const{currentUser:r,userData:n}=(0,i.As)(),[l,o]=(0,a.useState)(!1),m="https://bestiesapp.web.app/?invite=".concat(null===r||void 0===r?void 0:r.uid),x="Hey! ".concat((null===n||void 0===n?void 0:n.displayName)||"Your friend"," wants you to be their safety bestie on Besties! \ud83d\udc9c Join them and help keep each other safe: ").concat(m),u=()=>{navigator.clipboard.writeText(x),d.Ay.success("Link copied! Now paste it to your bestie! \ud83d\udc95"),o(!0),setTimeout(()=>{null===s||void 0===s||s(),t()},2e3)};return l?(0,c.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,c.jsx)("div",{className:"modal-content celebration-modal",onClick:e=>e.stopPropagation(),children:(0,c.jsxs)("div",{className:"celebration-content",children:[(0,c.jsx)("div",{className:"celebration-emoji",children:"\ud83c\udf89"}),(0,c.jsx)("h2",{className:"celebration-title",children:"Amazing!"}),(0,c.jsx)("p",{className:"celebration-text",children:"You're building your safety network! Every bestie you add makes both of you safer. \ud83d\udc9c"}),(0,c.jsxs)("div",{className:"celebration-encouragement",children:[(0,c.jsx)("p",{className:"font-semibold text-primary dark:text-purple-400",children:"Keep going! Invite more besties:"}),(0,c.jsx)("p",{className:"text-sm text-text-secondary dark:text-gray-300 mt-2",children:"The more people in your circle, the safer everyone is. Your besties will thank you! \u2728"})]})]})})}):(0,c.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,c.jsxs)("div",{className:"modal-content invite-modal",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"invite-header",children:[(0,c.jsx)("div",{className:"invite-icon",children:"\ud83d\udc6f\u200d\u2640\ufe0f"}),(0,c.jsx)("h2",{className:"invite-title",children:"Invite Your Bestie"}),(0,c.jsx)("p",{className:"invite-subtitle",children:"You're making such a smart choice! Adding besties means you'll both be safer when you're out. \ud83d\udc95"})]}),(0,c.jsxs)("div",{className:"invite-encouragement-box",children:[(0,c.jsx)("p",{className:"text-sm font-semibold text-primary dark:text-purple-400 mb-2",children:"\ud83d\udc9c Complete Your Bestie Circle"}),(0,c.jsx)("p",{className:"text-sm text-text-secondary dark:text-gray-300",children:"Your safety network gets stronger with every bestie you add. Having 3-5 trusted friends means:"}),(0,c.jsxs)("ul",{className:"invite-benefits",children:[(0,c.jsx)("li",{children:"\u2713 Someone's always available when you need help"}),(0,c.jsx)("li",{children:"\u2713 Faster response times in emergencies"}),(0,c.jsx)("li",{children:"\u2713 You all watch out for each other - true sisterhood! \ud83d\udc95"})]})]}),(0,c.jsxs)("button",{onClick:async()=>{if(navigator.share)try{await navigator.share({title:"Join me on Besties!",text:x,url:m}),o(!0),d.Ay.success("Thanks for inviting your bestie! \ud83d\udc9c"),setTimeout(()=>{null===s||void 0===s||s(),t()},2e3)}catch(e){"AbortError"!==e.name&&(console.error("Share failed:",e),d.Ay.error("Sharing failed. Try copy link instead!"))}else u()},className:"share-button primary-share",children:[(0,c.jsx)("span",{className:"share-icon",children:"\ud83c\udf89"}),(0,c.jsxs)("div",{className:"share-button-content",children:[(0,c.jsx)("div",{className:"share-button-title",children:"Share Invite"}),(0,c.jsx)("div",{className:"share-button-subtitle",children:"Choose any app to send"})]})]}),(0,c.jsx)("div",{className:"share-divider",children:(0,c.jsx)("span",{children:"OR SHARE VIA"})}),(0,c.jsxs)("div",{className:"share-options-grid",children:[(0,c.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(x);window.location.href="whatsapp://send?text=".concat(e),setTimeout(()=>{window.open("https://wa.me/?text=".concat(e),"_blank")},1e3),o(!0),setTimeout(()=>{null===s||void 0===s||s(),t()},1500)},className:"share-option whatsapp",children:[(0,c.jsx)("span",{className:"share-option-emoji",children:"\ud83d\udcac"}),(0,c.jsx)("span",{children:"WhatsApp"})]}),(0,c.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(m);window.location.href="fb-messenger://share?link=".concat(e),setTimeout(()=>{window.open("https://www.facebook.com/dialog/send?link=".concat(e,"&app_id=YOUR_APP_ID&redirect_uri=").concat(window.location.origin),"_blank")},1e3),o(!0),setTimeout(()=>{null===s||void 0===s||s(),t()},1500)},className:"share-option messenger",children:[(0,c.jsx)("span",{className:"share-option-emoji",children:"\ud83d\udcac"}),(0,c.jsx)("span",{children:"Messenger"})]}),(0,c.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(x);window.location.href="sms:?body=".concat(e),o(!0),setTimeout(()=>{null===s||void 0===s||s(),t()},1500)},className:"share-option sms",children:[(0,c.jsx)("span",{className:"share-option-emoji",children:"\ud83d\udcf1"}),(0,c.jsx)("span",{children:"Text"})]}),(0,c.jsxs)("button",{onClick:()=>{const e=encodeURIComponent(m),r="fb://facewebmodal/f?href=".concat(e);window.location.href=r,setTimeout(()=>{window.open("https://www.facebook.com/sharer/sharer.php?u=".concat(e),"_blank")},1e3),o(!0),setTimeout(()=>{null===s||void 0===s||s(),t()},1500)},className:"share-option facebook",children:[(0,c.jsx)("span",{className:"share-option-emoji",children:"\ud83d\udcd8"}),(0,c.jsx)("span",{children:"Facebook"})]}),(0,c.jsxs)("button",{onClick:u,className:"share-option copy",children:[(0,c.jsx)("span",{className:"share-option-emoji",children:"\ud83d\udccb"}),(0,c.jsx)("span",{children:"Copy Link"})]})]}),(0,c.jsx)("div",{className:"invite-footer",children:(0,c.jsx)("p",{className:"text-xs text-text-secondary dark:text-gray-400",children:"\ud83d\udc9c Your besties will appreciate you looking out for them!"})}),(0,c.jsx)("button",{onClick:t,className:"modal-close-button",children:"\u2715"})]})})};var x=s(4505),u=s(7688);const p=e=>{let{request:t,onRequestHandled:r}=e;const[n,i]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),{executeOptimistic:d}=(0,u.Ay)(),m=(null===t||void 0===t?void 0:t.requesterPhotoURL)||null;return l?null:(0,c.jsxs)("div",{className:"card p-4 border-2 border-primary/20 animate-fade-in",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,c.jsx)("div",{className:"w-12 h-12 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display text-lg overflow-hidden",children:m?(0,c.jsx)("img",{src:m,alt:t.requesterName||"Bestie",className:"w-full h-full object-cover"}):null!==t&&void 0!==t&&t.requesterName&&"string"===typeof t.requesterName&&t.requesterName.length>0?t.requesterName[0].toUpperCase():"?"}),(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsx)("div",{className:"font-semibold text-text-primary",children:t.requesterName}),(0,c.jsx)("div",{className:"text-sm text-text-secondary",children:t.requesterPhone})]})]}),t.personalMessage&&(0,c.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 mb-3 text-sm text-text-secondary italic",children:['"',t.personalMessage,'"']}),(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)("button",{onClick:async()=>{await d({optimisticUpdate:()=>{o(!0),r&&r(t.id)},serverUpdate:async()=>{i(!0);try{const e=await x.Ay.declineBestieRequest(t.id);if(!e.success)throw new Error("Failed to decline request");return e}finally{i(!1)}},rollback:()=>{o(!1)},successMessage:"Request declined",errorMessage:"Failed to decline request"})},disabled:n,className:"flex-1 btn btn-secondary text-sm",children:"Decline"}),(0,c.jsx)("button",{onClick:async()=>{await d({optimisticUpdate:()=>{o(!0),r&&r(t.id)},serverUpdate:async()=>{i(!0);try{const e=await x.Ay.acceptBestieRequest(t.id);if(!e.success)throw new Error("Failed to accept request");const{logAnalyticsEvent:r}=s(3984);return r("bestie_request_accepted",{method:"accept"}),e}finally{i(!1)}},rollback:()=>{o(!1)},successMessage:"You're now besties with ".concat(t.requesterName,"! \ud83d\udc9c"),errorMessage:"Failed to accept request"})},disabled:n,className:"flex-1 btn btn-primary text-sm",children:n?"Accepting...":"Accept"})]})]})},h=e=>{let{pendingRequests:t}=e;return 0===t.length?null:(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsxs)("h2",{className:"text-lg md:text-xl font-display text-text-primary mb-3",children:["\ud83d\udd14 Pending Requests (",t.length,")"]}),(0,c.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,c.jsx)(p,{request:e},e.id))})]})},g=e=>{let{missedCheckIns:t,requestsForAttention:s,besties:r}=e;const[n,i]=(0,a.useState)(new Set),l=t.filter(e=>!n.has("missed-".concat(e.id))),o=s.filter(e=>!n.has("request-".concat(e.userId))),d=l.length>0||o.length>0,m=(e,t)=>{i(s=>new Set([...s,"".concat(e,"-").concat(t)]))};return d?(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsxs)("h2",{className:"text-lg md:text-xl font-display text-red-600 mb-3 flex items-center gap-2",children:[(0,c.jsx)("span",{className:"animate-ping inline-block w-3 h-3 bg-red-600 rounded-full"}),"\u26a0\ufe0f NEEDS ATTENTION"]}),l.length>0&&(0,c.jsx)("div",{className:"space-y-3 mb-4",children:l.map(e=>{var t,s;return(0,c.jsxs)("div",{className:"card p-4 bg-red-50 dark:bg-red-900/30 border-2 border-red-400 dark:border-red-600 relative",children:[(0,c.jsx)("button",{onClick:()=>m("missed",e.id),className:"absolute top-2 right-2 w-6 h-6 rounded-full bg-red-200 dark:bg-red-800 hover:bg-red-300 dark:hover:bg-red-700 flex items-center justify-center text-red-600 dark:text-red-300 text-sm font-bold transition-colors",title:"Dismiss",children:"\u2715"}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3 pr-6",children:[(0,c.jsx)("div",{className:"text-3xl flex-shrink-0",children:"\ud83d\udea8"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("h3",{className:"font-semibold text-red-900 dark:text-red-200 text-sm md:text-base",children:[e.userName," missed a check-in"]}),(0,c.jsxs)("p",{className:"text-xs md:text-sm text-red-700 dark:text-red-300 break-words",children:[(null===(t=e.checkInData.activity)||void 0===t?void 0:t.name)||"Check-in"," \u2022 ",new Date(e.timestamp).toLocaleString()]}),(null===(s=e.checkInData.location)||void 0===s?void 0:s.address)&&(0,c.jsxs)("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400 mt-1 break-words",children:["\ud83d\udccd ",e.checkInData.location.address]})]}),(0,c.jsx)("button",{className:"btn btn-sm bg-red-600 text-white hover:bg-red-700 w-full sm:w-auto flex-shrink-0",onClick:()=>{var t;m("missed",e.id),window.location.href="tel:".concat(null===(t=r.find(t=>t.userId===e.userId))||void 0===t?void 0:t.phone)},children:"Call Now"})]})]},e.id)})}),o.length>0&&(0,c.jsx)("div",{className:"space-y-3",children:o.map(e=>{var t;return(0,c.jsxs)("div",{className:"flex items-start gap-3 relative",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:e.photoURL?(0,c.jsx)("img",{src:e.photoURL,alt:e.userName,className:"w-10 h-10 rounded-full object-cover border-2 border-purple-300"}):(0,c.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white font-semibold",children:(null===(t=e.userName)||void 0===t?void 0:t.charAt(0))||"?"})}),(0,c.jsxs)("div",{className:"flex-1 relative",children:[(0,c.jsx)("button",{onClick:()=>m("request",e.userId),className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-purple-200 dark:bg-purple-800 hover:bg-purple-300 dark:hover:bg-purple-700 flex items-center justify-center text-purple-600 dark:text-purple-300 text-xs font-bold transition-colors z-10",title:"Dismiss",children:"\u2715"}),(0,c.jsxs)("div",{className:"relative bg-gradient-to-br from-purple-100 to-pink-50 dark:from-purple-900/40 dark:to-pink-900/30 rounded-2xl rounded-tl-sm p-4 shadow-sm",children:[(0,c.jsx)("div",{className:"absolute -left-2 top-3 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-purple-100 dark:border-r-purple-900/40"}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"font-semibold text-purple-900 dark:text-purple-200 text-sm",children:e.userName}),(0,c.jsx)("span",{className:"mx-2 text-purple-400",children:"\u2022"}),(0,c.jsx)("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:"needs to vent"===e.tag?"\ud83d\udcad needs to vent":e.tag})]}),(0,c.jsx)("button",{className:"btn btn-sm btn-primary flex-shrink-0 ml-2",onClick:()=>{m("request",e.userId);const t=r.find(t=>t.userId===e.userId);null!==t&&void 0!==t&&t.phone&&(window.location.href="sms:".concat(t.phone))},children:"\ud83d\udc9c Reach Out"})]})]})]})]},e.userId)})})]}):null};var b=s(9628);const y=e=>{let{postId:t,initialCounts:n}=e;const{currentUser:m,userData:x}=(0,i.As)(),[u,p]=(0,a.useState)(n||{heart:0,laugh:0,fire:0}),[h,g]=(0,a.useState)(null),[y,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{m&&t&&(async()=>{try{const e=(0,o.rJ)(l.db,"posts/".concat(t,"/reactions")),s=(0,o.P)(e,(0,o._M)("userId","==",m.uid)),r=await(0,o.GG)(s);r.empty||g(r.docs[0].data().type)}catch(e){console.error("Error loading user reaction:",e)}})()},[m,t]),(0,a.useEffect)(()=>{const e=(0,o.H9)(l.db,"posts",t),s=(0,o.aQ)(e,e=>{e.exists()&&p(e.data().reactionCounts||{heart:0,laugh:0,fire:0})});return()=>s()},[t]);return(0,c.jsx)("div",{className:"flex items-center gap-2 mt-3 flex-wrap",children:[{type:"heart",emoji:"\ud83d\udc9c",label:"Love"},{type:"laugh",emoji:"\ud83d\ude02",label:"Haha"},{type:"fire",emoji:"\ud83d\udd25",label:"Fire"}].map(e=>{const a=h===e.type,n=u[e.type]||0;return(0,c.jsxs)("button",{onClick:()=>(async e=>{if(y)return;f(!0),b.A.light();const a=(0,r.A)({},u),n=h;try{const a=(0,o.rJ)(l.db,"posts/".concat(t,"/reactions")),n=(0,o.H9)(l.db,"posts",t);if(h===e){p(t=>(0,r.A)((0,r.A)({},t),{},{[e]:Math.max(0,t[e]-1)})),g(null);const t=(0,o.P)(a,(0,o._M)("userId","==",m.uid)),s=await(0,o.GG)(t);s.empty||(await(0,o.kd)(s.docs[0].ref),await(0,o.mZ)(n,{["reactionCounts.".concat(e)]:(0,o.GV)(-1)}))}else{const i=(0,r.A)({},u);if(h&&(i[h]=Math.max(0,i[h]-1)),i[e]=(i[e]||0)+1,p(i),g(e),h){const e=(0,o.P)(a,(0,o._M)("userId","==",m.uid)),t=await(0,o.GG)(e);t.empty||(await(0,o.kd)(t.docs[0].ref),await(0,o.mZ)(n,{["reactionCounts.".concat(h)]:(0,o.GV)(-1)}))}await(0,o.gS)(a,{userId:m.uid,userName:(null===x||void 0===x?void 0:x.displayName)||"Anonymous",type:e,createdAt:o.Dc.now()}),await(0,o.mZ)(n,{["reactionCounts.".concat(e)]:(0,o.GV)(1)});const{logAnalyticsEvent:l}=s(3984);l("post_reaction_added",{reaction_type:e,post_id:t})}}catch(i){console.error("Error handling reaction:",i),d.Ay.error("Failed to update reaction"),p(a),g(n)}finally{f(!1)}})(e.type),disabled:y,className:"flex items-center gap-1 px-3 py-1.5 rounded-full text-sm transition-all ".concat(a?"bg-purple-100 dark:bg-purple-900 ring-2 ring-purple-500 scale-110":n>0?"bg-pink-50 dark:bg-pink-900/30":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"," disabled:opacity-50"),title:e.label,children:[(0,c.jsx)("span",{className:"text-lg",children:e.emoji}),(0,c.jsx)("span",{className:"font-semibold ".concat(a?"text-purple-700 dark:text-purple-300":"text-gray-600 dark:text-gray-400"),children:n})]},e.type)})})};var f=s(3415);const v=e=>{if(!e)return"";const t=new Date-(e.toDate?e.toDate():new Date(e)),s=Math.floor(t/6e4),r=Math.floor(t/36e5),a=Math.floor(t/864e5);return s<1?"Just now":s<60?"".concat(s," min ago"):r<24?"".concat(r," hour").concat(r>1?"s":""," ago"):"".concat(a," day").concat(a>1?"s":""," ago")},j=e=>{let{postId:t,onClose:n}=e;const{currentUser:m,userData:x}=(0,i.As)(),[u,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(""),[y,j]=(0,a.useState)(!0),[k,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=(0,o.rJ)(l.db,"posts/".concat(t,"/comments")),s=(0,o.P)(e,(0,o.My)("createdAt","desc"),(0,o.AB)(50)),a=(0,o.aQ)(s,e=>{const t=e.docs.map(e=>(0,r.A)({id:e.id},e.data()));p(t),j(!1)},e=>{console.error("Error loading comments:",e),j(!1),d.Ay.error("Failed to load comments")});return()=>a()},[t]);const w=async e=>{if(e.preventDefault(),h.trim()&&!k){N(!0),b.A.light();try{const e=(0,o.rJ)(l.db,"posts/".concat(t,"/comments")),r=(0,o.H9)(l.db,"posts",t),a=(0,f.HW)(h.trim(),2e3);await(0,o.gS)(e,{userId:m.uid,userName:(null===x||void 0===x?void 0:x.displayName)||"Anonymous",userPhoto:(null===x||void 0===x?void 0:x.photoURL)||null,text:a,createdAt:o.Dc.now()}),await(0,o.mZ)(r,{commentCount:(0,o.GV)(1)});const{logAnalyticsEvent:n}=s(3984);n("post_comment_added",{post_id:t,comment_length:h.trim().length}),g(""),d.Ay.success("Comment added!"),b.A.success()}catch(r){console.error("Error adding comment:",r),d.Ay.error("Failed to add comment"),b.A.error()}finally{N(!1)}}};return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[200] flex items-end md:items-center justify-center pb-28 md:pb-0",onClick:n,children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-t-2xl md:rounded-2xl max-w-md w-full max-h-[55vh] md:max-h-[600px] flex flex-col mb-4 md:mb-0",onClick:e=>e.stopPropagation(),children:[(0,c.jsx)("div",{className:"p-4 md:p-6 border-b border-gray-200 dark:border-gray-600 flex-shrink-0 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h2",{className:"text-xl md:text-2xl font-display text-transparent bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text",children:"\ud83d\udcac Comments"}),(0,c.jsx)("button",{onClick:n,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors",children:"\xd7"})]})}),(0,c.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 overscroll-contain",children:y?(0,c.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,c.jsx)("div",{className:"spinner"})}):0===u.length?(0,c.jsxs)("div",{className:"text-center py-12",children:[(0,c.jsx)("div",{className:"text-5xl mb-3",children:"\ud83d\udcac"}),(0,c.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-semibold",children:"No comments yet"}),(0,c.jsx)("p",{className:"text-gray-400 dark:text-gray-500 text-xs mt-1",children:"Be the first to comment!"})]}):u.map(e=>{var t;return(0,c.jsxs)("div",{className:"flex gap-3 animate-fade-in",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:e.userPhoto?(0,c.jsx)("img",{src:e.userPhoto,alt:e.userName,className:"w-9 h-9 rounded-full object-cover ring-2 ring-purple-100 dark:ring-purple-600"}):(0,c.jsx)("div",{className:"w-9 h-9 bg-gradient-primary rounded-full flex items-center justify-center text-white text-sm font-display ring-2 ring-purple-100 dark:ring-purple-600",children:(null===(t=e.userName)||void 0===t?void 0:t[0])||"?"})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-2xl px-4 py-2 shadow-sm",children:[(0,c.jsx)("p",{className:"font-bold text-sm text-gray-900 dark:text-gray-200",children:e.userName}),(0,c.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 break-words leading-relaxed",children:e.text})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-3",children:v(e.createdAt)})]})]},e.id)})}),(0,c.jsx)("form",{onSubmit:w,className:"p-4 md:p-6 border-t-2 border-purple-100 dark:border-purple-600 flex-shrink-0 bg-white dark:bg-gray-800",children:(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w(e))},placeholder:"Add a comment...",className:"flex-1 px-4 py-3 rounded-full border-2 border-purple-200 dark:border-purple-600 focus:border-purple-400 dark:focus:border-purple-400 focus:outline-none text-sm shadow-sm transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200",maxLength:500}),(0,c.jsx)("button",{type:"submit",disabled:!h.trim()||k,className:"btn btn-primary px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg transition-shadow",children:k?"...":"Send"})]})})]})})},k=e=>{let{activityFeed:t,reactions:s,addReaction:r,setSelectedCheckIn:i,setShowComments:l,getTimeAgo:o,initialPostId:d=null}=e;const m=(0,n.Zp)(),[x,u]=(0,a.useState)(d),[p,h]=(0,a.useState)(1);a.useEffect(()=>{d&&!x&&u(d)},[d]);const g=Math.ceil(t.length/10),b=10*(p-1),f=t.slice(b,b+10);return 0===t.length?(0,c.jsxs)("div",{className:"card p-6 md:p-8 text-center",children:[(0,c.jsx)("div",{className:"text-3xl md:text-4xl mb-2",children:"\ud83c\udf1f"}),(0,c.jsx)("p",{className:"text-sm md:text-base text-text-secondary",children:"No recent activity"}),(0,c.jsx)("p",{className:"text-xs md:text-sm text-text-secondary mt-1",children:"Check-ins from your besties will appear here"})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"space-y-3",children:f.map(e=>{var t,a,n,d,x,p,h;return(0,c.jsxs)("div",{className:"card p-3 md:p-4",children:["checkin"===e.type&&(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex items-start gap-2 md:gap-3",children:[(0,c.jsx)("div",{className:"text-2xl md:text-3xl flex-shrink-0",children:(null===(t=e.checkInData.activity)||void 0===t?void 0:t.emoji)||"\ud83d\udccd"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("h3",{className:"font-semibold text-text-primary text-sm md:text-base break-words",children:[(0,c.jsx)("button",{onClick:()=>m("/user/".concat(e.userId)),className:"text-primary hover:underline font-semibold",children:e.userName}),"completed"===e.status&&" completed check-in safely \u2705","active"===e.status&&" is currently checked in \ud83d\udd14","alerted"===e.status&&" MISSED check-in \ud83d\udea8"]}),(0,c.jsxs)("p",{className:"text-xs md:text-sm text-text-secondary",children:[(null===(a=e.checkInData.activity)||void 0===a?void 0:a.name)||"Check-in"," \u2022 ",o(e.timestamp)]}),(null===(n=e.checkInData.location)||void 0===n?void 0:n.address)&&(0,c.jsxs)("p",{className:"text-xs md:text-sm text-text-secondary mt-1 break-words",children:["\ud83d\udccd ",e.checkInData.location.address]})]}),(0,c.jsxs)("div",{className:"px-2 md:px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap flex-shrink-0 ".concat("completed"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"alerted"===e.status?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300"),children:["completed"===e.status&&"\u2713","alerted"===e.status&&"\u26a0\ufe0f","active"===e.status&&"\ud83d\udd14"]})]}),"alerted"!==e.status&&(0,c.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:(0,c.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400 mb-2",children:[["\ud83d\udc9c","\ud83d\ude2e\u200d\ud83d\udca8","\ud83c\udf89"].map(t=>{var a;const n=(null===(a=s[e.id])||void 0===a?void 0:a.filter(e=>e.emoji===t).length)||0;return(0,c.jsxs)("button",{onClick:()=>r(e.id,t),className:"flex items-center gap-1 px-2 py-1 rounded-full transition-all hover:scale-105 ".concat(n>0?"bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400":"bg-gray-100 dark:bg-gray-700 hover:bg-pink-50 dark:hover:bg-pink-900/20"),children:[(0,c.jsx)("span",{className:"text-base",children:t}),n>0&&(0,c.jsx)("span",{className:"font-semibold",children:n})]},t)}),(0,c.jsxs)("button",{onClick:()=>{i(e),l(!0)},className:"ml-auto flex items-center gap-1 px-2 py-1 rounded-full transition-all hover:scale-105 ".concat((null===(d=e.checkInData)||void 0===d?void 0:d.commentCount)>0?"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400":"bg-gray-100 dark:bg-gray-700 hover:bg-purple-50 dark:hover:bg-purple-900/20 text-gray-600 dark:text-gray-400"),children:[(0,c.jsx)("span",{className:"text-base",children:"\ud83d\udcac"}),(0,c.jsx)("span",{className:"font-semibold",children:(null===(x=e.checkInData)||void 0===x?void 0:x.commentCount)||0})]})]})})]}),"badge"===e.type&&(0,c.jsxs)("div",{className:"flex items-start gap-2 md:gap-3",children:[(0,c.jsx)("div",{className:"text-2xl md:text-3xl flex-shrink-0",children:e.badge.icon||"\ud83c\udfc6"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("h3",{className:"font-semibold text-text-primary text-sm md:text-base break-words",children:[(0,c.jsx)("button",{onClick:()=>m("/user/".concat(e.userId)),className:"text-primary hover:underline font-semibold",children:e.userName})," earned the ",(0,c.jsx)("span",{className:"text-yellow-600",children:e.badge.name})," badge! \ud83c\udf89"]}),(0,c.jsx)("p",{className:"text-xs md:text-sm text-text-secondary",children:o(e.timestamp)}),e.badge.description&&(0,c.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:e.badge.description})]}),(0,c.jsx)("div",{className:"text-3xl flex-shrink-0 animate-bounce-gentle",children:"\ud83c\udf89"})]}),"post"===e.type&&(0,c.jsx)("div",{children:e.postData.isSupportRequest?(0,c.jsxs)("div",{className:"bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl p-4 border-2 border-pink-300 dark:border-pink-600",children:[(0,c.jsxs)("div",{className:"flex items-start gap-2 md:gap-3 mb-3",children:[e.postData.userPhoto?(0,c.jsx)("img",{src:e.postData.userPhoto,alt:e.userName,className:"w-12 h-12 rounded-full object-cover flex-shrink-0 ring-2 ring-pink-300 dark:ring-pink-600",loading:"lazy"}):(0,c.jsx)("div",{className:"w-12 h-12 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display flex-shrink-0 ring-2 ring-pink-300 dark:ring-pink-600",children:(null===(p=e.userName)||void 0===p?void 0:p[0])||"?"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,c.jsx)("h3",{className:"font-bold text-text-primary text-sm md:text-base",children:e.userName}),(0,c.jsx)("span",{className:"text-lg",children:"\ud83d\udc9c"})]}),(0,c.jsx)("p",{className:"text-xs font-semibold text-pink-600 dark:text-pink-400 uppercase tracking-wide",children:"Requesting Support"}),(0,c.jsx)("p",{className:"text-xs md:text-sm text-text-secondary mt-1",children:o(e.timestamp)})]})]}),(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3",children:[(0,c.jsx)("p",{className:"text-base md:text-lg font-semibold text-center text-gray-900 dark:text-gray-100 mb-2",children:e.postData.supportTag}),(0,c.jsx)("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400",children:"Reach out if you can help! \ud83d\udc9c"})]}),(0,c.jsx)("div",{className:"flex gap-2",children:(0,c.jsxs)("a",{href:"sms:".concat(e.postData.userPhone||""),className:"flex-1 btn btn-sm bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white font-semibold py-2 flex items-center justify-center gap-2",children:[(0,c.jsx)("span",{children:"\ud83d\udcac"}),(0,c.jsx)("span",{children:"Send Message"})]})})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"flex items-start gap-2 md:gap-3 mb-3",children:[e.postData.userPhoto?(0,c.jsx)("img",{src:e.postData.userPhoto,alt:e.userName,className:"w-10 h-10 rounded-full object-cover flex-shrink-0",loading:"lazy"}):(0,c.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center text-white font-display flex-shrink-0",children:(null===(h=e.userName)||void 0===h?void 0:h[0])||"?"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("h3",{className:"font-semibold text-text-primary text-sm md:text-base",children:(0,c.jsx)("button",{onClick:()=>m("/user/".concat(e.userId)),className:"text-primary hover:underline font-semibold",children:e.userName})}),(0,c.jsx)("p",{className:"text-xs md:text-sm text-text-secondary",children:o(e.timestamp)})]}),(0,c.jsx)("div",{className:"text-xl flex-shrink-0",children:"\u270d\ufe0f"})]}),e.postData.text&&(0,c.jsx)("p",{className:"text-sm md:text-base text-text-primary mb-3 whitespace-pre-wrap break-words",children:e.postData.text}),e.postData.photoURL&&(0,c.jsx)("img",{src:e.postData.photoURL,alt:"Post",className:"w-full rounded-xl mb-2 max-h-96 object-cover",loading:"lazy"}),(0,c.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,c.jsx)(y,{postId:e.id,initialCounts:e.postData.reactionCounts}),(0,c.jsxs)("button",{onClick:()=>u(e.id),className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 hover:text-primary transition-colors",children:[(0,c.jsx)("span",{children:"\ud83d\udcac"}),(0,c.jsx)("span",{children:e.postData.commentCount>0?"".concat(e.postData.commentCount," ").concat(1===e.postData.commentCount?"comment":"comments"):"Add a comment"})]})]})]})})]},e.id)})}),g>1&&(0,c.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-6",children:[(0,c.jsx)("button",{onClick:()=>h(e=>Math.max(1,e-1)),disabled:1===p,className:"px-3 py-2 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-semibold text-sm disabled:opacity-40 disabled:cursor-not-allowed hover:bg-purple-200 dark:hover:bg-purple-800/40 transition-colors",children:"\u2190 Prev"}),(0,c.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:g},(e,t)=>t+1).map(e=>(0,c.jsx)("button",{onClick:()=>h(e),className:"w-8 h-8 rounded-full text-sm font-semibold transition-all ".concat(p===e?"bg-gradient-to-r from-pink-500 to-purple-500 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-purple-100 dark:hover:bg-purple-900/30"),children:e},e))}),(0,c.jsx)("button",{onClick:()=>h(e=>Math.min(g,e+1)),disabled:p===g,className:"px-3 py-2 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-semibold text-sm disabled:opacity-40 disabled:cursor-not-allowed hover:bg-purple-200 dark:hover:bg-purple-800/40 transition-colors",children:"Next \u2192"})]}),x&&(0,c.jsx)(j,{postId:x,onClose:()=>u(null)})]})},N=()=>(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-lg md:text-xl font-display text-text-primary mb-3",children:"\ud83d\udcf0 Activity Feed"}),(0,c.jsx)("div",{className:"space-y-3",children:[1,2,3,4,5].map(e=>(0,c.jsxs)("div",{className:"card p-3 md:p-4 animate-pulse",children:[(0,c.jsxs)("div",{className:"flex items-start gap-2 md:gap-3",children:[(0,c.jsx)("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gray-200 dark:bg-gray-700 rounded-full flex-shrink-0"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),(0,c.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-2"}),e%2===0&&(0,c.jsx)("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),(0,c.jsx)("div",{className:"w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full flex-shrink-0"})]}),e%3!==0&&(0,c.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,c.jsx)("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full"}),(0,c.jsx)("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full"}),(0,c.jsx)("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full"})]})]},e))})]}),w=e=>{let{besties:t,pendingRequests:s,onAddBestie:r}=e;return t&&t.length>0||s&&s.length>0?null:(0,c.jsxs)("div",{className:"card p-8 md:p-12 text-center",children:[(0,c.jsx)("div",{className:"text-5xl md:text-6xl mb-4",children:"\ud83d\udc9c"}),(0,c.jsx)("h2",{className:"text-xl md:text-2xl font-display text-text-primary mb-2",children:"No besties yet!"}),(0,c.jsx)("p",{className:"text-sm md:text-base text-text-secondary mb-6",children:"Add friends who'll have your back when you need them"}),(0,c.jsx)("button",{onClick:r,className:"btn btn-primary",children:"Add Your First Bestie"})]})};var A=s(8147);const C=e=>{let{onClose:t,onPostCreated:s}=e;const{currentUser:r,userData:n}=(0,i.As)(),[m,x]=(0,a.useState)(""),[u,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(null),[y,v]=(0,a.useState)(!1);return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t,children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,c.jsx)("h2",{className:"text-2xl font-display text-gradient",children:"\u270d\ufe0f Create a Post"}),(0,c.jsx)("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors",children:"\xd7"})]}),(0,c.jsx)("p",{className:"text-text-secondary mb-4",children:"Share what's on your mind with your besties \ud83d\udc9c"}),(0,c.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),placeholder:"What's happening?",className:"w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-gray-600 focus:border-primary focus:outline-none resize-none text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 mb-4",rows:4,maxLength:500}),(0,c.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-4",children:[m.length,"/500 characters"]}),(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsx)("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Add a Photo (optional)"}),h?(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("img",{src:h,alt:"Preview",className:"w-full h-48 object-cover rounded-xl border-2 border-gray-200 dark:border-gray-600"}),(0,c.jsx)("button",{onClick:()=>{p(null),g(null)},className:"absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:"\xd7"})]}):(0,c.jsxs)("label",{className:"flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl cursor-pointer hover:border-primary hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all",children:[(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcf7"}),(0,c.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to upload a photo"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"Max 5MB"})]}),(0,c.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return void d.Ay.error("Photo must be less than 5MB");p(t),g(URL.createObjectURL(t))}},className:"hidden"})]})]}),(0,c.jsxs)("div",{className:"flex gap-3",children:[(0,c.jsx)("button",{onClick:t,disabled:y,className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{if(m.trim()||u){v(!0),b.A.light();try{let e=null;if(u){const t=(0,A.KR)(l.storage,"posts/".concat(r.uid,"/").concat(Date.now(),"_").concat(u.name));await(0,A.D)(t,u),e=await(0,A.qk)(t)}const a=(0,f.HW)(m.trim(),5e3);await(0,o.gS)((0,o.rJ)(l.db,"posts"),{userId:r.uid,userName:(null===n||void 0===n?void 0:n.displayName)||"Anonymous",userPhoto:(null===n||void 0===n?void 0:n.photoURL)||null,text:a,photoURL:e,createdAt:o.Dc.now(),bestieUserIds:(null===n||void 0===n?void 0:n.bestieUserIds)||{},reactionCounts:{heart:0,laugh:0,fire:0},commentCount:0}),(0,l.logAnalyticsEvent)("post_created",{has_photo:!!e,has_text:!!m.trim(),text_length:m.trim().length}),d.Ay.success("Post created! \ud83c\udf89"),b.A.success(),null===s||void 0===s||s(),t()}catch(e){console.error("Error creating post:",e),d.Ay.error("Failed to create post"),b.A.error()}finally{v(!1)}}else d.Ay.error("Please add some text or a photo")},disabled:y||!m.trim()&&!u,className:"flex-1 btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Posting...":"Post"})]})]})})},I=e=>{let{rankingsPeriod:t,setRankingsPeriod:s}=e;return(0,c.jsxs)("div",{className:"card p-4 bg-white dark:bg-gray-800 border border-pink-100 dark:border-pink-900/30",children:[(0,c.jsxs)("div",{className:"text-center mb-4",children:[(0,c.jsx)("span",{className:"text-3xl",children:"\ud83d\udc51"}),(0,c.jsxs)("h2",{className:"text-lg font-display text-pink-500 dark:text-pink-400 mt-1",children:["weekly"===t&&"This Week's Queens","monthly"===t&&"This Month's Queens","yearly"===t&&"This Year's Queens"]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"your amazing squad \ud83d\udc95"})]}),(0,c.jsx)("div",{className:"flex gap-1 justify-center mb-4",children:[{id:"weekly",label:"Week"},{id:"monthly",label:"Month"},{id:"yearly",label:"Year"}].map(e=>{let{id:r,label:a}=e;return(0,c.jsx)("button",{onClick:()=>s(r),className:"px-3 py-1 rounded-full text-xs font-medium transition-all ".concat(t===r?"bg-pink-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 hover:bg-pink-100 dark:hover:bg-pink-900/20"),children:a},r)})}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-pink-50 dark:bg-pink-900/20 border border-pink-100 dark:border-pink-800/30",children:[(0,c.jsx)("div",{className:"w-9 h-9 rounded-full bg-pink-100 dark:bg-pink-800/40 flex items-center justify-center text-lg",children:"\ud83d\udc96"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-semibold text-sm text-pink-600 dark:text-pink-400",children:"Most Reliable"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"always there for you"})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800/30",children:[(0,c.jsx)("div",{className:"w-9 h-9 rounded-full bg-purple-100 dark:bg-purple-800/40 flex items-center justify-center text-lg",children:"\u26a1"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-semibold text-sm text-purple-600 dark:text-purple-400",children:"Super Speedy"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"quick to the rescue"})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-rose-50 dark:bg-rose-900/20 border border-rose-100 dark:border-rose-800/30",children:[(0,c.jsx)("div",{className:"w-9 h-9 rounded-full bg-rose-100 dark:bg-rose-800/40 flex items-center justify-center text-lg",children:"\ud83d\udee1\ufe0f"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-semibold text-sm text-rose-600 dark:text-rose-400",children:"Guardian Angel"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"keeping you safe"})]})]}),(0,c.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800/30",children:[(0,c.jsx)("div",{className:"w-9 h-9 rounded-full bg-amber-100 dark:bg-amber-800/40 flex items-center justify-center text-lg",children:"\ud83d\udd25"}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsx)("p",{className:"font-semibold text-sm text-amber-600 dark:text-amber-400",children:"Streak Queen"}),(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"on fire lately"})]})]})]}),(0,c.jsx)("div",{className:"mt-3 pt-2 border-t border-gray-100 dark:border-gray-700 text-center",children:(0,c.jsxs)("p",{className:"text-xs text-gray-400",children:["weekly"===t&&"resets every monday \u273f","monthly"===t&&"resets on the 1st \u273f","yearly"===t&&"resets jan 1st \u273f"]})})]})};var S=s(7766),D=s(3889);const P=e=>{let{bestie:t,onRemove:s,featuredCircle:r=[]}=e;const{isDark:m}=(0,D.D)(),{currentUser:x}=(0,i.As)(),u=(0,n.Zp)(),[p,h]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),[y,f]=(0,a.useState)(!0),[v,j]=(0,a.useState)(!1),[k,N]=(0,a.useState)(!1),[w,A]=(0,a.useState)(""),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{if(null!==t&&void 0!==t&&t.userId)try{const e=await(0,o.x7)((0,o.H9)(l.db,"users",t.userId));if(e.exists()){const t=e.data();h(t.photoURL),b(t.requestAttention)}}catch(e){console.error("Error fetching user data:",e)}finally{f(!1)}else f(!1)})()},[null===t||void 0===t?void 0:t.userId]),(0,a.useEffect)(()=>{const e=e=>{C.current&&!C.current.contains(e.target)&&j(!1)};if(v)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[v]);return t?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"relative group",children:[(0,c.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-300 via-purple-300 to-pink-300 rounded-2xl blur opacity-20 group-hover:opacity-40 transition-opacity"}),(0,c.jsxs)("div",{className:"relative card p-5 bg-gradient-to-br from-pink-50/50 via-purple-50/50 to-pink-50/50 dark:from-pink-900/10 dark:via-purple-900/10 dark:to-pink-900/10 border-2 border-pink-200 dark:border-pink-600 hover:shadow-xl transition-all hover:transform hover:-translate-y-1 min-h-[280px] flex flex-col",children:[r.includes(t.userId)&&(0,c.jsx)("div",{className:"absolute top-3 right-3",children:(0,c.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-lg flex items-center gap-1",children:"\u2b50 Circle"})}),(0,c.jsxs)("div",{className:"text-center mb-4 flex-1 flex flex-col justify-center",children:[y?(0,c.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-pink-200 to-purple-200 animate-pulse rounded-full mx-auto mb-3"}):(0,c.jsxs)("div",{className:"relative inline-block",ref:C,children:[(0,c.jsx)("div",{onClick:e=>{e.stopPropagation(),j(!v)},className:"cursor-pointer",children:(0,c.jsx)(S.A,{photoURL:p,name:t.name||t.phone||"Unknown",requestAttention:g,size:"xl",showBubble:!0})}),v&&(0,c.jsxs)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 ".concat(m?"bg-gray-800 border-gray-700":"bg-white border-gray-200"," rounded-xl shadow-2xl border-2 z-50 min-w-[180px]"),children:[(0,c.jsx)("button",{onClick:e=>{e.stopPropagation(),j(!1),u("/user/".concat(t.userId))},className:"w-full text-left px-4 py-2.5 ".concat(m?"hover:bg-gray-700 text-gray-100":"hover:bg-gray-100 text-gray-700"," text-sm font-semibold first:rounded-t-xl"),children:"\ud83d\udc64 View Profile"}),(0,c.jsx)("button",{onClick:async e=>{e.stopPropagation(),j(!1);try{const e=!t.isFavorite;if(await(0,o.mZ)((0,o.H9)(l.db,"besties",t.id),{isFavorite:e}),x&&t.userId){const s=(0,o.H9)(l.db,"users",x.uid),r=await(0,o.x7)(s);if(r.exists()){const a=r.data().featuredCircle||[];let n;n=e?!a.includes(t.userId)&&a.length<5?[...a,t.userId]:a:a.filter(e=>e!==t.userId),await(0,o.mZ)(s,{featuredCircle:n})}}d.Ay.success(t.isFavorite?"Removed from circle":"Added to circle!")}catch(s){console.error("Error toggling circle:",s),d.Ay.error("Failed to update circle")}},className:"w-full text-left px-4 py-2.5 ".concat(m?"hover:bg-gray-700 text-gray-100":"hover:bg-gray-100 text-gray-700"," text-sm font-semibold"),children:t.isFavorite?"\ud83d\udc94 Remove from Circle":"\ud83d\udc9c Add to Circle"}),(0,c.jsx)("button",{onClick:e=>{e.stopPropagation();const s=t.phone;s?window.location.href="sms:".concat(s):d.Ay.error("No phone number available"),j(!1)},className:"w-full text-left px-4 py-2.5 ".concat(m?"hover:bg-gray-700 text-gray-100":"hover:bg-gray-100 text-gray-700"," text-sm font-semibold"),children:"\ud83d\udcac Send Message"}),(0,c.jsx)("button",{onClick:e=>{e.stopPropagation(),j(!1),N(!0)},className:"w-full text-left px-4 py-2.5 ".concat(m?"hover:bg-red-900/30":"hover:bg-red-50"," text-sm font-semibold text-red-600 last:rounded-b-xl"),children:"\ud83d\uddd1\ufe0f Delete Bestie"})]})]}),(0,c.jsxs)("div",{className:"cursor-pointer mt-3",onClick:()=>t.userId&&u("/user/".concat(t.userId)),children:[(0,c.jsx)("h3",{className:"font-display text-lg font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent truncate",children:t.name||"Unknown"}),t.phone&&(0,c.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5",children:t.phone})]})]}),(0,c.jsx)("div",{className:"bestie-indicators-slot"})]})]}),k&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)("div",{className:"".concat(m?"bg-gray-800":"bg-white"," rounded-2xl max-w-md w-full p-6"),children:[(0,c.jsx)("h2",{className:"text-2xl font-display ".concat(m?"text-gray-100":"text-text-primary"," mb-2"),children:"Remove Bestie?"}),(0,c.jsxs)("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to remove ",(0,c.jsx)("strong",{children:t.name||t.phone})," from your besties?"]}),(0,c.jsxs)("div",{className:"".concat(m?"bg-yellow-900/30 border-yellow-700":"bg-yellow-50 border-yellow-200"," border rounded-lg p-3 mb-4"),children:[(0,c.jsxs)("p",{className:"text-sm ".concat(m?"text-yellow-300":"text-yellow-800"," mb-2"),children:["\u26a0\ufe0f Type ",(0,c.jsx)("strong",{children:'"see ya"'})," or ",(0,c.jsx)("strong",{children:'"bye bye"'})," to confirm"]}),(0,c.jsx)("input",{type:"text",value:w,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border-2 ".concat(m?"border-yellow-600 bg-gray-700 text-gray-100 focus:border-yellow-500":"border-yellow-300 bg-white text-gray-900 focus:border-yellow-500"," rounded-lg focus:outline-none"),placeholder:"Type here...",autoFocus:!0})]}),(0,c.jsxs)("div",{className:"flex gap-3",children:[(0,c.jsx)("button",{onClick:()=>{N(!1),A("")},className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{const e=["see ya","bye bye"],r=w.toLowerCase().trim();if(e.includes(r))try{await(0,o.kd)((0,o.H9)(l.db,"besties",t.id)),d.Ay.success("Bestie removed"),N(!1),s&&s(t.id)}catch(a){console.error("Error removing bestie:",a),d.Ay.error("Failed to remove bestie")}else d.Ay.error('Please type "'.concat(e[0],'" or "').concat(e[1],'" to confirm'))},className:"flex-1 btn bg-red-500 text-white hover:bg-red-600",children:"Remove"})]})]})})]}):null},E=e=>{let{besties:t,activityFeed:s,featuredCircle:r=[]}=e;const i=(0,n.Zp)(),[m,x]=(0,a.useState)(null),[u,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[b,y]=(0,a.useState)(""),[f,v]=(0,a.useState)(!1),j=(0,a.useMemo)(()=>{const e=new Map;if(!s||0===s.length)return e;const r=new Date(Date.now()-36e5);return t.forEach(t=>{const a=[],n=s.filter(e=>e.userId===t.userId);n.some(e=>"checkin"===e.type&&e.timestamp>r)&&a.push({icon:"\u26a1",tooltip:"Active recently"});n.filter(e=>"checkin"===e.type&&"completed"===e.status).length>=5&&a.push({icon:"\ud83d\udee1\ufe0f",tooltip:"Very reliable"});n.filter(e=>{var t,s,r;if("checkin"!==e.type||!e.timestamp)return!1;const a=null!==(t=null===(s=(r=e.timestamp).getHours)||void 0===s?void 0:s.call(r))&&void 0!==t?t:new Date(e.timestamp).getHours();return a>=21||a<=6}).length>=3&&a.push({icon:"\ud83c\udf19",tooltip:"Night owl"}),e.set(t.id,a.slice(0,3))}),e},[t,s]);return(0,c.jsxs)("div",{id:"all-besties-section",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[(0,c.jsx)("h2",{className:"text-lg md:text-xl font-display text-text-primary",children:"All Besties"}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsxs)("button",{onClick:()=>v(!f),className:"flex items-center gap-1 px-3 py-1.5 rounded-full bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 text-xs font-semibold hover:bg-pink-200 dark:hover:bg-pink-800/40 transition-colors",children:[(0,c.jsx)("span",{children:"\u2139\ufe0f"}),(0,c.jsx)("span",{children:"Symbols"})]}),f&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>v(!1)}),(0,c.jsxs)("div",{className:"absolute right-0 top-full mt-2 z-50 bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-950 dark:to-rose-950 rounded-xl p-4 shadow-xl border border-pink-200 dark:border-pink-800 min-w-[200px]",children:[(0,c.jsx)("h4",{className:"font-semibold text-sm text-pink-600 dark:text-pink-400 mb-3",children:"Symbol Guide \ud83d\udc95"}),(0,c.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-lg",children:"\u26a1"}),(0,c.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Fast responder"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-lg",children:"\ud83d\udee1\ufe0f"}),(0,c.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Very reliable"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-lg",children:"\ud83d\udd25"}),(0,c.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"On a streak"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-lg",children:"\ud83c\udf19"}),(0,c.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Night owl"})]}),(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)("span",{className:"text-lg",children:"\ud83d\udc95"}),(0,c.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Mutual bestie"})]})]})]})]})]})]}),0===t.length?(0,c.jsxs)("div",{className:"card p-6 md:p-8 text-center bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/30 dark:to-pink-900/30",children:[(0,c.jsx)("div",{className:"text-5xl md:text-6xl mb-3",children:"\ud83d\udc9c"}),(0,c.jsx)("p",{className:"text-base md:text-lg font-semibold text-text-primary mb-2",children:"No besties yet"}),(0,c.jsx)("p",{className:"text-sm md:text-base text-text-secondary",children:"Start adding besties to see them here"})]}):(0,c.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-5",children:t.map(e=>{const t=(e=>j.get(e.id)||[])(e),s=m===e.id;return(0,c.jsxs)("div",{className:"relative group",children:[(0,c.jsxs)("div",{className:"h-full transform transition-all duration-300 hover:scale-[1.02] cursor-pointer",onClick:()=>x(s?null:e.id),children:[(0,c.jsx)(P,{featuredCircle:r,bestie:e}),t.length>0&&(0,c.jsx)("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1 z-10 pointer-events-none",children:t.map((e,t)=>(0,c.jsx)("span",{className:"text-sm bg-white/90 dark:bg-gray-800/90 rounded-full px-2 py-1 shadow-md border border-purple-200 dark:border-purple-600",title:e.tooltip,children:e.icon},t))})]}),s&&(0,c.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-purple-900/95 to-transparent rounded-2xl flex items-end p-4 z-20",children:(0,c.jsxs)("div",{className:"w-full space-y-2",children:[(0,c.jsxs)("button",{onClick:t=>{t.stopPropagation(),i("/user/".concat(e.userId))},className:"w-full bg-white dark:bg-gray-800 hover:bg-purple-50 dark:hover:bg-purple-900 text-purple-900 dark:text-purple-200 font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg",children:[(0,c.jsx)("span",{children:"\ud83d\udc64"}),(0,c.jsx)("span",{children:"View Profile"})]}),(0,c.jsxs)("button",{onClick:t=>{t.stopPropagation(),e.phone?window.location.href="sms:".concat(e.phone):d.Ay.error("No phone number available")},className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg",children:[(0,c.jsx)("span",{children:"\ud83d\udcac"}),(0,c.jsx)("span",{children:"Message"})]}),(0,c.jsxs)("button",{onClick:t=>{t.stopPropagation(),g(e),p(!0),x(null)},className:"w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-lg",children:[(0,c.jsx)("span",{children:"\ud83d\uddd1\ufe0f"}),(0,c.jsx)("span",{children:"Delete"})]})]})})]},e.id)})}),u&&h&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:[(0,c.jsx)("h2",{className:"text-2xl font-display text-text-primary dark:text-gray-100 mb-2",children:"Remove Bestie?"}),(0,c.jsxs)("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to remove ",(0,c.jsx)("strong",{children:h.name||h.phone})," from your besties?"]}),(0,c.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-3 mb-4",children:[(0,c.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 mb-2",children:["\u26a0\ufe0f Type ",(0,c.jsx)("strong",{children:'"see ya"'})," or ",(0,c.jsx)("strong",{children:'"bye bye"'})," to confirm"]}),(0,c.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border-2 border-yellow-300 dark:border-yellow-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:border-yellow-500 rounded-lg focus:outline-none",placeholder:"Type here...",autoFocus:!0})]}),(0,c.jsxs)("div",{className:"flex gap-3",children:[(0,c.jsx)("button",{onClick:()=>{p(!1),g(null),y("")},className:"flex-1 btn btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{const e=["see ya","bye bye"],t=b.toLowerCase().trim();if(e.includes(t))try{await(0,o.kd)((0,o.H9)(l.db,"besties",h.id)),d.Ay.success("Bestie removed"),p(!1),g(null),y(""),x(null),window.location.reload()}catch(s){console.error("Error removing bestie:",s),d.Ay.error("Failed to remove bestie")}else d.Ay.error('Please type "'.concat(e[0],'" or "').concat(e[1],'" to confirm'))},className:"flex-1 btn bg-red-500 text-white hover:bg-red-600",children:"Remove"})]})]})})]})},M=e=>{const t=new Date-e,s=Math.floor(t/6e4),r=Math.floor(t/36e5),a=Math.floor(t/864e5);return s<1?"Just now":s<60?"".concat(s," min ago"):r<24?"".concat(r," hour").concat(r>1?"s":""," ago"):"".concat(a," day").concat(a>1?"s":""," ago")},_=e=>{let{selectedCheckIn:t,comments:s,newComment:r,setNewComment:a,onAddComment:n,onClose:i}=e;return t?(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[200] flex items-end md:items-center justify-center pb-28 md:pb-0",children:(0,c.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-t-2xl md:rounded-2xl max-w-md w-full max-h-[55vh] md:max-h-[600px] flex flex-col mb-4 md:mb-0",children:[(0,c.jsxs)("div",{className:"p-4 md:p-6 border-b border-gray-200 dark:border-gray-600 flex-shrink-0 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/30 dark:to-purple-900/30",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("h2",{className:"text-xl md:text-2xl font-display text-transparent bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text",children:"\ud83d\udcac Comments"}),(0,c.jsx)("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl transition-colors",children:"\xd7"})]}),(0,c.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t.userName,"'s check-in"]})]}),(0,c.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-4 overscroll-contain",children:0===s.length?(0,c.jsxs)("div",{className:"text-center py-12",children:[(0,c.jsx)("div",{className:"text-5xl mb-3",children:"\ud83d\udcac"}),(0,c.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-semibold",children:"No comments yet"}),(0,c.jsx)("p",{className:"text-gray-400 dark:text-gray-500 text-xs mt-1",children:"Be the first to comment!"})]}):s.map(e=>{var t,s;return(0,c.jsxs)("div",{className:"flex gap-3 animate-fade-in",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:e.userPhoto?(0,c.jsx)("img",{src:e.userPhoto,alt:e.userName,className:"w-9 h-9 rounded-full object-cover ring-2 ring-purple-100 dark:ring-purple-600"}):(0,c.jsx)("div",{className:"w-9 h-9 bg-gradient-primary rounded-full flex items-center justify-center text-white text-sm font-display ring-2 ring-purple-100 dark:ring-purple-600",children:(null===(t=e.userName)||void 0===t?void 0:t[0])||"?"})}),(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-2xl px-4 py-2 shadow-sm",children:[(0,c.jsx)("p",{className:"font-bold text-sm text-gray-900 dark:text-gray-200",children:e.userName}),(0,c.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 break-words leading-relaxed",children:e.text})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 px-3",children:null!==(s=e.timestamp)&&void 0!==s&&s.toDate?M(e.timestamp.toDate()):"Just now"})]})]},e.id)})}),(0,c.jsx)("div",{className:"p-4 md:p-6 border-t-2 border-purple-100 dark:border-purple-600 flex-shrink-0 bg-white dark:bg-gray-800",children:(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)("input",{type:"text",value:r,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())},placeholder:"Add a comment...",className:"flex-1 px-4 py-3 rounded-full border-2 border-purple-200 dark:border-purple-600 focus:border-purple-400 dark:focus:border-purple-400 focus:outline-none text-sm shadow-sm transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"}),(0,c.jsx)("button",{onClick:n,disabled:!r.trim(),className:"btn btn-primary px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg transition-shadow",children:"Send"})]})})]})}):null};var R=s(711);const q=()=>{const e=(0,n.zy)(),{currentUser:t,userData:x}=(0,i.As)(),[u,p]=(0,a.useState)([]),[b,y]=(0,a.useState)([]),[f,v]=(0,a.useState)(!1),[j,A]=(0,a.useState)(!1),[S,D]=(0,a.useState)(!0),[P,M]=(0,a.useState)([]),{activityFeed:q,activityLoading:F,missedCheckIns:T,requestsForAttention:B}=function(e,t,s){const[r,n]=(0,a.useState)([]),[i,d]=(0,a.useState)(!0),[c,m]=(0,a.useState)([]),[x,u]=(0,a.useState)([]);return(0,a.useEffect)(()=>{if(!e)return void d(!1);if(0===t.length)return d(!1),n([]),m([]),void u([]);const r=async()=>{if(!document.hidden){d(!0);try{const r=[],a=[],i=[],c=[...new Set(t.map(e=>e.userId))],x=new Date;x.setHours(x.getHours()-48);const p=o.Dc.fromDate(x),h=(0,o.P)((0,o.rJ)(l.db,"posts"),(0,o._M)("userId","==",e.uid),(0,o._M)("createdAt",">=",p),(0,o.My)("createdAt","desc"),(0,o.AB)(10));(await(0,o.GG)(h)).forEach(t=>{var a;const n=t.data();r.push({id:t.id,type:"post",postData:n,userName:(null===s||void 0===s?void 0:s.displayName)||"You",userId:e.uid,timestamp:(null===(a=n.createdAt)||void 0===a?void 0:a.toDate())||new Date})});const g=(0,o.P)((0,o.rJ)(l.db,"posts"),(0,o._M)("userId","==","BESTIES_BOT"));(await(0,o.GG)(g)).forEach(t=>{const s=t.data();var a;s.recipientId===e.uid&&r.push({id:t.id,type:"post",postData:s,userName:"Besties Team",userId:"BESTIES_BOT",timestamp:(null===(a=s.createdAt)||void 0===a?void 0:a.toDate())||new Date})});const b=10,y=[],f=[],v=[];for(let t=0;t<c.length;t+=b){const s=c.slice(t,t+b),r=(0,o.P)((0,o.rJ)(l.db,"checkins"),(0,o._M)("userId","in",s),(0,o._M)("createdAt",">=",p),(0,o.My)("createdAt","desc"),(0,o.AB)(100));y.push((0,o.GG)(r).then(e=>({type:"checkins",snap:e,batch:s})));const a=(0,o.P)((0,o.rJ)(l.db,"checkins"),(0,o._M)("bestieUserIds","array-contains",e.uid),(0,o._M)("createdAt",">=",p),(0,o.My)("createdAt","desc"),(0,o.AB)(100));if(y.push((0,o.GG)(a).then(e=>({type:"checkinsAsBestie",snap:e}))),s.length>0&&s.length<=10){const e=(0,o.P)((0,o.rJ)(l.db,"posts"),(0,o._M)("userId","in",s),(0,o._M)("createdAt",">=",p),(0,o.My)("createdAt","desc"),(0,o.AB)(100));y.push((0,o.GG)(e).then(e=>({type:"posts",snap:e,batch:s})).catch(e=>(console.warn("Error loading posts for batch:",e),{type:"posts",snap:{forEach:()=>{},empty:!0},batch:[]})))}}for(let e=0;e<c.length;e+=b){const t=c.slice(e,e+b),s=t.map(e=>(0,o.x7)((0,o.H9)(l.db,"users",e)));f.push(Promise.all(s).then(e=>e.map((e,s)=>({bestieId:t[s],doc:e}))))}for(let e=0;e<c.length;e+=b){const t=c.slice(e,e+b),s=t.map(e=>(0,o.x7)((0,o.H9)(l.db,"badges",e)));v.push(Promise.all(s).then(e=>e.map((e,s)=>({bestieId:t[s],doc:e}))))}const[j,k,N]=await Promise.all([Promise.all(y),Promise.all(f),Promise.all(v)]),w=new Map;k.flat().forEach(e=>{let{bestieId:t,doc:s}=e;s.exists()&&w.set(t,s.data())});const A=new Map;N.flat().forEach(e=>{let{bestieId:t,doc:s}=e;s.exists()&&A.set(t,s.data())});const C=new Map(t.map(e=>[e.userId,e])),I=new Set;j.forEach(e=>{"checkins"===e.type||"checkinsAsBestie"===e.type?e.snap.forEach(t=>{var s;const n=t.data(),i=n.userId;if("checkinsAsBestie"===e.type&&!c.includes(i))return;if(I.has(t.id))return;I.add(t.id);const l=C.get(i);var o;r.push({id:t.id,type:"checkin",checkInData:n,userName:(null===l||void 0===l?void 0:l.name)||"Bestie",userId:i,timestamp:(null===(s=n.createdAt)||void 0===s?void 0:s.toDate())||new Date,status:n.status}),"alerted"===n.status&&a.push({id:t.id,userName:(null===l||void 0===l?void 0:l.name)||"Bestie",userId:i,checkInData:n,timestamp:(null===(o=n.createdAt)||void 0===o?void 0:o.toDate())||new Date})}):"posts"===e.type&&e.snap.forEach(e=>{var t;const s=e.data(),a=s.userId,n=C.get(a);r.push({id:e.id,type:"post",postData:s,userName:(null===n||void 0===n?void 0:n.name)||"Bestie",userId:a,timestamp:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date})})}),w.forEach((e,t)=>{if(e.requestAttention&&e.requestAttention.active){var s;const r=C.get(t);i.push({userId:t,userName:e.displayName||(null===r||void 0===r?void 0:r.name)||"Bestie",photoURL:e.photoURL||(null===r||void 0===r?void 0:r.photoURL)||null,tag:e.requestAttention.tag,note:e.requestAttention.note,timestamp:(null===(s=e.requestAttention.timestamp)||void 0===s?void 0:s.toDate())||new Date})}}),A.forEach((e,t)=>{var s;((null===(s=e.badges)||void 0===s?void 0:s.filter(e=>{var t;const s=null===(t=e.earnedAt)||void 0===t?void 0:t.toDate();return s&&s>x}))||[]).forEach(e=>{var s;const a=C.get(t);r.push({id:"badge-".concat(t,"-").concat(e.id||e.type||Math.random()),type:"badge",userName:(null===a||void 0===a?void 0:a.name)||"Bestie",userId:t,badge:e,timestamp:(null===(s=e.earnedAt)||void 0===s?void 0:s.toDate())||new Date})})}),r.sort((e,t)=>t.timestamp-e.timestamp);const S=(null===s||void 0===s?void 0:s.featuredCircle)||[],D=S.length>0?a.filter(e=>S.includes(e.userId)):a,P=S.length>0?i.filter(e=>S.includes(e.userId)):i;n(r),m(D),u(P),d(!1)}catch(r){console.error("Error loading activity feed:",r),"permission-denied"===r.code&&(console.warn("Permission denied loading activity feed - may be race condition. Showing empty feed."),n([]),m([]),u([])),d(!1)}}};r();const a=()=>{document.hidden||r()};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[e,t,s]),{activityFeed:r,activityLoading:i,missedCheckIns:c,requestsForAttention:x}}(t,u,x),[U,G]=(0,a.useState)("weekly"),[L,J]=(0,a.useState)(null),[z,H]=(0,a.useState)(!1),[Y,O]=(0,a.useState)(null),[W,V]=(0,a.useState)([]),[Z,Q]=(0,a.useState)(""),[K,X]=(0,a.useState)({});(0,a.useEffect)(()=>{var t;null!==(t=e.state)&&void 0!==t&&t.openPostId&&(O(e.state.openPostId),window.history.replaceState({},document.title))},[e.state]),(0,a.useEffect)(()=>{if(!t)return;const e=(0,o.P)((0,o.rJ)(l.db,"besties"),(0,o._M)("requesterId","==",t.uid),(0,o._M)("status","==","accepted")),s=(0,o.P)((0,o.rJ)(l.db,"besties"),(0,o._M)("recipientId","==",t.uid),(0,o._M)("status","==","accepted")),a=(0,o.aQ)(e,e=>{const r=[];e.forEach(e=>{const t=e.data();r.push({id:e.id,userId:t.recipientId,name:t.recipientName||"Unknown",phone:t.recipientPhone,role:"added",isFavorite:t.isFavorite||!1})}),(0,o.GG)(s).then(e=>{e.forEach(e=>{const t=e.data();r.push({id:e.id,userId:t.requesterId,name:t.requesterName||"Unknown",phone:t.requesterPhone,role:"guardian",isFavorite:t.isFavorite||!1})}),p(r),D(!1)}).catch(e=>{console.error("Error loading recipient besties:",e),p(r),D(!1)});const a=(0,o.H9)(l.db,"users",t.uid);(0,o.x7)(a).then(e=>{if(e.exists()){const t=e.data();M(t.featuredCircle||[])}}).catch(e=>{console.error("Error loading featuredCircle:",e)})}),n=(0,o.P)((0,o.rJ)(l.db,"besties"),(0,o._M)("recipientId","==",t.uid),(0,o._M)("status","==","pending")),i=(0,o.aQ)(n,e=>{const t=[];e.forEach(e=>{t.push((0,r.A)({id:e.id},e.data()))}),y(t)});return()=>{a(),i()}},[t]),(0,a.useEffect)(()=>{(async()=>{var e;if(!t||!x)return;if((null!==(e=t.metadata)&&void 0!==e&&e.creationTime?new Date-new Date(t.metadata.creationTime):1/0)>864e5)return;const s=(0,o.P)((0,o.rJ)(l.db,"posts"),(0,o._M)("userId","==","BESTIES_BOT"));if((await(0,o.GG)(s)).docs.some(e=>e.data().recipientId===t.uid))return;const r=[{text:"Welcome to your Besties social hub! \ud83d\udc9c\n\nThis is your private space - only your besties see what you get up to in here. There's no algorithm, just you, your besties, and a whole lot of privacy. Feel free to share updates, check-ins, or just say hi!",order:1},{text:"\ud83d\udcca Scroll down to find the leaderboard!\n\nCompete with your friends to see who's most reliable, who's the quickest to respond... but in reality, you all win. This is about staying safe together, not competition. The real prize is having each other's backs! \ud83c\udfc6",order:2},{text:"\ud83d\udc65 Keep scrolling to see all your besties!\n\nThis is where you'll find everyone after you've filled your bestie circle. Check on them, see their activity, and stay connected. Your safety squad is growing! \ud83c\udf1f",order:3}];try{for(const e of r)await(0,o.gS)((0,o.rJ)(l.db,"posts"),{userId:"BESTIES_BOT",recipientId:t.uid,userName:"Besties Team",userPhoto:null,text:e.text,photoURL:null,createdAt:o.Dc.fromMillis(Date.now()-1e3*(3-e.order)),isWelcomeMessage:!0})}catch(a){console.error("Error creating welcome posts:",a)}})()},[t,x]),(0,a.useEffect)(()=>{if(0===q.length)return;(async()=>{const e={};for(const s of q)if("checkin"===s.type)try{const t=await(0,o.GG)((0,o.rJ)(l.db,"checkins",s.id,"reactions"));e[s.id]=t.docs.map(e=>(0,r.A)({id:e.id},e.data()))}catch(t){console.error("Error loading reactions:",t),e[s.id]=[]}X(e)})()},[q]),(0,a.useEffect)(()=>{if(!L||!z)return;(async()=>{try{const e=(0,o.P)((0,o.rJ)(l.db,"checkins",L.id,"comments"),(0,o.My)("timestamp","asc")),t=(await(0,o.GG)(e)).docs.map(e=>(0,r.A)({id:e.id},e.data()));V(t)}catch(e){console.error("Error loading comments:",e),V([])}})()},[L,z]);const $=(()=>{let e=[...u];return e.sort((e,t)=>{const s=q.find(t=>t.userId===e.userId),r=q.find(e=>e.userId===t.userId);if(s&&r)return r.timestamp-s.timestamp;if(s&&!r)return-1;if(!s&&r)return 1;const a=P.includes(e.userId),n=P.includes(t.userId);return a&&!n?-1:!a&&n?1:e.isFavorite&&!t.isFavorite?-1:!e.isFavorite&&t.isFavorite?1:(e.name||"").localeCompare(t.name||"")}),e})();return S?(0,c.jsx)("div",{className:"min-h-screen bg-pattern",children:(0,c.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,c.jsx)("div",{className:"spinner"})})}):(0,c.jsxs)("div",{className:"min-h-screen bg-pattern",children:[(0,c.jsx)("div",{className:"fixed top-16 right-4 z-50",children:(0,c.jsx)(R.A,{})}),(0,c.jsxs)("div",{className:"max-w-6xl mx-auto p-4 pb-32 md:pb-6",children:[(0,c.jsx)("div",{className:"mb-4 text-center",children:(0,c.jsx)("h1",{className:"text-2xl md:text-3xl font-display text-gradient",children:"\ud83d\udc9c Your Besties"})}),(0,c.jsx)(h,{pendingRequests:b}),(0,c.jsx)(g,{missedCheckIns:T,requestsForAttention:B,besties:u}),(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,c.jsx)("h2",{className:"text-lg md:text-xl font-display text-text-primary",children:"\ud83d\udcf0 Activity Feed"}),(0,c.jsx)("button",{onClick:()=>A(!0),className:"btn btn-primary px-4 py-2 text-sm font-semibold",children:"\u270d\ufe0f Post"})]}),F?(0,c.jsx)(N,{}):(0,c.jsx)(k,{activityFeed:q.filter(e=>{const t=T.some(t=>t.userId===e.userId&&"alerted"===e.status),s=B.some(t=>t.userId===e.userId&&"checkin"===e.type);return!t&&!s}),reactions:K,addReaction:async(e,a)=>{try{var n;if(null===(n=K[e])||void 0===n?void 0:n.find(e=>e.userId===t.uid&&e.emoji===a))return void(0,d.Ay)("You already reacted with this!",{icon:a});await(0,o.gS)((0,o.rJ)(l.db,"checkins",e,"reactions"),{userId:t.uid,userName:(null===x||void 0===x?void 0:x.displayName)||"Anonymous",emoji:a,timestamp:o.Dc.now()});const i=await(0,o.GG)((0,o.rJ)(l.db,"checkins",e,"reactions"));X(t=>(0,r.A)((0,r.A)({},t),{},{[e]:i.docs.map(e=>(0,r.A)({id:e.id},e.data()))}));const{logAnalyticsEvent:c}=s(3984);c("checkin_reaction_added",{emoji:a,checkin_id:e}),d.Ay.success("Reaction added!")}catch(i){console.error("Error adding reaction:",i),d.Ay.error("Failed to add reaction")}},setSelectedCheckIn:J,setShowComments:H,getTimeAgo:e=>{const t=new Date-e,s=Math.floor(t/6e4),r=Math.floor(t/36e5),a=Math.floor(t/864e5);return s<1?"Just now":s<60?"".concat(s," min ago"):r<24?"".concat(r," hour").concat(r>1?"s":""," ago"):"".concat(a," day").concat(a>1?"s":""," ago")},initialPostId:Y})]}),(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)(I,{rankingsPeriod:U,setRankingsPeriod:G}),(0,c.jsx)(E,{featuredCircle:P,besties:$,activityFeed:q})]}),(0,c.jsx)(w,{besties:u,pendingRequests:b,onAddBestie:()=>v(!0)})]}),z&&L&&(0,c.jsx)(_,{selectedCheckIn:L,comments:W,newComment:Z,setNewComment:Q,onAddComment:async()=>{if(Z.trim()&&L)try{await(0,o.gS)((0,o.rJ)(l.db,"checkins",L.id,"comments"),{userId:t.uid,userName:(null===x||void 0===x?void 0:x.displayName)||"Anonymous",userPhoto:(null===x||void 0===x?void 0:x.photoURL)||null,text:Z.trim(),timestamp:o.Dc.now()});const e=(0,o.P)((0,o.rJ)(l.db,"checkins",L.id,"comments"),(0,o.My)("timestamp","asc")),a=await(0,o.GG)(e);V(a.docs.map(e=>(0,r.A)({id:e.id},e.data())));const{logAnalyticsEvent:n}=s(3984);n("checkin_comment_added",{checkin_id:L.id,comment_length:Z.trim().length}),Q(""),d.Ay.success("Comment added!")}catch(e){console.error("Error adding comment:",e),d.Ay.error("Failed to add comment")}},onClose:()=>{H(!1),J(null),V([]),Q("")}}),f&&(0,c.jsx)(m,{onClose:()=>v(!1)}),j&&(0,c.jsx)(C,{onClose:()=>A(!1),onPostCreated:()=>{window.location.reload()}}),(0,c.jsx)("style",{children:"\n        @keyframes pulse-slow {\n          0%, 100% {\n            opacity: 1;\n          }\n          50% {\n            opacity: 0.7;\n          }\n        }\n        .animate-pulse-slow {\n          animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n      "})]})}}}]);
//# sourceMappingURL=235.5834d244.chunk.js.map